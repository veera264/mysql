  <HTML>
  <HEAD>
  
  <TITLE>MySQL Reference Manual for version 5.0.0-alpha. - 14  SQL Statement Syntax</TITLE>
    <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
  </HEAD>
  <BODY>


<H1><A NAME="SQL_Syntax" HREF="manual_toc.html#SQL_Syntax">14  SQL Statement Syntax</A></H1>

<P>
This chapter describes the syntax for the SQL statements supported in MySQL.

</P>


<H2><A NAME="Data_Manipulation" HREF="manual_toc.html#Data_Manipulation">14.1  Data Manipulation Statements</A></H2>



<H3><A NAME="DELETE" HREF="manual_toc.html#DELETE">14.1.1  <code>DELETE</code> Syntax</A></H3>

<P>
<A NAME="IDX1523"></A>

</P>
<P>
Single-table syntax:

<PRE>
DELETE [LOW_PRIORITY] [QUICK] [IGNORE] FROM <var>tbl_name</var>
       [WHERE <var>where_definition</var>]
       [ORDER BY ...]
       [LIMIT <var>row_count</var>]
</PRE>

<P>
Multiple-table syntax:

</P>

<PRE>
DELETE [LOW_PRIORITY] [QUICK] [IGNORE]
       <var>tbl_name</var>[.*] [, <var>tbl_name</var>[.*] ...]
       FROM <var>table_references</var>
       [WHERE <var>where_definition</var>]
</PRE>

<P>
Or:

</P>

<PRE>
DELETE [LOW_PRIORITY] [QUICK] [IGNORE]
       FROM <var>tbl_name</var>[.*] [, <var>tbl_name</var>[.*] ...]
       USING <var>table_references</var>
       [WHERE <var>where_definition</var>]
</PRE>

<P>
<code>DELETE</code> deletes rows from <var>tbl_name</var> that satisfy the condition
given by <var>where_definition</var>, and returns the number of records deleted.

</P>
<P>
If you issue a <code>DELETE</code> statement with no <code>WHERE</code> clause, all
rows are deleted.  A faster way to do this, when you don't want to know
the number of deleted rows, is to use <code>TRUNCATE TABLE</code>.
See section <A HREF="manual.html#TRUNCATE">14.1.9  <code>TRUNCATE</code> Syntax</A>.

</P>
<P>
In MySQL 3.23, <code>DELETE</code> without a <code>WHERE</code> clause returns zero
as the number of affected records.

</P>
<P>
In MySQL 3.23, if you really want to know how many records are deleted
when you are deleting all rows, and are willing to suffer a speed
penalty, you can use a <code>DELETE</code> statement that includes a
<code>WHERE</code> clause with an expression that is true for every row. For
example:

</P>

<PRE>
mysql&#62; DELETE FROM <var>tbl_name</var> WHERE 1&#62;0;
</PRE>

<P>
This is much slower than <code>TRUNCATE <var>tbl_name</var></code>, because it deletes
rows one at a time.

</P>
<P>
If you delete the row containing the maximum value for an
<code>AUTO_INCREMENT</code> column, the value will be reused for an <code>ISAM</code>
or <code>BDB</code> table, but not for a <code>MyISAM</code> or <code>InnoDB</code> table.
If you delete all rows in the table with <code>DELETE FROM <var>tbl_name</var></code>
(without a <code>WHERE</code>) in <code>AUTOCOMMIT</code> mode, the sequence starts
over for all table types except for <code>InnoDB</code> and (as of MySQL 4.0)
<code>MyISAM</code>. There are some exceptions to this behavior for <code>InnoDB</code>
tables, discussed in
section <A HREF="manual.html#InnoDB_auto-increment_column">16.7.3  How an <code>AUTO_INCREMENT</code> Column Works in <code>InnoDB</code></A>.

</P>
<P>
For <code>MyISAM</code> and <code>BDB</code> tables, you can specify an
<code>AUTO_INCREMENT</code> secondary column in a multiple-column key.  In this
case, reuse of values deleted from the top of the sequence occurs even
for <code>MyISAM</code> tables.
See section <A HREF="manual.html#example-AUTO_INCREMENT">3.6.9  Using <code>AUTO_INCREMENT</code></A>.

</P>
<P>
The <code>DELETE</code> statement supports the following modifiers:

</P>

<UL>

<LI>

If you specify the <code>LOW_PRIORITY</code> keyword, execution of the
<code>DELETE</code> is delayed until no other clients are reading from the table.

<LI>

For <code>MyISAM</code> tables, if you specify the <code>QUICK</code> keyword, the
storage engine does not merge index leaves during delete, which may speed up
certain kind of deletes.

<LI>

The <code>IGNORE</code> keyword causes MySQL to ignore all errors during the
process of deleting rows. (Errors encountered during the parsing stage are
processed in the usual manner.) Errors that are ignored due to the use of
this option are returned as warnings. This option first appeared in MySQL
4.1.1.

</UL>

<P>
The speed of delete operations may also be affected by factors discussed in
section <A HREF="manual.html#Delete_speed">7.2.14  Speed of <code>DELETE</code> Statements</A>.

</P>
<P>
In <code>MyISAM</code> tables, deleted records are maintained in a linked list and
subsequent <code>INSERT</code> operations reuse old record positions. To
reclaim unused space and reduce file sizes, use the <code>OPTIMIZE
TABLE</code> statement or the <code>myisamchk</code> utility to reorganize tables.
<code>OPTIMIZE TABLE</code> is easier, but <code>myisamchk</code> is faster.  See
section <A HREF="manual.html#OPTIMIZE_TABLE">14.5.2.5  <code>OPTIMIZE TABLE</code> Syntax</A> and section <A HREF="manual.html#Optimisation">5.6.2.10  Table Optimization</A>.

</P>
<P>
The MySQL-specific <code>LIMIT <var>row_count</var></code> option to <code>DELETE</code> tells
the server the maximum number of rows to be deleted before control is
returned to the client.  This can be used to ensure that a specific
<code>DELETE</code> statement doesn't take too much time.  You can simply repeat
the <code>DELETE</code> statement until the number of affected rows is less than
the <code>LIMIT</code> value.

</P>
<P>
If the <code>DELETE</code> statement includes an <code>ORDER BY</code> clause, the rows
are deleted in the order specified by the clause. This is really useful only
in conjunction with <code>LIMIT</code>.  For example, the following statement
finds rows matching the <code>WHERE</code> clause, sorts them in <code>timestamp</code>
order, and deletes the first (oldest) one:

</P>

<PRE>
DELETE FROM somelog
WHERE user = 'jcole'
ORDER BY timestamp
LIMIT 1
</PRE>

<P>
<code>ORDER BY</code> can be used with <code>DELETE</code> beginning with MySQL 4.0.0.

</P>
<P>
From MySQL 4.0, you can specify multiple tables in the <code>DELETE</code>
statement to delete rows from one or more tables depending on a particular
condition in multiple tables. However, you cannot use <code>ORDER BY</code>
or <code>LIMIT</code> in a multiple-table <code>DELETE</code>.

</P>
<P>
The first multiple-table <code>DELETE</code> syntax is supported starting from
MySQL 4.0.0.  The second is supported starting from MySQL 4.0.2. The
<code>table_references</code> part lists the tables involved in the join.
Its syntax is described in section <A HREF="manual.html#JOIN">14.1.7.1  <code>JOIN</code> Syntax</A>.

</P>
<P>
For the first syntax, only matching rows from the tables listed before the
<code>FROM</code> clause are deleted. For the second syntax, only matching rows
from the tables listed in the <code>FROM</code> clause (before the <code>USING</code>
clause) are deleted.  The effect is that you can delete rows from many
tables at the same time and also have additional tables that are used for
searching:

</P>

<PRE>
DELETE t1,t2 FROM t1,t2,t3 WHERE t1.id=t2.id AND t2.id=t3.id;
</PRE>

<P>
Or:

</P>

<PRE>
DELETE FROM t1,t2 USING t1,t2,t3 WHERE t1.id=t2.id AND t2.id=t3.id;
</PRE>

<P>
These statements use all three files when searching for rows to delete, but
delete matching rows only from tables <code>t1</code> and <code>t2</code>.

</P>
<P>
The examples show inner joins using the comma operator, but
multiple-table <code>DELETE</code> statements can use any type of
join allowed in <code>SELECT</code> statements, such as <code>LEFT JOIN</code>.

</P>
<P>
The syntax allows <code>.*</code> after the table names for compatibility with
<code>Access</code>.

</P>
<P>
If you use a multiple-table <code>DELETE</code> statement involving
<code>InnoDB</code> tables for which there are foreign key constraints,
the MySQL optimizer might process tables in an order that differs from
that of their parent/child relationship. In this case, the statement
fails and rolls back. Instead, delete from a single table and rely on the
<code>ON DELETE</code> capabilities that <code>InnoDB</code> provides to cause the
other tables to be modified accordingly.

</P>
<P>
<strong>Note</strong>: In MySQL 4.0, you should refer to the table names to be
deleted with the true table name. In MySQL 4.1, you must use the alias
(if one was given) when referring to a table name:

</P>
<P>
In MySQL 4.0:

</P>

<PRE>
DELETE test FROM test AS t1, test2 WHERE ...
</PRE>

<P>
In MySQL 4.1:

</P>

<PRE>
DELETE t1 FROM test AS t1, test2 WHERE ...
</PRE>

<P>
The reason we didn't make this change in 4.0 is that we didn't
want to break any old 4.0 applications that were using the old syntax.

</P>


<H3><A NAME="DO" HREF="manual_toc.html#DO">14.1.2  <code>DO</code> Syntax</A></H3>

<P>
<A NAME="IDX1524"></A>

</P>

<PRE>
DO <var>expr</var> [, <var>expr</var>] ...
</PRE>

<P>
<code>DO</code> executes the expressions but doesn't return any results.  This is
shorthand for <code>SELECT <var>expr</var>, ...</code>, but has the advantage that it's
slightly faster when you don't care about the result.

</P>
<P>
<code>DO</code> is useful mainly with functions that have side effects, such as
<code>RELEASE_LOCK()</code>.

</P>
<P>
<code>DO</code> was added in MySQL 3.23.47.

</P>



<H3><A NAME="HANDLER" HREF="manual_toc.html#HANDLER">14.1.3  <code>HANDLER</code> Syntax</A></H3>

<P>
<A NAME="IDX1525"></A>

</P>

<PRE>
HANDLER <var>tbl_name</var> OPEN [ AS <var>alias</var> ]
HANDLER <var>tbl_name</var> READ <var>index_name</var> { = | &#62;= | &#60;= | &#60; } (<var>value1</var>,<var>value2</var>,...)
    [ WHERE <var>where_condition</var> ] [LIMIT ... ]
HANDLER <var>tbl_name</var> READ <var>index_name</var> { FIRST | NEXT | PREV | LAST }
    [ WHERE <var>where_condition</var> ] [LIMIT ... ]
HANDLER <var>tbl_name</var> READ { FIRST | NEXT }
    [ WHERE <var>where_condition</var> ] [LIMIT ... ]
HANDLER <var>tbl_name</var> CLOSE
</PRE>

<P>
The <code>HANDLER</code> statement provides direct access to table storage engine
interfaces.  It is available for <code>MyISAM</code> tables as MySQL 4.0.0 and
<code>InnoDB</code> tables as of MySQL 4.0.3.

</P>
<P>
The <code>HANDLER ... OPEN</code> statement opens a table, making
it accessible via subsequent <code>HANDLER ... READ</code> statements.
This table object is not shared by other threads and is not closed
until the thread calls <code>HANDLER ... CLOSE</code> or the thread terminates.
If you open the table using an alias, further references to the table with
other <code>HANDLER</code> statements must use the alias rather than the table
name.

</P>
<P>
The first <code>HANDLER ... READ</code> syntax fetches a row where the index
specified satisfies the given values and the <code>WHERE</code> condition is met.
If you have a multiple-column index, specify the index column values as a
comma-separated list. Either specify values for all the columns in the
index, or specify values for a leftmost prefix of the index columns. Suppose
that an index includes three columns named <code>col_a</code>, <code>col_b</code>, and
<code>col_c</code>, in that order.  The <code>HANDLER</code> statement can specify
values for all three columns in the index, or for the columns in a leftmost
prefix. For example:

</P>

<PRE>
HANDLER ... <var>index_name</var> = (col_a_val,col_b_val,col_c_val) ...
HANDLER ... <var>index_name</var> = (col_a_val,col_b_val) ...
HANDLER ... <var>index_name</var> = (col_a_val) ...
</PRE>

<P>
The second <code>HANDLER ... READ</code> syntax fetches a row from the table in
index order that that matches <code>WHERE</code> condition.

</P>
<P>
The third <code>HANDLER ... READ</code> syntax fetches a row from the table in
natural row order that matches the <code>WHERE</code> condition. It is faster than
<code>HANDLER <var>tbl_name</var> READ index_name</code> when a full table scan is desired.
Natural row order is the order in which rows are stored in a <code>MyISAM</code>
table data file. This statement works for <code>InnoDB</code> tables as well, but
there is no such concept because there is no separate data file.

</P>
<P>
Without a <code>LIMIT</code> clause, all forms of <code>HANDLER ... READ</code> fetch a
single row if one is available. To return a specific number of rows, include a
<code>LIMIT</code> clause. It has the same syntax as for the <code>SELECT</code>
statement.
See section <A HREF="manual.html#SELECT">14.1.7  <code>SELECT</code> Syntax</A>.

</P>
<P>
<code>HANDLER ... CLOSE</code> closes a table that was opened with
<code>HANDLER ... OPEN</code>.

</P>
<P>
Note: To use the <code>HANDLER</code> interface to refer to a table's
<code>PRIMARY KEY</code>, use the quoted identifier <code>`PRIMARY`</code>:

</P>

<PRE>
HANDLER <var>tbl_name</var> READ `PRIMARY` &#62; (...);
</PRE>

<P>
<code>HANDLER</code> is a somewhat low-level statement.  For example, it does not
provide consistency.  That is, <code>HANDLER ... OPEN</code> does <em>not</em>
take a snapshot of the table, and does <em>not</em> lock the table. This
means that after a <code>HANDLER ... OPEN</code> statement is issued, table data
can be modified (by this or any other thread) and these modifications might
appear only partially in <code>HANDLER ... NEXT</code> or <code>HANDLER ... PREV</code>
scans.

</P>
<P>
There are several reasons to use the <code>HANDLER</code> interface instead of
normal <code>SELECT</code> statements:

</P>

<UL>

<LI>

<code>HANDLER</code> is faster than <code>SELECT</code>:


<UL>

<LI>

A designated storage engine handler object is allocated for the
<code>HANDLER ...  OPEN</code>. The object is reused for the following
<code>HANDLER</code> statements for the table; it need not be reinitialized for
each one.

<LI>

There is less parsing involved.

<LI>

There is no optimizer or query-checking overhead.

<LI>

The table doesn't have to be locked between two handler requests.

<LI>

The handler interface doesn't have to provide a consistent look of the
data (for example, dirty reads are allowed), so the storage engine can
use optimizations that <code>SELECT</code> doesn't normally allow.

</UL>

<LI>

<code>HANDLER</code> makes it much easier to port applications that use an
<code>ISAM</code>-like interface to MySQL.

<LI>

<code>HANDLER</code> allows you to traverse a database in a manner that is not
easy (or perhaps even impossible) to do with <code>SELECT</code>. The <code>HANDLER</code>
interface is a more natural way to look at data when working with
applications that provide an interactive user interface to the database.

</UL>



<H3><A NAME="INSERT" HREF="manual_toc.html#INSERT">14.1.4  <code>INSERT</code> Syntax</A></H3>

<P>
<A NAME="IDX1526"></A>

</P>

<PRE>
INSERT [LOW_PRIORITY | DELAYED] [IGNORE]
    [INTO] <var>tbl_name</var> [(<var>col_name</var>,...)]
    VALUES ({<var>expr</var> | DEFAULT},...),(...),...
    [ ON DUPLICATE KEY UPDATE <var>col_name</var>=<var>expr</var>, ... ]
</PRE>

<P>
Or:

<PRE>
INSERT [LOW_PRIORITY | DELAYED] [IGNORE]
    [INTO] <var>tbl_name</var>
    SET <var>col_name</var>={<var>expr</var> | DEFAULT}, ...
    [ ON DUPLICATE KEY UPDATE <var>col_name</var>=<var>expr</var>, ... ]
</PRE>

<P>
Or:

<PRE>
INSERT [LOW_PRIORITY | DELAYED] [IGNORE]
    [INTO] <var>tbl_name</var> [(<var>col_name</var>,...)]
    SELECT ...
</PRE>

<P>
<code>INSERT</code> inserts new rows into an existing table.  The <code>INSERT ...
VALUES</code> and <code>INSERT ... SET</code> forms of the statement insert rows based
on explicitly specified values.  The <code>INSERT ... SELECT</code> form inserts
rows selected from another table or tables.  The <code>INSERT ... VALUES</code>
form with multiple value lists is supported in MySQL 3.22.5 or
later.  The <code>INSERT ... SET</code> syntax is supported in MySQL
3.22.10 or later.
<code>INSERT ... SELECT</code> is discussed further in
See section <A HREF="manual.html#INSERT_SELECT">14.1.4.1  <code>INSERT ... SELECT</code> Syntax</A>.

</P>
<P>
<var>tbl_name</var> is the table into which rows should be inserted. The columns
for which the statement provides values can be specified as follows:

</P>

<UL>

<LI>

The column name list or the <code>SET</code> clause indicates the columns
explicitly.

<LI>

If you do not specify the column list for <code>INSERT ... VALUES</code> or
<code>INSERT ... SELECT</code>, values for every column in the table must be
provided in the <code>VALUES()</code> list or by the <code>SELECT</code>.  If you don't
know the order of the columns in the table, use <code>DESCRIBE <var>tbl_name</var></code> to
find out.

</UL>

<P>
Column values can be given in several ways:

</P>

<UL>

<LI>

<A NAME="IDX1527"></A>
Any column not explicitly given a value is set to its default value.  For
example, if you specify a column list that doesn't name all the columns in
the table, unnamed columns are set to their default values.  Default value
assignment is described in section <A HREF="manual.html#CREATE_TABLE">14.2.5  <code>CREATE TABLE</code> Syntax</A>.

MySQL always has a default value for all columns. This is something
that is imposed on MySQL to be able to work with both transactional
and non-transactional tables.

Our view is that column content checking should be done in the
application and not in the database server.

Note: If you want <code>INSERT</code> statements to generate an error unless you
explicitly specify values for all columns that require a non-<code>NULL</code>
value, you can configure MySQL using the <code>DONT_USE_DEFAULT_FIELDS</code>
compiler option.  This behavior is available only if you compile MySQL from source.
See section <A HREF="manual.html#configure_options">2.3.2  Typical <code>configure</code> Options</A>.

<LI>

You can use the keyword <code>DEFAULT</code> to explicitly set a column to its
default value. (New in MySQL 4.0.3.)  This makes it easier to write
<code>INSERT</code> statements that assign values to all but a few columns,
because it allows you to avoid writing an incomplete <code>VALUES</code> list
that does not include a value for each column in the table.
Otherwise, you would have to write out the list of column names
corresponding to each value in the <code>VALUES</code> list.

As of MySQL 4.1.0, you can use <code>DEFAULT(<var>col_name</var>)</code> as a more
general form that can be used in expressions to produce a column's
default value.

<LI>

If both the column list and the <code>VALUES</code> list are empty, <code>INSERT</code>
creates a row with each column set to its default value:


<PRE>
mysql&#62; INSERT INTO <var>tbl_name</var> () VALUES();
</PRE>

<LI>

An expression <var>expr</var> can refer to any column that was set earlier in a
value list.  For example, you can do this because the value for <code>col2</code>
refers to <code>col1</code>, which has already been assigned:


<PRE>
mysql&#62; INSERT INTO <var>tbl_name</var> (<var>col1</var>,<var>col2</var>) VALUES(15,<var>col1</var>*2);
</PRE>

But you cannot do this because the value for <code>col1</code> refers to
<code>col2</code>, which is assigned after <code>col1</code>:


<PRE>
mysql&#62; INSERT INTO <var>tbl_name</var> (<var>col1</var>,<var>col2</var>) VALUES(<var>col2</var>*2,15);
</PRE>

One exception involves columns that contain <code>AUTO_INCREMENT</code> values.
Because the AUTO_INCREMENT value is generated after other value assignments,
any reference to an AUTO_INCREMENT column in the assignment will return a 0.

</UL>

<P>
The <code>INSERT</code> statement supports the following modifiers:

</P>

<UL>

<LI>

If you specify the <code>DELAYED</code> keyword, the server puts the row or
rows to be inserted into a buffer, and the client issuing the <code>INSERT
DELAYED</code> statement then can continue on.  If the table is busy, the server
holds the rows.  When the table becomes free, it begins inserting rows,
checking periodically to see whether there are new read requests for the
table. If there are, the delayed row queue is suspended until the table
becomes free again.
See section <A HREF="manual.html#INSERT_DELAYED">14.1.4.2  <code>INSERT DELAYED</code> Syntax</A>.

<LI>

If you specify the <code>LOW_PRIORITY</code> keyword, execution of the
<code>INSERT</code> is delayed until no other clients are reading from the
table. This includes other clients that began reading while existing
clients are reading, and while the <code>INSERT LOW_PRIORITY</code> statement
is waiting. It is possible, therefore, for a client that issues an
<code>INSERT LOW_PRIORITY</code> statement to wait for a very long time (or
even forever) in a read-heavy environment.
(This is in contrast to <code>INSERT DELAYED</code>, which lets the client
continue at once.)  See section <A HREF="manual.html#INSERT_DELAYED">14.1.4.2  <code>INSERT DELAYED</code> Syntax</A>.  Note
that <code>LOW_PRIORITY</code> should normally not be used with <code>MyISAM</code>
tables because doing so disables concurrent inserts.
See section <A HREF="manual.html#MyISAM">15.1  The <code>MyISAM</code> Storage Engine</A>.

<LI>

If you specify the <code>IGNORE</code> keyword in an <code>INSERT</code> with many rows,
any rows that duplicate an existing <code>UNIQUE</code> index or <code>PRIMARY
KEY</code> value in the table are ignored and are not inserted.  If you do not
specify <code>IGNORE</code>, the insert is aborted if there is any row that
duplicates an existing key value.  You can determine with the
<code>mysql_info()</code> C API function how many rows were inserted into the
table.

</UL>

<P>
If you specify the <code>ON DUPLICATE KEY UPDATE</code> clause (new in MySQL 4.1.0), and
a row is inserted that would cause a duplicate value in a <code>UNIQUE</code> index
or
<code>PRIMARY KEY</code>, an <code>UPDATE</code> of the old row is performed. For
example,
if column <code>a</code> is declared as <code>UNIQUE</code> and already contains the value
<code>1</code>, the following two statements have identical effect:

</P>

<PRE>
mysql&#62; INSERT INTO table (a,b,c) VALUES (1,2,3)
    -&#62; ON DUPLICATE KEY UPDATE c=c+1;

mysql&#62; UPDATE table SET c=c+1 WHERE a=1;
</PRE>

<P>
<strong>Note</strong>: If column <code>b</code> is unique too, the <code>INSERT</code> would be
equivalent to this <code>UPDATE</code> statement instead:

</P>

<PRE>
mysql&#62; UPDATE table SET c=c+1 WHERE a=1 OR b=2 LIMIT 1;
</PRE>

<P>
If <code>a=1 OR b=2</code> matches several rows, only <em>one</em> row
is updated! In general, you should try to avoid using the
<code>ON DUPLICATE KEY</code> clause on tables with multiple <code>UNIQUE</code> keys.

</P>
<P>
As of MySQL 4.1.1, you can use the <code>VALUES(col_name)</code> function in the
<code>UPDATE</code> clause to refer to column values from the <code>INSERT</code> part
of the <code>INSERT ... UPDATE</code> statement. In other words,
<code>VALUES(col_name)</code> in the <code>UPDATE</code> clause refers to the value of
<var>col_name</var> that would be inserted if no duplicate-key conflict
occurred. This function is especially useful in multiple-row inserts. The
<code>VALUES()</code> function is meaningful only in <code>INSERT ... UPDATE</code>
statements and returns <code>NULL</code> otherwise.

</P>
<P>
Example:

</P>

<PRE>
mysql&#62; INSERT INTO table (a,b,c) VALUES (1,2,3),(4,5,6)
    -&#62; ON DUPLICATE KEY UPDATE c=VALUES(a)+VALUES(b);
</PRE>

<P>
That statement is identical to the following two statements:

</P>

<PRE>
mysql&#62; INSERT INTO table (a,b,c) VALUES (1,2,3)
    -&#62; ON DUPLICATE KEY UPDATE c=3;
mysql&#62; INSERT INTO table (a,b,c) VALUES (4,5,6)
    -&#62; ON DUPLICATE KEY UPDATE c=9;
</PRE>

<P>
When you use <code>ON DUPLICATE KEY UPDATE</code>, the <code>DELAYED</code> option is
ignored.

</P>
<P>
<A NAME="IDX1528"></A>
<A NAME="IDX1529"></A>

</P>
<P>
You can find the value used for an <code>AUTO_INCREMENT</code> column by using the
<code>LAST_INSERT_ID()</code> function. From within the C API, use the
<code>mysql_insert_id()</code> function.  However, note that the two functions do
not behave quite identically under all circumstances.
The behavior of <code>INSERT</code> statements with respect to <code>AUTO_INCREMENT</code>
columns is discussed further in section <A HREF="manual.html#Information_functions">13.8.3  Information Functions</A> and
section <A HREF="manual.html#mysql_insert_id">21.2.3.32  <code>mysql_insert_id()</code></A>.

</P>
<P>
If you use an <code>INSERT ... VALUES</code> statement with multiple value lists
or <code>INSERT ... SELECT</code>, the statement returns an information string in
this format:

</P>

<PRE>
Records: 100 Duplicates: 0 Warnings: 0
</PRE>

<P>
<code>Records</code> indicates the number of rows processed by the statement.
(This is not necessarily the number of rows actually inserted.
<code>Duplicates</code> can be non-zero.)
<code>Duplicates</code> indicates the number of rows that couldn't be inserted
because they would duplicate some existing unique index value.
<code>Warnings</code> indicates the number of attempts to insert column values that
were problematic in some way. Warnings can occur under any of the following
conditions:

</P>

<UL>
<LI>

Inserting <code>NULL</code> into a column that has been declared <code>NOT NULL</code>.
For multiple-row <code>INSERT</code> statements or <code>INSERT ... SELECT</code>
statements,
the column is set to the default value appropriate for the column type.
This is <code>0</code> for numeric types, the empty string (<code>''</code>) for
string types, and the ``zero'' value for date and time types.

<LI>

Setting a numeric column to a value that lies outside the column's range.
The value is clipped to the closest endpoint of the range.

<LI>

Assigning a value such as <code>'10.34 a'</code> to a numeric column.  The
trailing non-numeric text is stripped off and the remaining numeric part is
inserted.  If the string value has no leading numeric part, the column is
set to <code>0</code>.

<LI>

Inserting a string into a string column (<code>CHAR</code>, <code>VARCHAR</code>, <code>TEXT</code>, or
<code>BLOB</code>) that exceeds the column's maximum length.  The value is
truncated to the column's maximum length.

<LI>

Inserting a value into a date or time column that is illegal for the column
type.  The column is set to the appropriate zero value for the type.
</UL>

<P>
<A NAME="IDX1530"></A>

</P>
<P>
If you are using the C API, the information string can be obtained by invoking
the <code>mysql_info()</code> function.
See section <A HREF="manual.html#mysql_info">21.2.3.30  <code>mysql_info()</code></A>.

</P>
<P>
<A NAME="IDX1531"></A>
<A NAME="IDX1532"></A>

</P>



<H4><A NAME="INSERT_SELECT" HREF="manual_toc.html#INSERT_SELECT">14.1.4.1  <code>INSERT ... SELECT</code> Syntax</A></H4>


<PRE>
INSERT [LOW_PRIORITY] [IGNORE] [INTO] <var>tbl_name</var> [(<var>column_list</var>)]
    SELECT ...
</PRE>

<P>
With <code>INSERT ... SELECT</code>, you can quickly insert many rows
into a table from one or many tables.

</P>
<P>
For example:

</P>

<PRE>
INSERT INTO tbl_temp2 (fld_id)
    SELECT tbl_temp1.fld_order_id
    FROM tbl_temp1 WHERE tbl_temp1.fld_order_id &#62; 100;
</PRE>

<P>
The following conditions hold for an <code>INSERT ... SELECT</code> statement:

</P>

<UL>
<LI>

Prior to MySQL 4.0.1, <code>INSERT ... SELECT</code> implicitly operates in
<code>IGNORE</code> mode.  As of MySQL 4.0.1, specify <code>IGNORE</code>
explicitly to ignore records that would cause duplicate-key violations.

<LI>

Do not use <code>DELAYED</code> with <code>INSERT ... SELECT</code>.

<LI>

Prior to MySQL 4.0.14,
the target table of the <code>INSERT</code> statement cannot appear in the
<code>FROM</code> clause of the <code>SELECT</code> part of the query.
This limitation is lifted in 4.0.14.

<LI>

<code>AUTO_INCREMENT</code> columns work as usual.

<LI>

To ensure that the binary log can be used to re-create the
original tables, MySQL will not allow concurrent inserts during
<code>INSERT ... SELECT</code>.
</UL>

<P>
You can use <code>REPLACE</code> instead of <code>INSERT</code> to overwrite old rows.
<code>REPLACE</code> is the counterpart to <code>INSERT IGNORE</code> in the treatment
of new rows that contain unique key values that duplicate old rows:
The new rows are used to replace the old rows rather than being discarded.

</P>



<H4><A NAME="INSERT_DELAYED" HREF="manual_toc.html#INSERT_DELAYED">14.1.4.2  <code>INSERT DELAYED</code> Syntax</A></H4>

<P>
<A NAME="IDX1533"></A>
<A NAME="IDX1534"></A>

</P>
<P>
<A NAME="IDX1535"></A>

</P>

<PRE>
INSERT DELAYED ...
</PRE>

<P>
The <code>DELAYED</code> option for the <code>INSERT</code> statement is a
MySQL extension to standard SQL that is very useful if you have clients
that can't wait for the <code>INSERT</code> to complete.  This is a common
problem when you use MySQL for logging and you also
periodically run <code>SELECT</code> and <code>UPDATE</code> statements that take a
long time to complete.  <code>DELAYED</code> was introduced in MySQL
3.22.15.

</P>
<P>
When a client uses <code>INSERT DELAYED</code>, it gets an okay from the server at
once, and the row is queued to be inserted when the table is not in use by
any other thread.

</P>
<P>
Another major benefit of using <code>INSERT DELAYED</code> is that inserts
from many clients are bundled together and written in one block. This is much
faster than doing many separate inserts.

</P>
<P>
There are some constraints on the use of <code>DELAYED</code>:

</P>

<UL>

<LI>

<code>INSERT DELAYED</code> works only with <code>MyISAM</code> and <code>ISAM</code>
tables.
For <code>MyISAM</code> tables, if there are no free blocks in the middle of the
data file, concurrent <code>SELECT</code> and <code>INSERT</code> statements are supported.
Under these circumstances, you very seldom need to use <code>INSERT
DELAYED</code> with <code>MyISAM</code>. See section <A HREF="manual.html#MyISAM">15.1  The <code>MyISAM</code> Storage Engine</A>.

<LI>

<code>INSERT DELAYED</code> should be used only for <code>INSERT</code> statements that
specify value lists. This is enforced as of MySQL 4.0.18.  The server ignores
<code>DELAYED</code> for <code>INSERT DELAYED ... SELECT</code> statements.

<LI>

The server ignores
<code>DELAYED</code> for <code>INSERT DELAYED ... ON DUPLICATE UPDATE</code> statements.

<LI>

Because the statement returns immediately before the rows are inserted,
you cannot use <code>LAST_INSERT_ID()</code> to get the <code>AUTO_INCREMENT</code>
value the statement might generate.

<LI>

<code>DELAYED</code> rows are not visible to <code>SELECT</code> statements until they
actually have been inserted.

</UL>

<P>
Note that currently the queued rows are held only in memory until they are
inserted into the table.  This means that if you terminate <code>mysqld</code>
forcibly (for example, with <code>kill -9</code>) or if <code>mysqld</code> dies
unexpectedly, any queued rows that have not been written to disk are lost!

</P>
<P>
The following describes in detail what happens when you use the
<code>DELAYED</code> option to <code>INSERT</code> or <code>REPLACE</code>.  In this
description, the ``thread'' is the thread that received an <code>INSERT
DELAYED</code> statement and ``handler'' is the thread that handles all
<code>INSERT DELAYED</code> statements for a particular table.

</P>

<UL>
<LI>

When a thread executes a <code>DELAYED</code> statement for a table, a handler
thread is created to process all <code>DELAYED</code> statements for the table, if
no such handler already exists.

<LI>

The thread checks whether the handler has acquired a <code>DELAYED</code>
lock already; if not, it tells the handler thread to do so.  The
<code>DELAYED</code> lock can be obtained even if other threads have a <code>READ</code>
or <code>WRITE</code> lock on the table.  However, the handler will wait for all
<code>ALTER TABLE</code> locks or <code>FLUSH TABLES</code> to ensure that the table
structure is up to date.

<LI>

The thread executes the <code>INSERT</code> statement, but instead of writing
the row to the table, it puts a copy of the final row into a queue that
is managed by the handler thread. Any syntax errors are noticed by the
thread and reported to the client program.

<LI>

The client cannot obtain from the server the number of duplicate records or
the <code>AUTO_INCREMENT</code> value for the resulting row, because the
<code>INSERT</code> returns before the insert operation has been completed.  (If
you use the C API, the <code>mysql_info()</code> function doesn't return anything
meaningful, for the same reason.)

<LI>

The binary log is updated by the handler thread when the row is inserted into
the table.  In case of multiple-row inserts, the binary log is updated when
the first row is inserted.

<LI>

After every <code>delayed_insert_limit</code> rows are written, the handler checks
whether any <code>SELECT</code> statements are still pending.  If so, it
allows these to execute before continuing.

<A NAME="IDX1536"></A>
<A NAME="IDX1537"></A>
<LI>

When the handler has no more rows in its queue, the table is unlocked.  If no
new <code>INSERT DELAYED</code> statements are received within
<code>delayed_insert_timeout</code> seconds, the handler terminates.

<LI>

If more than <code>delayed_queue_size</code> rows are pending already in a
specific handler queue, the thread requesting <code>INSERT DELAYED</code>
waits until there is room in the queue.  This is done to ensure that
the <code>mysqld</code> server doesn't use all memory for the delayed memory
queue.

<LI>

The handler thread shows up in the MySQL process list with
<code>delayed_insert</code> in the <code>Command</code> column.  It will be killed if
you execute a <code>FLUSH TABLES</code> statement or kill it with <code>KILL
thread_id</code>. However, before exiting, it will first store all queued rows into
the table. During this time it will not accept any new <code>INSERT</code>
statements from another thread. If you execute an <code>INSERT DELAYED</code>
statement after this, a new handler thread will be created.

Note that this means that <code>INSERT DELAYED</code> statements have higher
priority than normal <code>INSERT</code> statements if there is an <code>INSERT
DELAYED</code> handler already running!  Other update statements will have to wait
until the <code>INSERT DELAYED</code> queue is empty, someone terminates the handler
thread (with <code>KILL thread_id</code>), or someone executes <code>FLUSH TABLES</code>.

<LI>

The following status variables provide information about <code>INSERT
DELAYED</code> statements:

<TABLE BORDER>
<TR><TD><strong>Status Variable</strong> </TD><TD> <strong>Meaning</strong>
</TD></TR>
<TR><TD><code>Delayed_insert_threads</code> </TD><TD> Number of handler threads
</TD></TR>
<TR><TD><code>Delayed_writes</code> </TD><TD> Number of rows written with <code>INSERT DELAYED</code>
</TD></TR>
<TR><TD><code>Not_flushed_delayed_rows</code> </TD><TD> Number of rows waiting to be written
</TD></TR>
</TABLE>

You can view these variables by issuing a <code>SHOW STATUS</code> statement or
by executing a <code>mysqladmin extended-status</code> command.
</UL>

<P>
Note that <code>INSERT DELAYED</code> is slower than a normal <code>INSERT</code> if the
table is not in use.  There is also the additional overhead for the server
to handle a separate thread for each table for which there are delayed rows.
This means that you should use <code>INSERT DELAYED</code> only when you are
really sure that you need it!

</P>



<H3><A NAME="LOAD_DATA" HREF="manual_toc.html#LOAD_DATA">14.1.5  <code>LOAD DATA INFILE</code> Syntax</A></H3>

<P>
<A NAME="IDX1538"></A>

</P>

<PRE>
LOAD DATA [LOW_PRIORITY | CONCURRENT] [LOCAL] INFILE '<var>file_name</var>.txt'
    [REPLACE | IGNORE]
    INTO TABLE <var>tbl_name</var>
    [FIELDS
        [TERMINATED BY '\t']
        [[OPTIONALLY] ENCLOSED BY '']
        [ESCAPED BY '\\' ]
    ]
    [LINES 
        [STARTING BY '']    
        [TERMINATED BY '\n']
    ]
    [IGNORE <var>number</var> LINES]
    [(<var>col_name</var>,...)]
</PRE>

<P>
The <code>LOAD DATA INFILE</code> statement reads rows from a text file into a
table at a very high speed.
For more information about the efficiency of <code>INSERT</code> versus
<code>LOAD DATA INFILE</code> and speeding up <code>LOAD DATA INFILE</code>,
section <A HREF="manual.html#Insert_speed">7.2.12  Speed of <code>INSERT</code> Statements</A>.

</P>
<P>
<A NAME="IDX1539"></A>
You can also load data files by using the <code>mysqlimport</code> utility; it
operates by sending a <code>LOAD DATA INFILE</code> statement to the server.  The
<code>--local</code> option causes <code>mysqlimport</code> to read data files from the
client host.  You can specify the <code>--compress</code> option to get better
performance over slow networks if the client and server support the
compressed protocol.
See section <A HREF="manual.html#mysqlimport">8.10  The <code>mysqlimport</code> Data Import Program</A>.

</P>
<P>
If you specify the <code>LOW_PRIORITY</code> keyword, execution of the
<code>LOAD DATA</code> statement is delayed until no other clients are reading
from the table.

</P>
<P>
If you specify the <code>CONCURRENT</code> keyword with a <code>MyISAM</code> table that
satisfies the condition for concurrent inserts (that is, it contains no free
blocks in the middle),
then other threads can retrieve data from the table while <code>LOAD DATA</code>
is executing. Using this option affects the performance of <code>LOAD DATA</code>
a bit, even if no other thread is using the table at the same time.

</P>
<P>
If the <code>LOCAL</code> keyword is specified, it is
interpreted with respect to the client end of the connection:

</P>

<UL>

<LI>

If <code>LOCAL</code> is specified, the file is read by the client program on the
client host and sent to the server.

<LI>

If <code>LOCAL</code> is not specified, the
file must be located on the server host and is read directly by the server.

</UL>

<P>
<code>LOCAL</code> is available in MySQL 3.22.6 or later.

</P>
<P>
For security reasons, when reading text files located on the server, the
files must either reside in the database directory or be readable by all.
Also, to use <code>LOAD DATA INFILE</code> on server files, you must have the
<code>FILE</code> privilege.
See section <A HREF="manual.html#Privileges_provided">5.4.3  Privileges Provided by MySQL</A>.

</P>
<P>
Using <code>LOCAL</code> is a bit slower than letting the server access the files
directly, because the contents of the file must be sent over the connection
by the client to the server.  On the other hand, you do not need the
<code>FILE</code> privilege to load local files.

</P>
<P>
As of MySQL 3.23.49 and MySQL 4.0.2 (4.0.13 on Windows), 
<code>LOCAL</code> works only if your server
and your client both have been enabled to allow it.  For example, if
<code>mysqld</code> was started with <code>--local-infile=0</code>, <code>LOCAL</code> will
not work.
See section <A HREF="manual.html#LOAD_DATA_LOCAL">5.3.4  Security Issues with <code>LOAD DATA LOCAL</code></A>.

</P>
<P>
If you need <code>LOAD DATA</code> to read from a pipe, you can use the
following technique:

</P>

<PRE>
mkfifo /mysql/db/x/x
chmod 666 /mysql/db/x/x
cat &#60; /dev/tcp/10.1.1.12/4711 &#62; /mysql/db/x/x
mysql -e "LOAD DATA INFILE 'x' INTO TABLE x" x
</PRE>

<P>
If you are using a version of MySQL older than 3.23.25,
you can use this technique only with <code>LOAD DATA LOCAL INFILE</code>.

</P>
<P>
If you are using MySQL before Version 3.23.24, you can't read from a
FIFO with <code>LOAD DATA INFILE</code>.  If you need to read from a FIFO (for
example, the output from <code>gunzip</code>), use <code>LOAD DATA LOCAL INFILE</code>
instead.

</P>
<P>
When locating files on the server host, the server uses the following rules:

</P>

<UL>
<LI>

If an absolute pathname is given, the server uses the pathname as is.

<LI>

If a relative pathname with one or more leading components is given,
the server searches for the file relative to the server's data directory.

<LI>

If a filename with no leading components is given, the server looks for
the file in the database directory of the default database.
</UL>

<P>
Note that these rules mean that a file named as <tt>`./myfile.txt'</tt> is read from
the server's data directory, whereas the same file named as <tt>`myfile.txt'</tt> is
read from the database directory of the default database.  For example,
the following <code>LOAD DATA</code> statement reads the file <tt>`data.txt'</tt>
from the database directory for <code>db1</code> because <code>db1</code> is the current
database, even though the statement explicitly loads the file into a
table in the <code>db2</code> database:

</P>

<PRE>
mysql&#62; USE db1;
mysql&#62; LOAD DATA INFILE 'data.txt' INTO TABLE db2.my_table;
</PRE>

<P>
The <code>REPLACE</code> and <code>IGNORE</code> keywords control handling of input
records that duplicate existing records on unique key values.

</P>
<P>
If you specify <code>REPLACE</code>, input rows replace existing rows (in other
words, rows that have the same value for a primary or unique index as an
existing row). See section <A HREF="manual.html#REPLACE">14.1.6  <code>REPLACE</code> Syntax</A>.

</P>
<P>
If you specify <code>IGNORE</code>, input rows that duplicate an existing row
on a unique key value are skipped.  If you don't specify either option,
the behavior depends on whether or not the <code>LOCAL</code> keyword is specified.
Without <code>LOCAL</code>, an error occurs when a duplicate key value is
found, and the rest of the text file is ignored.  With <code>LOCAL</code>,
the default behavior is the same as if <code>IGNORE</code> is specified;
this is because the server has no way to stop transmission of the file
in the middle of the operation.

</P>
<P>
If you want to ignore foreign key constraints during the load operation, you
can issue a <code>SET FOREIGN_KEY_CHECKS=0</code> statement before executing
<code>LOAD DATA</code>.

</P>
<P>
If you use <code>LOAD DATA INFILE</code> on an empty <code>MyISAM</code> table, all
non-unique indexes are created in a separate batch (as for
<code>REPAIR TABLE</code>).  This normally makes <code>LOAD DATA INFILE</code> much faster
when you have many indexes.  Normally this is very fast, but in some
extreme cases, you can create the indexes even faster by turning them off
with <code>ALTER TABLE .. DISABLE KEYS</code> before loading the file into the
table and using <code>ALTER TABLE .. ENABLE KEYS</code> to re-create the indexes
after loading the file.
See section <A HREF="manual.html#Insert_speed">7.2.12  Speed of <code>INSERT</code> Statements</A>.

</P>
<P>
<code>LOAD DATA INFILE</code> is the complement of <code>SELECT ... INTO OUTFILE</code>.
See section <A HREF="manual.html#SELECT">14.1.7  <code>SELECT</code> Syntax</A>.
To write data from a table to a file, use <code>SELECT ... INTO OUTFILE</code>.
To read the file back into a table, use <code>LOAD DATA INFILE</code>.
The syntax of the <code>FIELDS</code> and <code>LINES</code> clauses is the same for
both statements.  Both clauses are optional, but <code>FIELDS</code>
must precede <code>LINES</code> if both are specified.

</P>
<P>
If you specify a <code>FIELDS</code> clause,
each of its subclauses (<code>TERMINATED BY</code>, <code>[OPTIONALLY] ENCLOSED
BY</code>, and <code>ESCAPED BY</code>) is also optional, except that you must
specify at least one of them.

</P>
<P>
If you don't specify a <code>FIELDS</code> clause, the defaults are the
same as if you had written this:

</P>

<PRE>
FIELDS TERMINATED BY '\t' ENCLOSED BY '' ESCAPED BY '\\'
</PRE>

<P>
If you don't specify a <code>LINES</code> clause, the default
is the same as if you had written this:

</P>

<PRE>
LINES TERMINATED BY '\n' STARTING BY ''
</PRE>

<P>
In other words, the defaults cause <code>LOAD DATA INFILE</code> to act as follows
when reading input:

</P>

<UL>
<LI>

Look for line boundaries at newlines.

<LI>

Do not skip over any line prefix.

<LI>

Break lines into fields at tabs.

<LI>

Do not expect fields to be enclosed within any quoting characters.

<LI>

Interpret occurrences of tab, newline, or <samp>`\'</samp> preceded by
<samp>`\'</samp> as literal characters that are part of field values.
</UL>

<P>
Conversely, the defaults cause <code>SELECT ... INTO OUTFILE</code> to act as
follows when writing output:

</P>

<UL>
<LI>

Write tabs between fields.

<LI>

Do not enclose fields within any quoting characters.

<LI>

Use <samp>`\'</samp> to escape instances of tab, newline, or <samp>`\'</samp> that occur
within field values.

<LI>

Write newlines at the ends of lines.
</UL>

<P>
Note that to write <code>FIELDS ESCAPED BY '\\'</code>, you must specify two
backslashes for the value to be read as a single backslash.

</P>
<P>
<strong>Note</strong>: If you have generated the text file on a Windows system, you
might have to use <code>LINES TERMINATED BY '\r\n'</code> to read the file
properly, because Windows programs typically use two characters as a line
terminator. Some programs, such as <code>WordPad</code>, might use <code>\r</code> as a line
terminator when writing files.  To read such files, use <code>LINES
TERMINATED BY '\r'</code>.

</P>
<P>
If all the lines you want to read in have a common prefix that you want
to ignore, you can use <code>LINES STARTING BY 'prefix_string'</code> to skip
over the prefix (and anything before it). If a line doesn't include the
prefix, the entire line is skipped. <strong>Note</strong> that
<code>prefix_string</code> may be in the middle of the line!

</P>
<P>
Example:

<PRE>
mysql&#62; LOAD DATA INFILE '/tmp/test.txt'
    -&#62; INTO TABLE test LINES STARTING BY "xxx";
</PRE>

<P>
With this you can read in a file that contains something like:

</P>

<PRE>
xxx"Row",1
something xxx"Row",2
</PRE>

<P>
And just get the data <code>("row",1)</code> and <code>("row",2)</code>.

</P>
<P>
The <code>IGNORE number LINES</code> option can be used to ignore lines at
the start of the file.  For example, you can use <code>IGNORE 1 LINES</code>
to skip over an initial header line containing column names:

</P>

<PRE>
mysql&#62; LOAD DATA INFILE '/tmp/test.txt'
    -&#62; INTO TABLE test IGNORE 1 LINES;
</PRE>

<P>
When you use <code>SELECT ... INTO OUTFILE</code> in tandem with <code>LOAD
DATA INFILE</code> to write data from a database into a file and then read
the file back into the database later, the field- and line-handling
options for both statements must match.  Otherwise, <code>LOAD DATA
INFILE</code> will not interpret the contents of the file properly.  Suppose
that you use <code>SELECT ... INTO OUTFILE</code> to write a file with
fields delimited by commas:

</P>

<PRE>
mysql&#62; SELECT * INTO OUTFILE 'data.txt'
    -&#62;          FIELDS TERMINATED BY ','
    -&#62;          FROM table2;
</PRE>

<P>
To read the comma-delimited file back in, the correct statement would be:

</P>

<PRE>
mysql&#62; LOAD DATA INFILE 'data.txt' INTO TABLE table2
    -&#62;           FIELDS TERMINATED BY ',';
</PRE>

<P>
If instead you tried to read in the file with the statement shown here, it
wouldn't work because it instructs <code>LOAD DATA INFILE</code> to look for
tabs between fields:

</P>

<PRE>
mysql&#62; LOAD DATA INFILE 'data.txt' INTO TABLE table2
    -&#62;           FIELDS TERMINATED BY '\t';
</PRE>

<P>
The likely result is that each input line would be interpreted as
a single field.

</P>
<P>
<code>LOAD DATA INFILE</code> can be used to read files obtained from
external sources, too. For example, a file in dBASE format will have
fields separated by commas and enclosed within double quotes.  If lines in
the file are terminated by newlines, the statement shown here
illustrates the field- and line-handling options you would use to load
the file:

</P>

<PRE>
mysql&#62; LOAD DATA INFILE 'data.txt' INTO TABLE <var>tbl_name</var>
    -&#62;           FIELDS TERMINATED BY ',' ENCLOSED BY '"'
    -&#62;           LINES TERMINATED BY '\n';
</PRE>

<P>
Any of the field- or line-handling options can specify an empty string
(<code>''</code>).  If not empty, the <code>FIELDS [OPTIONALLY] ENCLOSED BY</code>
and <code>FIELDS ESCAPED BY</code> values must be a single character.  The
<code>FIELDS TERMINATED BY</code>, <code>LINES STARTING BY</code>, and <code>LINES
TERMINATED BY</code> values can be more than one character.  For example, to write
lines that are terminated by carriage return/linefeed pairs, or to read a
file containing such lines, specify a <code>LINES TERMINATED BY '\r\n'</code>
clause.

</P>
<P>
To read a file containing jokes that are separated by lines consisting of
of <code>%%</code>, you can do this

</P>

<PRE>
mysql&#62; CREATE TABLE jokes
    -&#62;     (a INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    -&#62;     joke TEXT NOT NULL);
mysql&#62; LOAD DATA INFILE '/tmp/jokes.txt' INTO TABLE jokes
    -&#62;     FIELDS TERMINATED BY ''
    -&#62;     LINES TERMINATED BY '\n%%\n' (joke);
</PRE>

<P>
<code>FIELDS [OPTIONALLY] ENCLOSED BY</code> controls quoting of fields.  For
output (<code>SELECT ... INTO OUTFILE</code>), if you omit the word
<code>OPTIONALLY</code>, all fields are enclosed by the <code>ENCLOSED BY</code>
character.  An example of such output (using a comma as the field
delimiter) is shown here:

</P>

<PRE>
"1","a string","100.20"
"2","a string containing a , comma","102.20"
"3","a string containing a \" quote","102.20"
"4","a string containing a \", quote and comma","102.20"
</PRE>

<P>
If you specify <code>OPTIONALLY</code>, the <code>ENCLOSED BY</code> character is
used only to enclose <code>CHAR</code> and <code>VARCHAR</code> fields:

</P>

<PRE>
1,"a string",100.20
2,"a string containing a , comma",102.20
3,"a string containing a \" quote",102.20
4,"a string containing a \", quote and comma",102.20
</PRE>

<P>
Note that occurrences of the <code>ENCLOSED BY</code> character within a
field value are escaped by prefixing them with the <code>ESCAPED BY</code>
character.  Also note that if you specify an empty <code>ESCAPED BY</code>
value, it is possible to generate output that cannot be read properly by
<code>LOAD DATA INFILE</code>. For example, the preceding output just shown would
appear as follows if the escape character is empty.  Observe that the
second field in the fourth line contains a comma following the quote, which
(erroneously) appears to terminate the field:

</P>

<PRE>
1,"a string",100.20
2,"a string containing a , comma",102.20
3,"a string containing a " quote",102.20
4,"a string containing a ", quote and comma",102.20
</PRE>

<P>
For input, the <code>ENCLOSED BY</code> character, if present, is stripped
from the ends of field values.  (This is true whether or not <code>OPTIONALLY</code>
is specified; <code>OPTIONALLY</code> has no effect on input interpretation.)
Occurrences of the <code>ENCLOSED BY</code> character preceded by the
<code>ESCAPED BY</code> character are interpreted as part of the current
field value.

</P>
<P>
If the field begins with the <code>ENCLOSED BY</code> character, instances
of that character are recognized as terminating a field value only
if followed by the field or line <code>TERMINATED BY</code> sequence.
To avoid ambiguity, occurrences of the <code>ENCLOSED BY</code> character
within a field value can be doubled and will be interpreted as a
single instance of the character.  For example, if <code>ENCLOSED
BY '"'</code> is specified, quotes are handled as shown here:

</P>

<PRE>
"The ""BIG"" boss"  -&#62; The "BIG" boss
The "BIG" boss      -&#62; The "BIG" boss
The ""BIG"" boss    -&#62; The ""BIG"" boss
</PRE>

<P>
<code>FIELDS ESCAPED BY</code> controls how to write or read special characters.
If the <code>FIELDS ESCAPED BY</code> character is not empty, it is used to prefix
the following characters on output:

<UL>
<LI>

The <code>FIELDS ESCAPED BY</code> character
<LI>

The <code>FIELDS [OPTIONALLY] ENCLOSED BY</code> character
<LI>

The first character of the <code>FIELDS TERMINATED BY</code> and
<code>LINES TERMINATED BY</code> values
<LI>

ASCII <code>0</code> (what is actually written following the escape character is
ASCII <samp>`0'</samp>, not a zero-valued byte)
</UL>

<P>
If the <code>FIELDS ESCAPED BY</code> character is empty, no characters are
escaped and <code>NULL</code> is output as <code>NULL</code>, not <code>\N</code>.  It is
probably not a good idea to specify an empty escape character,
particularly if field values in your data contain any of the characters
in the list just given.

</P>
<P>
For input, if the <code>FIELDS ESCAPED BY</code> character is not empty, occurrences
of that character are stripped and the following character is taken literally
as part of a field value.  The exceptions are an escaped <samp>`0'</samp> or
<samp>`N'</samp> (for example, <code>\0</code> or <code>\N</code> if the escape character is
<samp>`\'</samp>).  These sequences are interpreted as ASCII NUL (a zero-valued
byte) and <code>NULL</code>.  The rules for <code>NULL</code> handling are described later
in this section.

</P>
<P>
For more information about <samp>`\'</samp>-escape syntax,
see section <A HREF="manual.html#Literals">10.1  Literal Values</A>.

</P>
<P>
In certain cases, field- and line-handling options interact:

</P>

<UL>
<LI>

If <code>LINES TERMINATED BY</code> is an empty string and <code>FIELDS
TERMINATED BY</code> is non-empty, lines are also terminated with
<code>FIELDS TERMINATED BY</code>.
<LI>

If the <code>FIELDS TERMINATED BY</code> and <code>FIELDS ENCLOSED BY</code> values
are both empty (<code>''</code>), a fixed-row (non-delimited) format is used.
With fixed-row format, no delimiters are used between fields (but you
can still have a line terminator). Instead, column values are written
and read using the ``display'' widths of the columns.  For example, if a
column is declared as <code>INT(7)</code>, values for the column are written
using seven-character fields.  On input, values for the column are obtained
by reading seven characters.

<code>LINES TERMINATED BY</code> is still used to separate lines.  If a line
doesn't contain all fields, the rest of the columns are set to their
default values. If you don't have a line terminator, you should set this
to <code>''</code>.  In this case, the text file must contain all fields for
each row.

Fixed-row format also affects handling of <code>NULL</code> values, as described
later.
Note that fixed-size format will not work if you are using a multi-byte
character set.
</UL>

<P>
Handling of <code>NULL</code> values varies according to the <code>FIELDS</code> and
<code>LINES</code> options in use:

</P>

<UL>
<LI>

For the default <code>FIELDS</code> and <code>LINES</code> values, <code>NULL</code> is
written as a field value of <code>\N</code> for output, and a field value of
<code>\N</code> is read as <code>NULL</code> for input (assuming that the <code>ESCAPED BY</code>
character is <samp>`\'</samp>).

<LI>

If <code>FIELDS ENCLOSED BY</code> is not empty, a field containing the literal
word <code>NULL</code> as its value is read as a <code>NULL</code> value. This differs
from the word <code>NULL</code> enclosed within <code>FIELDS ENCLOSED BY</code>
characters, which is read as the string <code>'NULL'</code>.

<LI>

If <code>FIELDS ESCAPED BY</code> is empty, <code>NULL</code> is written as the word
<code>NULL</code>.

<LI>

With fixed-row format (which happens when <code>FIELDS TERMINATED BY</code> and
<code>FIELDS ENCLOSED BY</code> are both empty), <code>NULL</code> is written as an empty
string.  Note that this causes both <code>NULL</code> values and empty strings in
the table to be indistinguishable when written to the file because they are
both written as empty strings.  If you need to be able to tell the two apart
when reading the file back in, you should not use fixed-row format.
</UL>

<P>
Some cases are not supported by <code>LOAD DATA INFILE</code>:

<UL>

<LI>

Fixed-size rows (<code>FIELDS TERMINATED BY</code> and <code>FIELDS ENCLOSED
BY</code> both empty) and <code>BLOB</code> or <code>TEXT</code> columns.

<LI>

If you specify one separator that is the same as or a prefix of another,
<code>LOAD DATA INFILE</code> won't be able to interpret the input properly.
For example, the following <code>FIELDS</code> clause would cause problems:


<PRE>
FIELDS TERMINATED BY '"' ENCLOSED BY '"'
</PRE>

<LI>

If <code>FIELDS ESCAPED BY</code> is empty, a field value that contains an occurrence
of <code>FIELDS ENCLOSED BY</code> or <code>LINES TERMINATED BY</code>
followed by the <code>FIELDS TERMINATED BY</code> value will cause <code>LOAD
DATA INFILE</code> to stop reading a field or line too early.
This happens because <code>LOAD DATA INFILE</code> cannot properly determine
where the field or line value ends.
</UL>

<P>
The following example loads all columns of the <code>persondata</code> table:

</P>

<PRE>
mysql&#62; LOAD DATA INFILE 'persondata.txt' INTO TABLE persondata;
</PRE>

<P>
By default, when no column list is provided at the end of the <code>LOAD
DATA INFILE</code> statement, input lines are expected to contain a field for each
table column.  If you want to load only some of a table's columns, specify a
column list:

</P>

<PRE>
mysql&#62; LOAD DATA INFILE 'persondata.txt'
    -&#62;           INTO TABLE persondata (col1,col2,...);
</PRE>

<P>
You must also specify a column list if the order of the fields in the input
file differs from the order of the columns in the table.  Otherwise,
MySQL cannot tell how to match up input fields with table columns.

</P>
<P>
If an input line has too many fields, the extra fields are ignored and
the number of warnings is incremented.

</P>
<P>
If an input line has too few fields, the table columns for which input
fields are missing are set to their default values.  Default value assignment
is described in section <A HREF="manual.html#CREATE_TABLE">14.2.5  <code>CREATE TABLE</code> Syntax</A>.

</P>
<P>
An empty field value is interpreted differently than if the field value
is missing:

</P>

<UL>
<LI>

For string types, the column is set to the empty string.

<LI>

For numeric types, the column is set to <code>0</code>.

<LI>

For date and time types, the column is set to the appropriate ``zero''
value for the type.
See section <A HREF="manual.html#Date_and_time_types">12.3  Date and Time Types</A>.
</UL>

<P>
These are the same values that result if you assign an empty
string explicitly to a string, numeric, or date or time type explicitly
in an <code>INSERT</code> or <code>UPDATE</code> statement.

</P>

<P>
<code>TIMESTAMP</code> columns are set to the current date and time only if there
is a <code>NULL</code> value for the column (that is, <code>\N</code>), or (for the
first <code>TIMESTAMP</code> column only) if the <code>TIMESTAMP</code> column is
omitted from the field list when a field list is specified.

</P>
<P>
<code>LOAD DATA INFILE</code> regards all input as strings, so you can't use
numeric values for <code>ENUM</code> or <code>SET</code> columns the way you can with
<code>INSERT</code> statements.  All <code>ENUM</code> and <code>SET</code> values must be
specified as strings!

</P>
<P>
When the <code>LOAD DATA INFILE</code>
statement finishes, it returns an information string in the following format:

</P>

<PRE>
Records: 1  Deleted: 0  Skipped: 0  Warnings: 0
</PRE>

<P>
<A NAME="IDX1540"></A>
If you are using the C API, you can get information about the statement by
calling the  <code>mysql_info()</code> function.
See section <A HREF="manual.html#mysql_info">21.2.3.30  <code>mysql_info()</code></A>.

</P>
<P>
Warnings occur under the same circumstances as when values are inserted
via the <code>INSERT</code> statement (see section <A HREF="manual.html#INSERT">14.1.4  <code>INSERT</code> Syntax</A>), except
that <code>LOAD DATA INFILE</code> also generates warnings when there are too few
or too many fields in the input row.  The warnings are not stored anywhere;
the number of warnings can be used only as an indication of whether everything went
well.

</P>
<P>
From MySQL 4.1.1 on, you can use <code>SHOW WARNINGS</code> to get a list of the
first <code>max_error_count</code> warnings as information about what went wrong.
See section <A HREF="manual.html#SHOW_WARNINGS">14.5.3.20  <code>SHOW WARNINGS</code> Syntax</A>.

</P>
<P>
Before MySQL 4.1.1, only a warning count is available to indicate that
something went wrong.  If you get warnings and want to know exactly why you
got them, one way to do this is to dump the table into another file using
<code>SELECT ... INTO OUTFILE</code> and compare the file to your original input
file.

</P>



<H3><A NAME="REPLACE" HREF="manual_toc.html#REPLACE">14.1.6  <code>REPLACE</code> Syntax</A></H3>

<P>
<A NAME="IDX1541"></A>

</P>

<PRE>
REPLACE [LOW_PRIORITY | DELAYED]
    [INTO] <var>tbl_name</var> [(<var>col_name</var>,...)]
    VALUES ({<var>expr</var> | DEFAULT},...),(...),...
</PRE>

<P>
Or:

<PRE>
REPLACE [LOW_PRIORITY | DELAYED]
    [INTO] <var>tbl_name</var>
    SET <var>col_name</var>={<var>expr</var> | DEFAULT}, ...
</PRE>

<P>
Or:

<PRE>
REPLACE [LOW_PRIORITY | DELAYED]
    [INTO] <var>tbl_name</var> [(<var>col_name</var>,...)]
    SELECT ...
</PRE>

<P>
<code>REPLACE</code> works exactly like <code>INSERT</code>, except that if an old
record in the table has the same value as a new record for a <code>PRIMARY
KEY</code> or a <code>UNIQUE</code> index, the old record is deleted before the new
record is inserted.
See section <A HREF="manual.html#INSERT">14.1.4  <code>INSERT</code> Syntax</A>.

</P>
<P>
Note that unless the table has a <code>PRIMARY KEY</code> or <code>UNIQUE</code> index,
using a <code>REPLACE</code> statement makes no sense. It becomes equivalent to
<code>INSERT</code>, because there is no index to be used to determine whether a new
row duplicates another.

</P>
<P>
Values for all columns are taken from the values specified in the
<code>REPLACE</code> statement.  Any missing columns are set to their default
values, just as happens for <code>INSERT</code>.  You can't refer to values from
the old row and use them in the new row.  It appeared that you could do this
in some old MySQL versions, but that was a bug that has been corrected.

</P>
<P>
To be able to use <code>REPLACE</code>, you must have <code>INSERT</code> and
<code>DELETE</code> privileges for the table.

</P>
<P>
The <code>REPLACE</code> statement returns a count to indicate the number of rows
affected. This is the sum of the rows deleted and inserted. If the count is 1
for a single-row <code>REPLACE</code>, a row was inserted and no rows were deleted.
If the count is greater than 1, one or more old rows were deleted before the
new row was inserted. It is possible for a single row to replace more than one
old row if the table contains multiple unique indexes and the new row
duplicates values for different old rows in different unique indexes.

</P>
<P>
The affected-rows count makes it easy to determine whether <code>REPLACE</code>
only added a row or whether it also replaced any rows: Check whether the
count is 1 (added) or greater (replaced).

</P>
<P>
If you are using the C API, the affected-rows count can be obtained using the
<code>mysql_affected_rows()</code> function.

</P>
<P>
Here follows in more detail the algorithm that is used
(it is also used with <code>LOAD DATA ... REPLACE</code>):

</P>

<OL>
<LI>

Try to insert the new row into the table
<LI>

While the insertion fails because a duplicate-key error occurs for a
primary or unique key:

<OL>
<LI>

Delete from the table the conflicting row that has the duplicate key value
<LI>

Try again to insert the new row into the table
</OL>

</OL>



<H3><A NAME="SELECT" HREF="manual_toc.html#SELECT">14.1.7  <code>SELECT</code> Syntax</A></H3>

<P>
<A NAME="IDX1542"></A>

</P>

<PRE>
SELECT
    [ALL | DISTINCT | DISTINCTROW ]
      [HIGH_PRIORITY]
      [STRAIGHT_JOIN]
      [SQL_SMALL_RESULT] [SQL_BIG_RESULT] [SQL_BUFFER_RESULT]
      [SQL_CACHE | SQL_NO_CACHE] [SQL_CALC_FOUND_ROWS]
    <var>select_expr</var>, ...
    [INTO OUTFILE '<var>file_name</var>' <var>export_options</var>
      | INTO DUMPFILE '<var>file_name</var>']
    [FROM <var>table_references</var>
      [WHERE <var>where_definition</var>]
      [GROUP BY {<var>col_name</var> | <var>expr</var> | <var>position</var>}
        [ASC | DESC], ... [WITH ROLLUP]]
      [HAVING <var>where_definition</var>]
      [ORDER BY {<var>col_name</var> | <var>expr</var> | <var>position</var>}
        [ASC | DESC] , ...]
      [LIMIT {[<var>offset</var>,] <var>row_count</var> | <var>row_count</var> OFFSET <var>offset</var>}]
      [PROCEDURE <var>procedure_name</var>(<var>argument_list</var>)]
      [FOR UPDATE | LOCK IN SHARE MODE]]
</PRE>

<P>
<code>SELECT</code> is used to retrieve rows selected from one or more tables.
Support for <code>UNION</code> statements and subqueries is available as of MySQL
4.0 and 4.1, respectively.
See section <A HREF="manual.html#UNION">14.1.7.2  <code>UNION</code> Syntax</A> and section <A HREF="manual.html#Subqueries">14.1.8  Subquery Syntax</A>.

</P>

<UL>
<LI>

Each <var>select_expr</var> indicates a column you want to retrieve.

<LI>

<var>table_references</var> indicates the table or tables from which to retrieve rows.
Its syntax is described in section <A HREF="manual.html#JOIN">14.1.7.1  <code>JOIN</code> Syntax</A>.

<LI>

<var>where_definition</var> consists of the keyword <code>WHERE</code> followed by
an expression that indicates the condition or conditions that rows
must satisfy to be selected.

</UL>

<P>
<code>SELECT</code> can also be used to retrieve rows computed without reference to
any table.  
For example:

</P>

<PRE>
mysql&#62; SELECT 1 + 1;
        -&#62; 2
</PRE>

<P>
All clauses used must be given in exactly the order shown in the syntax
description. For example,
a <code>HAVING</code> clause must come after any <code>GROUP BY</code> clause and before
any <code>ORDER BY</code> clause.

</P>

<UL>

<LI>

<A NAME="IDX1543"></A>
<A NAME="IDX1544"></A>
A <var>select_expr</var> can be given an alias using <code>AS alias_name</code>.
The alias is used as the expression's column name and can be used in
<code>GROUP BY</code>,
<code>ORDER BY</code>, or <code>HAVING</code> clauses.  For example:


<PRE>
mysql&#62; SELECT CONCAT(last_name,', ',first_name) AS full_name
    -&#62; FROM mytable ORDER BY full_name;
</PRE>

The <code>AS</code> keyword is optional when aliasing a <var>select_expr</var>.
The preceding example could have been written like this:


<PRE>
mysql&#62; SELECT CONCAT(last_name,', ',first_name) full_name
    -&#62; FROM mytable ORDER BY full_name;
</PRE>

Because the <code>AS</code> is optional, a subtle problem can occur
if you forget the comma between two <var>select_expr</var> expressions: MySQL
interprets the second as an alias name. For example, in the following
statement, <code>columnb</code> is treated as an alias name:


<PRE>
mysql&#62; SELECT columna columnb FROM mytable;
</PRE>

<LI>

It is not allowable to use a column alias in a <code>WHERE</code> clause,
because the column value might not yet be determined when the
<code>WHERE</code> clause is executed.
See section <A HREF="manual.html#Problems_with_alias">A.5.4  Problems with Column Aliases</A>.

<LI>

<A NAME="IDX1545"></A>
<A NAME="IDX1546"></A>
<A NAME="IDX1547"></A>
<A NAME="IDX1548"></A>
<A NAME="IDX1549"></A>
<A NAME="IDX1550"></A>
<A NAME="IDX1551"></A>
<A NAME="IDX1552"></A>
The <code>FROM table_references</code> clause indicates the tables from which to
retrieve rows. If you name more than one table, you are performing a
join.  For information on join syntax, see section <A HREF="manual.html#JOIN">14.1.7.1  <code>JOIN</code> Syntax</A>.
For each table specified, you can optionally specify an alias.


<PRE>
<var>tbl_name</var> [[AS] <var>alias</var>]
    [[USE INDEX (<var>key_list</var>)]
      | [IGNORE INDEX (<var>key_list</var>)]
      | [FORCE INDEX (<var>key_list</var>)]]
</PRE>

The use of
<code>USE INDEX</code>,
<code>IGNORE INDEX</code>,
<code>FORCE INDEX</code>
to give the optimizer hints about how to choose indexes is described in
section <A HREF="manual.html#JOIN">14.1.7.1  <code>JOIN</code> Syntax</A>.

In MySQL 4.0.14, you can use <code>SET max_seeks_for_key=<var>value</var></code> as an
alternative way to force MySQL to prefer key scans instead of table scans.

<LI>

You can refer to a table within the current database as <var>tbl_name</var>
(within the current database), or as <var>db_name.tbl_name</var> to explicitly
specify a database.  You can refer to a column as <var>col_name</var>,
<var>tbl_name.col_name</var>, or <var>db_name.tbl_name.col_name</var>.  You need not
specify a <var>tbl_name</var> or <var>db_name.tbl_name</var> prefix for a column
reference unless the reference would be ambiguous.  See section <A HREF="manual.html#Legal_names">10.2  Database, Table, Index, Column, and Alias Names</A>
for examples of ambiguity that require the more explicit column reference
forms.

<LI>

From MySQL 4.1.0 on, you are allowed to specify <code>DUAL</code> as a dummy
table name in situations where no tables are referenced:


<PRE>
mysql&#62; SELECT 1 + 1 FROM DUAL;
        -&#62; 2
</PRE>

<code>DUAL</code> is purely a compatibility feature. Some other servers require
this syntax.

<LI>

<A NAME="IDX1553"></A>
<A NAME="IDX1554"></A>
A table reference can be aliased using <code><var>tbl_name</var> AS <var>alias_name</var></code> or
<var>tbl_name alias_name</var>:


<PRE>
mysql&#62; SELECT t1.name, t2.salary FROM employee AS t1, info AS t2
    -&#62;     WHERE t1.name = t2.name;
mysql&#62; SELECT t1.name, t2.salary FROM employee t1, info t2
    -&#62;     WHERE t1.name = t2.name;
</PRE>

<LI>

In the <code>WHERE</code> clause, you can use any of the functions that
MySQL supports, except for aggregate (summary) functions.
See section <A HREF="manual.html#Functions">13  Functions and Operators</A>.

<LI>

<A NAME="IDX1555"></A>
Columns selected for output can be referred to in <code>ORDER BY</code> and
<code>GROUP BY</code> clauses using column names, column aliases, or column
positions.  Column positions are integers and begin with 1:


<PRE>
mysql&#62; SELECT college, region, seed FROM tournament
    -&#62;     ORDER BY region, seed;
mysql&#62; SELECT college, region AS r, seed AS s FROM tournament
    -&#62;     ORDER BY r, s;
mysql&#62; SELECT college, region, seed FROM tournament
    -&#62;     ORDER BY 2, 3;
</PRE>

To sort in reverse order, add the <code>DESC</code> (descending) keyword to the
name of the column in the <code>ORDER BY</code> clause that you are sorting by.
The default is ascending order; this can be specified explicitly using
the <code>ASC</code> keyword.

Use of column positions is deprecated because the syntax has been removed from
the SQL standard.

<LI>

<A NAME="IDX1556"></A>
If you use <code>GROUP BY</code>, output rows are sorted according to the
<code>GROUP BY</code> columns as if you had an <code>ORDER BY</code> for the same columns.
MySQL has extended the <code>GROUP BY</code> clause as of version 3.23.34 so that
you can also specify <code>ASC</code> and <code>DESC</code> after columns named in the
clause:


<PRE>
SELECT a, COUNT(b) FROM test_table GROUP BY a DESC
</PRE>

<LI>

MySQL extends the use of <code>GROUP BY</code> to allow you to
select fields that are not mentioned in the <code>GROUP BY</code> clause.
If you are not getting the results you expect from your query, please
read the <code>GROUP BY</code> description.
See section <A HREF="manual.html#Group_by_functions_and_modifiers">13.9  Functions and Modifiers for Use with <code>GROUP BY</code> Clauses</A>.

<LI>

As of MySQL 4.1.1, <code>GROUP BY</code> allows a <code>WITH ROLLUP</code> modifier.
See section <A HREF="manual.html#GROUP-BY-Modifiers">13.9.2  <code>GROUP BY</code> Modifiers</A>.

<LI>

The <code>HAVING</code> clause can refer to any column or alias named in a
<var>select_expr</var>. It is applied nearly last, just before items are
sent to the client, with no optimization.
(<code>LIMIT</code> is applied after <code>HAVING</code>.)

<LI>

Don't use <code>HAVING</code> for items that
should be in the <code>WHERE</code> clause.  For example, do not write this:


<PRE>
mysql&#62; SELECT <var>col_name</var> FROM <var>tbl_name</var> HAVING <var>col_name</var> &#62; 0;
</PRE>

Write this instead:


<PRE>
mysql&#62; SELECT <var>col_name</var> FROM <var>tbl_name</var> WHERE <var>col_name</var> &#62; 0;
</PRE>

<LI>

The <code>HAVING</code> clause can refer to aggregate functions, which the
<code>WHERE</code> clause cannot:


<PRE>
mysql&#62; SELECT user, MAX(salary) FROM users
    -&#62;     GROUP BY user HAVING MAX(salary)&#62;10;
</PRE>

However, that does not work in older MySQL servers (before version 3.22.5).
Instead, you can use a column alias in the select list and refer to the
alias in the <code>HAVING</code> clause:


<PRE>
mysql&#62; SELECT user, MAX(salary) AS max_salary FROM users
    -&#62;     GROUP BY user HAVING max_salary&#62;10;
</PRE>

<LI>

The <code>LIMIT</code> clause can be used to constrain the number of rows returned
by the <code>SELECT</code> statement.  <code>LIMIT</code> takes one or two numeric
arguments, which must be integer constants.

With two arguments, the first argument specifies the offset of the first row to
return, and the second specifies the maximum number of rows to return.
The offset of the initial row is 0 (not 1):


<PRE>
mysql&#62; SELECT * FROM table LIMIT 5,10;  # Retrieve rows 6-15
</PRE>

For
compatibility with PostgreSQL, MySQL also supports the
<code>LIMIT <var>row_count</var> OFFSET <var>offset</var></code> syntax.

To retrieve all rows from a certain offset up to the end of the result set,
you can use some large number for the second parameter. This statement
retrieves all rows from the 96th row to the last:


<PRE>
mysql&#62; SELECT * FROM table LIMIT 95,18446744073709551615;
</PRE>

With one argument, the value specifies the number of rows to return from the
beginning of the result set:


<PRE>
mysql&#62; SELECT * FROM table LIMIT 5;     # Retrieve first 5 rows
</PRE>

In other words, <code>LIMIT n</code> is equivalent to <code>LIMIT 0,n</code>.

<LI>

<A NAME="IDX1557"></A>
The <code>SELECT ... INTO OUTFILE 'file_name'</code> form of <code>SELECT</code> writes
the selected rows to a file. The file is created on the server host, so you
must have the <code>FILE</code> privilege to use this syntax.  The
file cannot already exist, which among other things prevents files such as
<tt>`/etc/passwd'</tt> and database tables from being destroyed.

The <code>SELECT ... INTO OUTFILE</code> statement is intended primarily to let
you very quickly dump a table on the server machine. If you want to create
the resulting file on some client host other than the server host, you can't use
<code>SELECT ... INTO OUTFILE</code>. In that case, you should instead use some
command like <code>mysql -e "SELECT ..." &#62; file_name</code> on the client host to generate the file.

<code>SELECT ...  INTO OUTFILE</code> is the complement of <code>LOAD DATA
INFILE</code>; the syntax for the <code>export_options</code> part of the statement
consists of the same <code>FIELDS</code> and <code>LINES</code> clauses that are used
with the <code>LOAD DATA INFILE</code> statement.
See section <A HREF="manual.html#LOAD_DATA">14.1.5  <code>LOAD DATA INFILE</code> Syntax</A>.

<code>FIELDS ESCAPED BY</code> controls how to write special characters.
If the <code>FIELDS ESCAPED BY</code> character is not empty, it is used to prefix
the following characters on output:

<UL>
<LI>

The <code>FIELDS ESCAPED BY</code> character
<LI>

The <code>FIELDS [OPTIONALLY] ENCLOSED BY</code> character
<LI>

The first character of the <code>FIELDS TERMINATED BY</code> and
<code>LINES TERMINATED BY</code> values
<LI>

ASCII <code>0</code> (what is actually written following the escape character is
ASCII <samp>`0'</samp>, not a zero-valued byte)
</UL>

If the <code>FIELDS ESCAPED BY</code> character is empty, no characters are
escaped and <code>NULL</code> is output as <code>NULL</code>, not <code>\N</code>.  It is
probably not a good idea to specify an empty escape character,
particularly if field values in your data contain any of the characters
in the list just given.

The reason for the above is that you <em>must</em> escape any <code>FIELDS
TERMINATED BY</code>, <code>ENCLOSED BY</code>, <code>ESCAPED BY</code>, or <code>LINES TERMINATED BY</code>
characters to reliably be able to read the file back. ASCII NUL is
escaped to make it easier to view with some pagers.

The resulting file doesn't have to conform to SQL syntax, so nothing
else need be escaped.

Here is an example that produces a file in the comma-separated values format
used by many programs:


<PRE>
SELECT a,b,a+b INTO OUTFILE '/tmp/result.text'
FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"'
LINES TERMINATED BY '\n'
FROM test_table;
</PRE>

<LI>

<A NAME="IDX1558"></A>
If you use <code>INTO DUMPFILE</code> instead of <code>INTO OUTFILE</code>, MySQL writes
only one row into the file, without any column or line termination and
without performing any escape processing.  This is useful if you want to
store a <code>BLOB</code> value in a file.

<LI>

<strong>Note</strong>: Any file created by <code>INTO OUTFILE</code> or <code>INTO
DUMPFILE</code> is writable by all users on the server host.  The reason for
this is that the MySQL server can't create a file that is owned by anyone
other than the user it's running as (you should never run <code>mysqld</code> as
<code>root</code>).  The file thus must be world-writable so that you can
manipulate its contents.

<LI>

A <code>PROCEDURE</code> clause names a procedure that should process the data
in the result set.  For an example, see section <A HREF="manual.html#procedure_analyse">23.3.1  Procedure Analyse</A>.

<LI>

If you use <code>FOR UPDATE</code> on a storage engine that uses page or row locks,
rows examined by the query are write-locked until the end of the current
transaction.  Using <code>IN SHARE MODE</code> sets a shared lock that prevents
other transactions from updating or deleting the examined rows.
See section <A HREF="manual.html#InnoDB_locking_reads">16.11.4  Locking Reads <code>SELECT ... FOR UPDATE</code> and <code>SELECT ... LOCK IN SHARE MODE</code></A>.

</UL>

<P>
Following the <code>SELECT</code> keyword, you can give a number of options
that affect the operation of the statement.

</P>
<P>
The <code>ALL</code>, <code>DISTINCT</code>, and <code>DISTINCTROW</code> options specify
whether duplicate rows should be returned. If none of these options are
given, the default is <code>ALL</code> (all matching rows are returned).
<code>DISTINCT</code> and <code>DISTINCTROW</code> are synonyms and specify that
duplicate rows in the result set should be removed.

</P>
<P>
<code>HIGH_PRIORITY</code>, <code>STRAIGHT_JOIN</code>, and options beginning with
<code>SQL_</code> are MySQL extensions to standard SQL.

</P>

<UL>

<LI>

<code>HIGH_PRIORITY</code> will give the <code>SELECT</code> higher priority than
a statement that updates a table.  You should use this only for queries
that are very fast and must be done at once.  A <code>SELECT HIGH_PRIORITY</code>
query that is issued while the table is locked for reading will run even if
there is already an update statement waiting for the table to be free.

<code>HIGH_PRIORITY</code> cannot be used with <code>SELECT</code> statements that
are part of a <code>UNION</code>.

<LI>

<A NAME="IDX1559"></A>
<code>STRAIGHT_JOIN</code> forces the optimizer to join the tables in the order in
which they are listed in the <code>FROM</code> clause. You can use this to speed up
a query if the optimizer joins the tables in non-optimal order.
See section <A HREF="manual.html#EXPLAIN">7.2.1  <code>EXPLAIN</code> Syntax (Get Information About a <code>SELECT</code>)</A>.
<code>STRAIGHT_JOIN</code> also can be used in the <var>table_references</var> list.
See section <A HREF="manual.html#JOIN">14.1.7.1  <code>JOIN</code> Syntax</A>.

<LI>

<code>SQL_BIG_RESULT</code> can be used with <code>GROUP BY</code> or <code>DISTINCT</code>
to tell the optimizer that the result set will have many rows.  In this case,
MySQL will directly use disk-based temporary tables if needed.
MySQL will also, in this case, prefer sorting to using a
temporary table with a key on the <code>GROUP BY</code> elements.

<LI>

<code>SQL_BUFFER_RESULT</code> forces the result to be put into a temporary
table. This helps MySQL free the table locks early and helps
in cases where it takes a long time to send the result set to the client.

<LI>

<code>SQL_SMALL_RESULT</code> can be used
with <code>GROUP BY</code> or <code>DISTINCT</code> to tell the optimizer that the
result set will be small.  In this case, MySQL uses fast
temporary tables to store the resulting table instead of using sorting. In
MySQL 3.23 and up, this shouldn't normally be needed.

<LI>

<code>SQL_CALC_FOUND_ROWS</code> (available in MySQL 4.0.0 and up) tells MySQL
to calculate how many rows there would be in the result set, disregarding
any <code>LIMIT</code> clause.  The number of rows can then be retrieved with
<code>SELECT FOUND_ROWS()</code>.
See section <A HREF="manual.html#Information_functions">13.8.3  Information Functions</A>.

Before MySQL 4.1.0, this option does not work with
<code>LIMIT 0</code>, which is optimized to return instantly (resulting in a
row count of 0).
See section <A HREF="manual.html#LIMIT_optimisation">7.2.10  How MySQL Optimizes <code>LIMIT</code></A>.

<LI>

<code>SQL_CACHE</code> tells MySQL to store the query result in the query cache if
you are using a <code>query_cache_type</code> value of <code>2</code> or <code>DEMAND</code>.
For a query that uses <code>UNION</code> or subqueries, this option takes effect
to be used in any <code>SELECT</code> of the query.
See section <A HREF="manual.html#Query_Cache">5.10  The MySQL Query Cache</A>.

<LI>

<code>SQL_NO_CACHE</code> tells MySQL not to store the query result
in the query cache. See section <A HREF="manual.html#Query_Cache">5.10  The MySQL Query Cache</A>.
For a query that uses <code>UNION</code> or subqueries, this
option takes effect to be used in any <code>SELECT</code> of the query.

</UL>



<H4><A NAME="JOIN" HREF="manual_toc.html#JOIN">14.1.7.1  <code>JOIN</code> Syntax</A></H4>

<P>
<A NAME="IDX1560"></A>
<A NAME="IDX1561"></A>
<A NAME="IDX1562"></A>
<A NAME="IDX1563"></A>
<A NAME="IDX1564"></A>
<A NAME="IDX1565"></A>
<A NAME="IDX1566"></A>
<A NAME="IDX1567"></A>
<A NAME="IDX1568"></A>
<A NAME="IDX1569"></A>
<A NAME="IDX1570"></A>
<A NAME="IDX1571"></A>

</P>
<P>
MySQL supports the following <code>JOIN</code> syntaxes for the
<var>table_references</var> part of <code>SELECT</code> statements and multiple-table
<code>DELETE</code> and <code>UPDATE</code> statements:

</P>

<PRE>
<var>table_reference</var>, <var>table_reference</var>
<var>table_reference</var> [INNER | CROSS] JOIN <var>table_reference</var> [<var>join_condition</var>]
<var>table_reference</var> STRAIGHT_JOIN <var>table_reference</var>
<var>table_reference</var> LEFT [OUTER] JOIN <var>table_reference</var> [<var>join_condition</var>]
<var>table_reference</var> NATURAL [LEFT [OUTER]] JOIN <var>table_reference</var>
{ OJ <var>table_reference</var> LEFT OUTER JOIN <var>table_reference</var>
    ON <var>conditional_expr</var> }
<var>table_reference</var> RIGHT [OUTER] JOIN <var>table_reference</var> [<var>join_condition</var>]
<var>table_reference</var> NATURAL [RIGHT [OUTER]] JOIN <var>table_reference</var>
</PRE>

<P>
<var>table_reference</var> is defined as:

</P>
<P>
<A NAME="IDX1572"></A>

<PRE>
<var>tbl_name</var> [[AS] <var>alias</var>]
    [[USE INDEX (<var>key_list</var>)]
      | [IGNORE INDEX (<var>key_list</var>)]
      | [FORCE INDEX (<var>key_list</var>)]]
</PRE>

<P>
<var>join_condition</var> is defined as:

</P>

<PRE>
ON <var>conditional_expr</var> | USING (<var>column_list</var>)
</PRE>

<P>
You should generally not have any conditions in the <code>ON</code> part that are
used to restrict which rows you want in the result set, but rather specify
these conditions in the <code>WHERE</code> clause. There are exceptions to this rule.

</P>
<P>
Note that <code>INNER JOIN</code> syntax allows a <code>join_condition</code> only from
MySQL 3.23.17 on.  The same is true for <code>JOIN</code> and <code>CROSS JOIN</code> only
as of MySQL 4.0.11.

</P>
<P>
<A NAME="IDX1573"></A>
<A NAME="IDX1574"></A>
The <code>{ OJ ... LEFT OUTER JOIN ...}</code> syntax shown in the preceding list
exists only for compatibility with ODBC.

</P>

<UL>
<LI>

A table reference can be aliased using <code><var>tbl_name</var> AS <var>alias_name</var></code> or
<var>tbl_name alias_name</var>:


<PRE>
mysql&#62; SELECT t1.name, t2.salary FROM employee AS t1, info AS t2
    -&#62;        WHERE t1.name = t2.name;
mysql&#62; SELECT t1.name, t2.salary FROM employee t1, info t2
    -&#62;        WHERE t1.name = t2.name;
</PRE>

<LI>

The <code>ON</code> conditional is any conditional expression of the form that can
be used in a <code>WHERE</code> clause.

<LI>

If there is no matching record for the right table in the <code>ON</code> or
<code>USING</code> part in a <code>LEFT JOIN</code>, a row with all columns set to
<code>NULL</code> is used for the right table.  You can use this fact to find
records in a table that have no counterpart in another table:


<PRE>
mysql&#62; SELECT table1.* FROM table1
    -&#62;        LEFT JOIN table2 ON table1.id=table2.id
    -&#62;        WHERE table2.id IS NULL;
</PRE>

This example finds all rows in <code>table1</code> with an <code>id</code> value that is
not present in <code>table2</code> (that is, all rows in <code>table1</code> with no
corresponding row in <code>table2</code>).  This assumes that <code>table2.id</code> is
declared <code>NOT NULL</code>.
See section <A HREF="manual.html#LEFT_JOIN_optimisation">7.2.8  How MySQL Optimizes <code>LEFT JOIN</code> and <code>RIGHT JOIN</code></A>.

<LI>

The <code>USING</code> <code>(column_list)</code> clause names a list of columns that must
exist in both tables. The following two clauses are semantically identical:


<PRE>
a LEFT JOIN b USING (c1,c2,c3)
a LEFT JOIN b ON a.c1=b.c1 AND a.c2=b.c2 AND a.c3=b.c3
</PRE>

<LI>

The <code>NATURAL [LEFT] JOIN</code> of two tables is defined to be
semantically equivalent to an <code>INNER JOIN</code> or a <code>LEFT JOIN</code>
with a <code>USING</code> clause that names all columns that exist in both
tables.

<LI>

<A NAME="IDX1575"></A>
<code>INNER JOIN</code> and <code>,</code> (comma) are semantically equivalent in
the absence of a join condition: both will produce a Cartesian product
between the specified tables (that is, each and every row in the first table
will be joined onto all rows in the second table).

<LI>

<code>RIGHT JOIN</code> works analogously to <code>LEFT JOIN</code>.  To keep code
portable across databases, it's recommended to use <code>LEFT JOIN</code>
instead of <code>RIGHT JOIN</code>.

<LI>

<A NAME="IDX1576"></A>
<code>STRAIGHT_JOIN</code> is identical to <code>JOIN</code>, except that the left table
is always read before the right table. This can be used for those (few)
cases for which the join optimizer puts the tables in the wrong order.

</UL>

<P>
<A NAME="IDX1577"></A>
<A NAME="IDX1578"></A>
<A NAME="IDX1579"></A>
As of MySQL 3.23.12, you can give hints about which index MySQL
should use when retrieving information from a table.  By specifying
<code>USE INDEX (key_list)</code>, you can tell MySQL to use only one of the
possible indexes to find rows in the table.  The alternative syntax
<code>IGNORE INDEX (key_list)</code> can be used to tell MySQL to not use some
particular index.  These hints are useful if <code>EXPLAIN</code> shows that MySQL
is using the wrong index from the list of possible indexes.

</P>
<P>
<A NAME="IDX1580"></A>
From MySQL 4.0.9 on, you can also use <code>FORCE INDEX</code>. This acts likes
<code>USE INDEX (key_list)</code> but with the addition that a table scan
is assumed to be <em>very</em> expensive.  In other words, a table scan will
only be used if there is no way to use one of the given indexes to
find rows in the table.

</P>
<P>
<A NAME="IDX1581"></A>
<A NAME="IDX1582"></A>
<A NAME="IDX1583"></A>
<code>USE KEY</code>, <code>IGNORE KEY</code>, and <code>FORCE KEY</code> are synonyms for
<code>USE INDEX</code>, <code>IGNORE INDEX</code>, and <code>FORCE INDEX</code>.

</P>
<P>
<strong>Note</strong>: <code>USE INDEX</code>, <code>IGNORE INDEX</code>, and <code>FORCE INDEX</code>
only affect which indexes are used when MySQL decides how to find rows in
the table and how to do the join. They do not affect whether an index will
be used when resolving an <code>ORDER BY</code> or <code>GROUP BY</code>.

</P>
<P>
Some join examples:

</P>

<PRE>
mysql&#62; SELECT * FROM table1,table2 WHERE table1.id=table2.id;
mysql&#62; SELECT * FROM table1 LEFT JOIN table2 ON table1.id=table2.id;
mysql&#62; SELECT * FROM table1 LEFT JOIN table2 USING (id);
mysql&#62; SELECT * FROM table1 LEFT JOIN table2 ON table1.id=table2.id
    -&#62;          LEFT JOIN table3 ON table2.id=table3.id;
mysql&#62; SELECT * FROM table1 USE INDEX (key1,key2)
    -&#62;          WHERE key1=1 AND key2=2 AND key3=3;
mysql&#62; SELECT * FROM table1 IGNORE INDEX (key3)
    -&#62;          WHERE key1=1 AND key2=2 AND key3=3;
</PRE>

<P>
See section <A HREF="manual.html#LEFT_JOIN_optimisation">7.2.8  How MySQL Optimizes <code>LEFT JOIN</code> and <code>RIGHT JOIN</code></A>.

</P>



<H4><A NAME="UNION" HREF="manual_toc.html#UNION">14.1.7.2  <code>UNION</code> Syntax</A></H4>

<P>
<A NAME="IDX1584"></A>

</P>

<PRE>
SELECT ...
UNION [ALL | DISTINCT]
SELECT ...
  [UNION [ALL | DISTINCT]
   SELECT ...]
</PRE>

<P>
<code>UNION</code> is used to combine the result from many <code>SELECT</code>
statements into one result set.  <code>UNION</code> is available from MySQL 4.0.0
on.

</P>
<P>
Selected columns listed in corresponding positions of each <code>SELECT</code>
statement should have the same type. (For example, the first column selected
by the first statement should have the same type as the first column selected
by the other statements.) The column names used in
the first <code>SELECT</code> statement are used as the column names for the
results returned.

</P>
<P>
The <code>SELECT</code> statements are normal select statements, but with the following
restrictions:

</P>

<UL>
<LI>

Only the last <code>SELECT</code> statement can have <code>INTO OUTFILE</code>.
<LI>

<code>HIGH_PRIORITY</code> cannot be used with <code>SELECT</code> statements that
are part of a <code>UNION</code>. If you specify it for the first <code>SELECT</code>,
it has no effect. If you specify it for any subsequent <code>SELECT</code>
statements, a syntax error results.
</UL>

<P>
If you don't use the keyword <code>ALL</code> for the <code>UNION</code>, all
returned rows will be unique, as if you had done a <code>DISTINCT</code> for
the total result set.  If you specify <code>ALL</code>, you will get all
matching rows from all the used <code>SELECT</code> statements.

</P>
<P>
The <code>DISTINCT</code> keyword is an optional word (introduced in MySQL 4.0.17).
It does nothing, but is allowed in the syntax as required by the SQL standard.

</P>
<P>
Before MySQL 4.1.2, you cannot mix <code>UNION ALL</code> and <code>UNION
DISTINCT</code> in the same query.  If you use <code>ALL</code> for one
<code>UNION</code>, it is used for all of them. As of MySQL 4.1.2, mixed
<code>UNION</code> types are treated such that a <code>DISTINCT</code> union overrides
any <code>ALL</code> union to its left. A <code>DISTINCT</code> union can be produced
explicitly by using <code>UNION DISTINCT</code> or implicitly by using <code>UNION</code>
with no following <code>DISTINCT</code> or <code>ALL</code> keyword.

</P>
<P>
If you want to use an <code>ORDER BY</code> to sort the entire <code>UNION</code> result,
you should use parentheses:

</P>

<PRE>
(SELECT a FROM <var>tbl_name</var> WHERE a=10 AND B=1 ORDER BY a LIMIT 10)
UNION
(SELECT a FROM <var>tbl_name</var> WHERE a=11 AND B=2 ORDER BY a LIMIT 10)
ORDER BY a;
</PRE>

<P>
The types and lengths of the columns in the result set of a <code>UNION</code>
take into account the values retrieved by all the <code>SELECT</code> statements.
Before MySQL 4.1.1, a limitation of <code>UNION</code> is that only the values from
the first <code>SELECT</code> are used to determine result column types and lengths.
This could result in value truncation if, for example, the first
<code>SELECT</code> retrieves shorter values than the second <code>SELECT</code>:

</P>

<PRE>
mysql&#62; SELECT REPEAT('a',1) UNION SELECT REPEAT('b',10);
+---------------+
| REPEAT('a',1) |
+---------------+
| a             |
| b             |
+---------------+
</PRE>

<P>
That limitation has been removed as of MySQL 4.1.1:

</P>

<PRE>
mysql&#62; SELECT REPEAT('a',1) UNION SELECT REPEAT('b',10);
+---------------+
| REPEAT('a',1) |
+---------------+
| a             |
| bbbbbbbbbb    |
+---------------+
</PRE>



<H3><A NAME="Subqueries" HREF="manual_toc.html#Subqueries">14.1.8  Subquery Syntax</A></H3>

<P>
<A NAME="IDX1585"></A>
<A NAME="IDX1586"></A>
<A NAME="IDX1587"></A>
<A NAME="IDX1588"></A>
<A NAME="IDX1589"></A>
<A NAME="IDX1590"></A>

</P>
<P>
A subquery is a <code>SELECT</code> statement inside another statement.

</P>
<P>
Starting with MySQL 4.1, all subquery forms and operations that the SQL
standard requires are supported, as well as a few features that are
MySQL-specific.

</P>
<P>
With earlier MySQL versions, it was necessary to work around or avoid the
use of subqueries, but people starting to write code now will find that
subqueries are a very useful part of the MySQL toolkit.

</P>
<P>
For MySQL versions prior to 4.1, most subqueries can be successfully
rewritten using joins and other methods.
See section <A HREF="manual.html#Rewriting_subqueries">14.1.8.11  Rewriting Subqueries as Joins for Earlier MySQL Versions</A>.

</P>
<P>
Here is an example of a subquery:

</P>

<PRE>
SELECT * FROM t1 WHERE column1 = (SELECT column1 FROM t2);
</PRE>

<P>
In this example, <code>SELECT * FROM t1 ...</code> is the <em>outer query</em>
(or <em>outer statement</em>), and <code>(SELECT column1 FROM t2)</code> is the
<em>subquery</em>.
We say that the subquery is <em>nested</em> in the outer query, and in fact
it's possible to nest subqueries within other subqueries, to a great depth.
A subquery must always appear within parentheses.

</P>
<P>
The main advantages of subqueries are:

</P>

<UL>
<LI>

They allow queries that are <em>structured</em> so that it's possible to
isolate each part of a statement.
<LI>

They provide alternative ways to perform operations that would otherwise
require complex joins and unions.
<LI>

They are, in many people's opinion, readable.
Indeed, it was the innovation of subqueries that gave people the original
idea of calling the early SQL ``Structured Query Language.''
</UL>

<P>
Here is an example statement that shows the major points about subquery
syntax as specified by the SQL standard and supported in MySQL:

</P>

<PRE>
DELETE FROM t1
WHERE s11 &#62; ANY
 (SELECT COUNT(*) /* no hint */ FROM t2
 WHERE NOT EXISTS
  (SELECT * FROM t3
   WHERE ROW(5*t2.s1,77)=
    (SELECT 50,11*s1 FROM t4 UNION SELECT 50,77 FROM
     (SELECT * FROM t5) AS t5)));
</PRE>



<H4><A NAME="Scalar_subqueries" HREF="manual_toc.html#Scalar_subqueries">14.1.8.1  The Subquery as Scalar Operand</A></H4>

<P>
In its simplest form (the <em>scalar</em> subquery as opposed to the
<em>row</em> or <em>table</em> subqueries that are discussed later),
a subquery is a simple operand. Thus, you can use it wherever a column value
or literal is legal, and you can expect it to have those characteristics
that all operands have: a data type, a length, an indication whether it can
be <code>NULL</code>, and so on.
For example:

</P>

<PRE>
CREATE TABLE t1 (s1 INT, s2 CHAR(5) NOT NULL);
SELECT (SELECT s2 FROM t1);
</PRE>

<P>
The subquery in this <code>SELECT</code> has a data type of <code>CHAR</code>,
a length of 5, a character set and collation equal to the defaults in
effect at <code>CREATE TABLE</code> time, and an indication that the value in
the column can be <code>NULL</code>. In fact, almost all subqueries can be
<code>NULL</code>, because if the table is empty, as in the example,
the value of the subquery will be <code>NULL</code>.
There are few restrictions.

</P>

<UL>
<LI>

A subquery's outer statement can be any one of:
<code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>,
<code>SET</code>, or <code>DO</code>.
<LI>

A subquery can contain any of the keywords or clauses that an ordinary
<code>SELECT</code> can contain:
<code>DISTINCT</code>, <code>GROUP BY</code>, <code>ORDER BY</code>, <code>LIMIT</code>,
joins, hints, <code>UNION</code> constructs, comments, functions, and so on.
</UL>

<P>
So, when you see examples in the following sections that contain the rather
spartan construct <code>(SELECT column1 FROM t1)</code>, imagine that your own
code will contain much more diverse and complex constructions.

</P>
<P>
For example, suppose that we make two tables:

</P>

<PRE>
CREATE TABLE t1 (s1 INT);
INSERT INTO t1 VALUES (1);
CREATE TABLE t2 (s1 INT);
INSERT INTO t2 VALUES (2);
</PRE>

<P>
Then perform a <code>SELECT</code>:

</P>

<PRE>
SELECT (SELECT s1 FROM t2) FROM t1;
</PRE>

<P>
The result will be <code>2</code> because there is a row in <code>t2</code> containing a
column <code>s1</code> that has a value of <code>2</code>.

</P>
<P>
The subquery can be part of an expression. If it is an operand for a
function, don't forget the parentheses.
For example:

</P>

<PRE>
SELECT UPPER((SELECT s1 FROM t1)) FROM t2;
</PRE>



<H4><A NAME="Comparisons_using_subqueries" HREF="manual_toc.html#Comparisons_using_subqueries">14.1.8.2  Comparisons Using Subqueries</A></H4>

<P>
The most common use of a subquery is in the form:

</P>

<PRE>
<var>non_subquery_operand</var> <var>comparison_operator</var> (<var>subquery</var>)
</PRE>

<P>
Where <code>comparison_operator</code> is one of:

<PRE>
=  &#62;  &#60;  &#62;=  &#60;=  &#60;&#62;
</PRE>

<P>
For example:

<PRE>
... 'a' = (SELECT column1 FROM t1)
</PRE>

<P>
At one time the only legal place for a subquery was on the right side of a
comparison, and you might still find some old DBMSs that insist on this.

</P>
<P>
Here is an example of a common-form subquery comparison that you cannot do
with a join. It finds all the values in table <code>t1</code> that are equal to a
maximum value in table <code>t2</code>:

</P>

<PRE>
SELECT column1 FROM t1
       WHERE column1 = (SELECT MAX(column2) FROM t2);
</PRE>

<P>
Here is another example, which again is impossible with a join because it
involves aggregating for one of the tables. It finds all rows in table
<code>t1</code> containing a value that occurs twice:

</P>

<PRE>
SELECT * FROM t1
       WHERE 2 = (SELECT COUNT(column1) FROM t1);
</PRE>



<H4><A NAME="ANY_IN_SOME_subqueries" HREF="manual_toc.html#ANY_IN_SOME_subqueries">14.1.8.3  Subqueries with <code>ANY</code>, <code>IN</code>, and <code>SOME</code></A></H4>

<P>
Syntax:

<PRE>
<var>operand</var> <var>comparison_operator</var> ANY (<var>subquery</var>)
<var>operand</var> IN (<var>subquery</var>)
<var>operand</var> <var>comparison_operator</var> SOME (<var>subquery</var>)
</PRE>

<P>
The <code>ANY</code> keyword, which must follow a comparison operator, means
``return <code>TRUE</code> if the comparison is <code>TRUE</code> for <code>ANY</code> of the
rows that the subquery returns.''
For example:

</P>

<PRE>
SELECT s1 FROM t1 WHERE s1 &#62; ANY (SELECT s1 FROM t2);
</PRE>

<P>
Suppose that there is a row in table <code>t1</code> containing <code>(10)</code>.
The expression is <code>TRUE</code> if table <code>t2</code> contains <code>(21,14,7)</code>
because there is a value <code>7</code> in <code>t2</code> that is less than <code>10</code>.
The expression is <code>FALSE</code> if table <code>t2</code> contains <code>(20,10)</code>,
or if table <code>t2</code> is empty.  The expression is <code>UNKNOWN</code> if table
<code>t2</code> contains <code>(NULL,NULL,NULL)</code>.

</P>
<P>
The word <code>IN</code> is an alias for <code>= ANY</code>. Thus these two statements
are the same:

</P>

<PRE>
SELECT s1 FROM t1 WHERE s1 = ANY (SELECT s1 FROM t2);
SELECT s1 FROM t1 WHERE s1 IN    (SELECT s1 FROM t2);
</PRE>

<P>
However, <code>NOT IN</code> is not an alias for <code>&#60;&#62; ANY</code>, but for
<code>&#60;&#62; ALL</code>. See section <A HREF="manual.html#ALL_subqueries">14.1.8.4  Subqueries with <code>ALL</code></A>.

</P>
<P>
The word <code>SOME</code> is an alias for <code>ANY</code>. Thus these two statements
are the same:

</P>

<PRE>
SELECT s1 FROM t1 WHERE s1 &#60;&#62; ANY  (SELECT s1 FROM t2);
SELECT s1 FROM t1 WHERE s1 &#60;&#62; SOME (SELECT s1 FROM t2);
</PRE>

<P>
Use of the word <code>SOME</code> is rare, but this example shows why it might be
useful. To most people's ears, the English phrase ``a is not equal to any
b'' means ``there is no b which is equal to a,'' but that isn't what is
meant by the SQL syntax. Using <code>&#60;&#62; SOME</code> instead helps ensure that
everyone understands the true meaning of the query.

</P>



<H4><A NAME="ALL_subqueries" HREF="manual_toc.html#ALL_subqueries">14.1.8.4  Subqueries with <code>ALL</code></A></H4>

<P>
Syntax:

<PRE>
<var>operand</var> <var>comparison_operator</var> ALL (<var>subquery</var>)
</PRE>

<P>
The word <code>ALL</code>, which must follow a comparison operator, means
``return <code>TRUE</code> if the comparison is <code>TRUE</code> for <code>ALL</code> of
the rows that the subquery returns.''
For example:

</P>

<PRE>
SELECT s1 FROM t1 WHERE s1 &#62; ALL (SELECT s1 FROM t2);
</PRE>

<P>
Suppose that there is a row in table <code>t1</code> containing <code>(10)</code>.
The expression is <code>TRUE</code> if table <code>t2</code> contains <code>(-5,0,+5)</code>
because <code>10</code> is greater than all three values in <code>t2</code>.
The expression is <code>FALSE</code> if table <code>t2</code> contains
<code>(12,6,NULL,-100)</code> because there is a single value <code>12</code> in table <code>t2</code>
that is greater than <code>10</code>.
The expression is <code>UNKNOWN</code> if table <code>t2</code> contains <code>(0,NULL,1)</code>.

</P>
<P>
Finally, if table <code>t2</code> is empty, the result is <code>TRUE</code>.
You might think the result should be <code>UNKNOWN</code>, but
sorry, it's <code>TRUE</code>. So, rather oddly, the following statement
is <code>TRUE</code> when table <code>t2</code> is empty:

</P>

<PRE>
SELECT * FROM t1 WHERE 1 &#62; ALL (SELECT s1 FROM t2);
</PRE>

<P>
But this statement is <code>UNKNOWN</code> when table <code>t2</code> is empty:

</P>

<PRE>
SELECT * FROM t1 WHERE 1 &#62; (SELECT s1 FROM t2);
</PRE>

<P>
In addition, the following statement is <code>UNKNOWN</code> when table <code>t2</code>
is empty:

</P>

<PRE>
SELECT * FROM t1 WHERE 1 &#62; ALL (SELECT MAX(s1) FROM t2);
</PRE>

<P>
In general, <em>tables with <code>NULL</code> values</em> and <em>empty tables</em> are
<em>edge cases</em>. When writing subquery code, always consider whether
you have taken those two possibilities into account.

</P>
<P>
<code>NOT IN</code> is an alias for <code>&#60;&#62; ALL</code>. Thus these two statements
are the same:

</P>

<PRE>
SELECT s1 FROM t1 WHERE s1 &#60;&#62; ALL (SELECT s1 FROM t2);
SELECT s1 FROM t1 WHERE s1 NOT IN (SELECT s1 FROM t2);
</PRE>



<H4><A NAME="Correlated_subqueries" HREF="manual_toc.html#Correlated_subqueries">14.1.8.5  Correlated Subqueries</A></H4>

<P>
A <em>correlated subquery</em> is a subquery that contains a reference to a
table that also appears in the outer query.
For example:

</P>

<PRE>
SELECT * FROM t1 WHERE column1 = ANY
       (SELECT column1 FROM t2 WHERE t2.column2 = t1.column2);
</PRE>

<P>
Notice that the subquery contains a reference to a column
of <code>t1</code>, even though the subquery's <code>FROM</code> clause doesn't mention
a table <code>t1</code>. So, MySQL looks outside the subquery, and finds <code>t1</code> in the
outer query.

</P>
<P>
Suppose that table <code>t1</code> contains a row where <code>column1 = 5</code> and
<code>column2 = 6</code>; meanwhile, table <code>t2</code> contains a row where
<code>column1 = 5</code> and <code>column2 = 7</code>. The simple expression
<code>... WHERE column1 = ANY (SELECT column1 FROM t2)</code> would be
<code>TRUE</code>, but in this example, the <code>WHERE</code> clause within the
subquery is <code>FALSE</code> (because <code>7</code> is not equal to <code>5</code>), so the subquery
as a whole is
<code>FALSE</code>.

</P>
<P>
<strong>Scoping rule:</strong> MySQL evaluates from inside to outside.
For example:

</P>

<PRE>
SELECT column1 FROM t1 AS x
  WHERE x.column1 = (SELECT column1 FROM t2 AS x
    WHERE x.column1 = (SELECT column1 FROM t3
      WHERE x.column2 = t3.column1));
</PRE>

<P>
In this statement, <code>x.column2</code> must be a column in table <code>t2</code> because
<code>SELECT column1 FROM t2 AS x ...</code> renames <code>t2</code>. It is not a
column in table <code>t1</code> because <code>SELECT column1 FROM t1 ...</code> is an
outer query that is <em>farther out</em>.

</P>
<P>
For subqueries in <code>HAVING</code> or <code>ORDER BY</code> clauses, MySQL also
looks for column names in the outer select list.

</P>
<P>
For certain cases, a correlated subquery is optimized. For example:

</P>

<PRE>
<var>val</var> IN (SELECT <var>key_val</var> FROM <var>tbl_name</var> WHERE <var>correlated_condition</var>)
</PRE>

<P>
Otherwise, they are inefficient and likely to be slow. Rewriting the query
as a join might improve performance.

</P>



<H4><A NAME="EXISTS_and_NOT_EXISTS_subqueries" HREF="manual_toc.html#EXISTS_and_NOT_EXISTS_subqueries">14.1.8.6  <code>EXISTS</code> and <code>NOT EXISTS</code></A></H4>

<P>
If a subquery returns any values at all, then <code>EXISTS subquery</code> is
<code>TRUE</code>, and <code>NOT EXISTS subquery</code> is <code>FALSE</code>.
For example:

</P>

<PRE>
SELECT column1 FROM t1 WHERE EXISTS (SELECT * FROM t2);
</PRE>

<P>
Traditionally, an <code>EXISTS</code> subquery starts with <code>SELECT *</code>, but it
could begin with <code>SELECT 5</code> or <code>SELECT column1</code> or anything at
all. MySQL ignores the <code>SELECT</code> list in such a subquery, so it
doesn't matter.

</P>
<P>
For the preceding example, if <code>t2</code> contains any rows, even rows with
nothing but <code>NULL</code> values, then the <code>EXISTS</code> condition is
<code>TRUE</code>. This is actually an unlikely example, since almost always a
<code>[NOT] EXISTS</code> subquery will contain correlations.
Here are some more realistic examples:

</P>

<UL>
<LI>

What kind of store is present in one or more cities?

<PRE>
SELECT DISTINCT store_type FROM Stores
  WHERE EXISTS (SELECT * FROM Cities_Stores
                WHERE Cities_Stores.store_type = Stores.store_type);
</PRE>

<LI>

What kind of store is present in no cities?

<PRE>
SELECT DISTINCT store_type FROM Stores
  WHERE NOT EXISTS (SELECT * FROM Cities_Stores
                    WHERE Cities_Stores.store_type = Stores.store_type);
</PRE>

<LI>

What kind of store is present in all cities?

<PRE>
SELECT DISTINCT store_type FROM Stores S1
  WHERE NOT EXISTS (
    SELECT * FROM Cities WHERE NOT EXISTS (
      SELECT * FROM Cities_Stores
       WHERE Cities_Stores.city = Cities.city
       AND Cities_Stores.store_type = Stores.store_type));
</PRE>

</UL>

<P>
The last example is a double-nested <code>NOT EXISTS</code> query. That is, it has a
<code>NOT EXISTS</code> clause within a <code>NOT EXISTS</code> clause. Formally, it
answers the question ``does a city exist with a store that is not in
<code>Stores</code>?'' But it's easier to say that a nested <code>NOT EXISTS</code> answers
the question ``is x TRUE for all y?''

</P>



<H4><A NAME="Row_subqueries" HREF="manual_toc.html#Row_subqueries">14.1.8.7  Row Subqueries</A></H4>

<P>
The discussion to this point has been of
<em>column (or scalar) subqueries</em>: subqueries that return a single
column value. A <em>row subquery</em> is a subquery variant that returns a
single row value and can thus return more than one column value.
Here are two examples:

</P>

<PRE>
SELECT * FROM t1 WHERE (1,2) = (SELECT column1, column2 FROM t2);
SELECT * FROM t1 WHERE ROW(1,2) = (SELECT column1, column2 FROM t2);
</PRE>

<P>
The queries here are both <code>TRUE</code> if table <code>t2</code> has
a row where <code>column1 = 1</code> and <code>column2 = 2</code>.

</P>
<P>
The expressions <code>(1,2)</code> and <code>ROW(1,2)</code> are sometimes called
<em>row constructors</em>. The two are equivalent.
They are legal in other contexts, too. For example, the following two
statements are semantically equivalent (although currently only the second one
can be optimized):

</P>

<PRE>
SELECT * FROM t1 WHERE (column1,column2) = (1,1);
SELECT * FROM t1 WHERE column1 = 1 AND column2 = 1;
</PRE>

<P>
The normal use of row constructors, though, is for comparisons with
subqueries that return two or more columns. For example, the following query answers
the request, ``find all rows in table <code>t1</code> that also exist in table
<code>t2</code>'':

</P>

<PRE>
SELECT column1,column2,column3
       FROM t1
       WHERE (column1,column2,column3) IN
             (SELECT column1,column2,column3 FROM t2);
</PRE>



<H4><A NAME="Unnamed_views" HREF="manual_toc.html#Unnamed_views">14.1.8.8  Subqueries in the <code>FROM</code> clause</A></H4>

<P>
<A NAME="IDX1591"></A>
<A NAME="IDX1592"></A>

</P>
<P>
Subqueries are legal in a <code>SELECT</code> statement's <code>FROM</code> clause.
The syntax that you'll actually see is:

</P>

<PRE>
SELECT ... FROM (<var>subquery</var>) AS <var>name</var> ...
</PRE>

<P>
The <code>AS <var>name</var></code> clause is mandatory, because every table in a
<code>FROM</code> clause must have a name. Any columns in the <var>subquery</var>
select list must have unique names. You can find this syntax described
elsewhere in this manual, where the term used is ``derived tables.''

</P>

<P>
For illustration, assume that you have this table:

<PRE>
CREATE TABLE t1 (s1 INT, s2 CHAR(5), s3 FLOAT);
</PRE>

<P>
Here's how to use a subquery in the <code>FROM</code> clause, using
the example table:

</P>

<PRE>
INSERT INTO t1 VALUES (1,'1',1.0);
INSERT INTO t1 VALUES (2,'2',2.0);
SELECT sb1,sb2,sb3
       FROM (SELECT s1 AS sb1, s2 AS sb2, s3*2 AS sb3 FROM t1) AS sb
       WHERE sb1 &#62; 1;
</PRE>

<P>
Result: <code>2, '2', 4.0</code>.

</P>
<P>
Here's another example: Suppose that you want to know the average of a
set of sums for a grouped table. This won't work:

</P>

<PRE>
SELECT AVG(SUM(column1)) FROM t1 GROUP BY column1;
</PRE>

<P>
But this query will provide the desired information:

</P>

<PRE>
SELECT AVG(sum_column1)
       FROM (SELECT SUM(column1) AS sum_column1
             FROM t1 GROUP BY column1) AS t1;
</PRE>

<P>
Notice that the column name used within the subquery
<code>(sum_column1)</code> is recognized in the outer query.

</P>
<P>
At the moment, subqueries in the <code>FROM</code> clause cannot be correlated
subqueries.

</P>
<P>
Subquery in the <code>FROM</code> clause will be executed (that is, derived temporary
tables will be built) even for the <code>EXPLAIN</code> statement, because upper
level queries need information about all tables during optimization phase.

</P>


<H4><A NAME="Subquery_errors" HREF="manual_toc.html#Subquery_errors">14.1.8.9  Subquery Errors</A></H4>

<P>
There are some new error returns that apply only to subqueries.
This section groups them together because reviewing them will help
remind you of some points.

</P>

<UL>
<LI>

Unsupported subquery syntax:


<PRE>
ERROR 1235 (ER_NOT_SUPPORTED_YET)
SQLSTATE = 42000
Message = "This version of MySQL doesn't yet support
'LIMIT &#38; IN/ALL/ANY/SOME subquery'"
</PRE>

This means that statements of the following form will not work, although this
happens only in some early versions, such as MySQL 4.1.1:


<PRE>
SELECT * FROM t1 WHERE s1 IN (SELECT s2 FROM t2 ORDER BY s1 LIMIT 1)
</PRE>

<LI>

Incorrect number of columns from subquery:


<PRE>
ERROR 1241 (ER_OPERAND_COL)
SQLSTATE = 21000
Message = "Operand should contain 1 column(s)"
</PRE>

This error will occur in cases like this:


<PRE>
SELECT (SELECT column1, column2 FROM t2) FROM t1;
</PRE>

It's okay to use a subquery that returns multiple columns, if the purpose
is comparison. See section <A HREF="manual.html#Row_subqueries">14.1.8.7  Row Subqueries</A>.
But in other contexts, the subquery must be a scalar operand.

<LI>

Incorrect number of rows from subquery:


<PRE>
ERROR 1242 (ER_SUBSELECT_NO_1_ROW)
SQLSTATE = 21000
Message = "Subquery returns more than 1 row"
</PRE>

This error will occur for statements such as the following one,
but only when there is more than one row in <code>t2</code>:


<PRE>
SELECT * FROM t1 WHERE column1 = (SELECT column1 FROM t2);
</PRE>

That means this
error might occur in code that had been working for years, because somebody
happened to make a change that affected the number of rows that the
subquery can return. Remember that if the object is to find any number of
rows, not just one, then the correct statement would look like this:


<PRE>
SELECT * FROM t1 WHERE column1 = ANY (SELECT column1 FROM t2);
</PRE>

<LI>

Incorrectly used table in subquery:


<PRE>
Error 1093 (ER_UPDATE_TABLE_USED)
SQLSTATE = HY000
Message = "You can't specify target table 'x'
for update in FROM clause"
</PRE>

This error will occur in cases like this:


<PRE>
UPDATE t1 SET column2 = (SELECT MAX(column1) FROM t1);
</PRE>

It's okay to use a subquery for assignment within an
<code>UPDATE</code> statement, since subqueries are legal in <code>UPDATE</code>
and <code>DELETE</code> statements as well as in <code>SELECT</code> statements.
However, you cannot use the same table, in this case table <code>t1</code>, for
both the subquery's <code>FROM</code> clause and the update target.

</UL>

<P>
Usually, failure of a subquery causes the entire statement to fail.

</P>



<H4><A NAME="Optimising_subqueries" HREF="manual_toc.html#Optimising_subqueries">14.1.8.10  Optimizing Subqueries</A></H4>

<P>
Development is ongoing, so no optimization tip is reliable for the long
term. Some interesting tricks that you might want to play with are:

</P>

<UL>
<LI>

Use subquery clauses that affect the number or order of the rows in the
subquery. For example:


<PRE>
SELECT * FROM t1 WHERE t1.column1 IN
  (SELECT column1 FROM t2 ORDER BY column1);
SELECT * FROM t1 WHERE t1.column1 IN
  (SELECT DISTINCT column1 FROM t2);
SELECT * FROM t1 WHERE EXISTS
  (SELECT * FROM t2 LIMIT 1);
</PRE>

<LI>

Replace a join with a subquery. For example, use this query:


<PRE>
SELECT DISTINCT column1 FROM t1 WHERE t1.column1 IN (
  SELECT column1 FROM t2);
</PRE>

Instead of this query:


<PRE>
SELECT DISTINCT t1.column1 FROM t1, t2
  WHERE t1.column1 = t2.column1;
</PRE>

<LI>

Move clauses from outside to inside the subquery. For example, use this
query:


<PRE>
SELECT * FROM t1
  WHERE s1 IN (SELECT s1 FROM t1 UNION ALL SELECT s1 FROM t2);
</PRE>

Instead of this query:


<PRE>
SELECT * FROM t1
  WHERE s1 IN (SELECT s1 FROM t1) OR s1 IN (SELECT s1 FROM t2);
</PRE>

For another example, use this query:


<PRE>
SELECT (SELECT column1 + 5 FROM t1) FROM t2;
</PRE>

Instead of this query:


<PRE>
SELECT (SELECT column1 FROM t1) + 5 FROM t2;
</PRE>

<LI>

Use a row subquery instead of a correlated subquery. For example, use this
query:


<PRE>
SELECT * FROM t1
  WHERE (column1,column2) IN (SELECT column1,column2 FROM t2);
</PRE>

Instead of this query:


<PRE>
SELECT * FROM t1
  WHERE EXISTS (SELECT * FROM t2 WHERE t2.column1=t1.column1
  AND t2.column2=t1.column2);
</PRE>

<LI>

Use <code>NOT (a = ANY (...))</code> rather than <code>a &#60;&#62; ALL (...)</code>.

<LI>

Use <code>x = ANY (table containing (1,2))</code> rather than
<code>x=1 OR x=2</code>.

<LI>

Use <code>= ANY</code> rather than <code>EXISTS</code>.
</UL>

<P>
These tricks might cause programs to go faster or slower. Using MySQL
facilities like the <code>BENCHMARK()</code> function, you can get an idea about
what helps in your own situation. Don't worry too much about transforming
to joins except for compatibility with older versions of MySQL before 4.1
that do not support subqueries.

</P>
<P>
Some optimizations that MySQL itself makes are:

</P>

<UL>
<LI>

MySQL executes non-correlated subqueries only once. Use <code>EXPLAIN</code>
to make sure that a given subquery really is non-correlated.

<LI>

MySQL rewrites <code>IN</code>/<code>ALL</code>/<code>ANY</code>/<code>SOME</code> subqueries
in an attempt to take advantage of the possibility that the select-list
columns in the subquery are indexed.

<LI>

MySQL replaces subqueries of the following form
with an index-lookup function, which <code>EXPLAIN</code> will describe as a
special join type:


<PRE>
... IN (SELECT <var>indexed_column</var> FROM <var>single_table</var> ...)
</PRE>

<LI>

MySQL enhances expressions of the following form
with an expression involving <code>MIN()</code> or <code>MAX()</code>, unless <code>NULL</code>
values or empty sets are involved:


<PRE>
value {ALL|ANY|SOME} {&#62; | &#60; | &#62;= | &#60;=} (non-correlated subquery)
</PRE>

For example, this <code>WHERE</code> clause:


<PRE>
WHERE 5 &#62; ALL (SELECT x FROM t)
</PRE>

might be treated by the optimizer like this:


<PRE>
WHERE 5 &#62; (SELECT MAX(x) FROM t)
</PRE>

</UL>

<P>
There is a chapter titled ``How MySQL Transforms Subqueries''
in the MySQL Internals Manual. You can obtain this document by downloading the
MySQL source package and looking for a file named <tt>`internals.texi'</tt> in the
<tt>`Docs'</tt> directory.

</P>



<H4><A NAME="Rewriting_subqueries" HREF="manual_toc.html#Rewriting_subqueries">14.1.8.11  Rewriting Subqueries as Joins for Earlier MySQL Versions</A></H4>

<P>
Before MySQL 4.1, only nested queries of the form
<code>INSERT ... SELECT ...</code> and <code>REPLACE ... SELECT ...</code>
are supported.
The <code>IN()</code> construct can be used in other contexts to test membership in
a set of values.

</P>
<P>
It is often possible to rewrite a query without a subquery:

</P>

<PRE>
SELECT * FROM t1 WHERE id IN (SELECT id FROM t2);
</PRE>

<P>
This can be rewritten as:

</P>

<PRE>
SELECT DISTINCT t1.* FROM t1,t2 WHERE t1.id=t2.id;
</PRE>

<P>
The queries:

<PRE>
SELECT * FROM t1 WHERE id NOT IN (SELECT id FROM t2);
SELECT * FROM t1 WHERE NOT EXISTS (SELECT id FROM t2 WHERE t1.id=t2.id);
</PRE>

<P>
Can be rewritten as:

</P>

<PRE>
SELECT table1.* FROM table1 LEFT JOIN table2 ON table1.id=table2.id
                                       WHERE table2.id IS NULL;
</PRE>

<P>
A <code>LEFT [OUTER] JOIN</code> can be faster than an equivalent subquery
because the server might be able to optimize it better--a fact that is
not specific to MySQL Server alone.
Prior to SQL-92, outer joins did not exist, so subqueries were the only way
to do certain things in those bygone days. Today, MySQL Server and many
other modern database systems offer a whole range of outer join types.

</P>
<P>
For more complicated subqueries, you can often create temporary tables
to hold the subquery.  In some cases, however, this option will not
work. The most frequently encountered of these cases arises with
<code>DELETE</code> statements, for which standard SQL does not support joins
(except in subqueries).  For this situation, there are three options
available:

</P>

<UL>
<LI>

The first option is to upgrade to MySQL 4.1, which does support
subqueries in <code>DELETE</code> statements.

<LI>

The second option is to use a procedural programming language (such as
Perl or PHP) to submit a <code>SELECT</code> query to obtain the primary keys
for the records to be deleted, and then use these values to construct
the <code>DELETE</code> statement (<code>DELETE FROM ... WHERE key_col IN (key1,
key2, ...)</code>).

<LI>

The third option is to use interactive SQL to construct a set of
<code>DELETE</code> statements automatically, using the MySQL
extension <code>CONCAT()</code> (in lieu of the standard <code>||</code> operator).
For example:


<PRE>
SELECT
  CONCAT('DELETE FROM tab1 WHERE pkid = ', "'", tab1.pkid, "'", ';')
  FROM tab1, tab2
 WHERE tab1.col1 = tab2.col2;
</PRE>

You can place this query in a script file, use the file as input to one
instance of the <code>mysql</code> program, and use the program output
as input to a second instance of <code>mysql</code>:


<PRE>
shell&#62; mysql --skip-column-names mydb &#60; myscript.sql | mysql mydb
</PRE>

</UL>

<P>
MySQL Server 4.0 supports multiple-table <code>DELETE</code> statements that can be used to
efficiently delete rows based on information from one table or even
from many tables at the same time.
Multiple-table <code>UPDATE</code> statements are also supported as of MySQL 4.0.

</P>



<H3><A NAME="TRUNCATE" HREF="manual_toc.html#TRUNCATE">14.1.9  <code>TRUNCATE</code> Syntax</A></H3>

<P>
<A NAME="IDX1593"></A>

</P>

<PRE>
TRUNCATE TABLE <var>tbl_name</var>
</PRE>

<P>
<code>TRUNCATE TABLE</code> empties a table completely.
Logically, this is equivalent to a <code>DELETE</code> statement that deletes all
rows, but there are practical differences under some circumstances.

</P>
<P>
For <code>InnoDB</code>, <code>TRUNCATE TABLE</code> is mapped to
<code>DELETE</code>, so there is no difference. For other storage engines,
<code>TRUNCATE TABLE</code> differs from <code>DELETE FROM ...</code>
in the following ways from MySQL 4.0 and up:

</P>

<UL>
<LI>

Truncate operations drop and re-create the table, which is much faster
than deleting rows one by one.
<LI>

Truncate operations are not transaction-safe; you will get an error if
you have an active transaction or an active table lock.
<LI>

The number of deleted rows is not returned.
<LI>

As long as the table definition file <tt>`<var>tbl_name</var>.frm'</tt> is
valid, the table can be re-created as an empty table with <code>TRUNCATE
TABLE</code>, even if the data or index files have become corrupted.
<LI>

The table handler does not remember the last used <code>AUTO_INCREMENT</code>
value, but starts counting from the beginning.  This is true even for
<code>MyISAM</code>, which normally does not reuse sequence values.
</UL>

<P>
In MySQL 3.23, <code>TRUNCATE TABLE</code> is mapped to
<code>COMMIT; DELETE FROM <var>tbl_name</var></code>, so it behaves like <code>DELETE</code>.
See section <A HREF="manual.html#DELETE">14.1.1  <code>DELETE</code> Syntax</A>.

</P>
<P>
<code>TRUNCATE TABLE</code> is an Oracle SQL extension.
This statement was added in MySQL 3.23.28, although from 3.23.28
to 3.23.32, the keyword <code>TABLE</code> must be omitted.

</P>



<H3><A NAME="UPDATE" HREF="manual_toc.html#UPDATE">14.1.10  <code>UPDATE</code> Syntax</A></H3>

<P>
<A NAME="IDX1594"></A>

</P>
<P>
Single-table syntax:

<PRE>
UPDATE [LOW_PRIORITY] [IGNORE] <var>tbl_name</var>
    SET <var>col_name1</var>=<var>expr1</var> [, <var>col_name2</var>=<var>expr2</var> ...]
    [WHERE <var>where_definition</var>]
    [ORDER BY ...]
    [LIMIT <var>row_count</var>]
</PRE>

<P>
Multiple-table syntax:

</P>

<PRE>
UPDATE [LOW_PRIORITY] [IGNORE] <var>tbl_name</var> [, <var>tbl_name</var> ...]
    SET <var>col_name1</var>=<var>expr1</var> [, <var>col_name2</var>=<var>expr2</var> ...]
    [WHERE <var>where_definition</var>]
</PRE>

<P>
The <code>UPDATE</code> statement updates columns in existing table rows with new values.
The <code>SET</code> clause indicates which columns to modify and the values
they should be given.  The <code>WHERE</code> clause, if given, specifies
which rows should be updated.  Otherwise, all rows are updated. If the
<code>ORDER BY</code> clause is specified, the rows will be updated in the
order that is specified. The <code>LIMIT</code> clause places a limit on the number
of rows that can be updated.

</P>
<P>
The <code>UPDATE</code> statement supports the following modifiers:

</P>

<UL>

<LI>

If you specify the <code>LOW_PRIORITY</code> keyword, execution of the
<code>UPDATE</code> is delayed until no other clients are reading from the table.

<LI>

If you specify the <code>IGNORE</code> keyword, the update statement will not
abort even if duplicate-key errors occur during the update.  Rows for which
conflicts occur are not updated.

</UL>

<P>
If you access a column from <var>tbl_name</var> in an expression,
<code>UPDATE</code> uses the current value of the column.  For example, the
following statement sets the <code>age</code> column to one more than its
current value:

</P>

<PRE>
mysql&#62; UPDATE persondata SET age=age+1;
</PRE>

<P>
<code>UPDATE</code> assignments are evaluated from left to right.  For example, the
following statement doubles the <code>age</code> column, then increments it:

</P>

<PRE>
mysql&#62; UPDATE persondata SET age=age*2, age=age+1;
</PRE>

<P>
If you set a column to the value it currently has, MySQL notices
this and doesn't update it.

</P>
<P>
If you update a column that has been declared <code>NOT NULL</code> by
setting to <code>NULL</code>, the column is set to the default value appropriate
for the column type and the warning count is incremented.  The default
value is <code>0</code> for numeric types, the empty string (<code>''</code>)
for string types, and the ``zero'' value for date and time types.

</P>
<P>
<A NAME="IDX1595"></A>
<code>UPDATE</code> returns the number of rows that were actually changed.
In MySQL 3.22 or later, the <code>mysql_info()</code> C API function
returns the number of rows that were matched and updated and the number of
warnings that occurred during the <code>UPDATE</code>.

</P>
<P>
Starting from MySQL 3.23, you can use <code>LIMIT <var>row_count</var></code> to
restrict the scope of the <code>UPDATE</code>. A <code>LIMIT</code> clause works as
follows:

</P>

<UL>
<LI>

Before MySQL 4.0.13, <code>LIMIT</code> is a rows-affected restriction.
The statement stops as soon as it has changed <var>row_count</var> rows that
satisfy the <code>WHERE</code> clause.

<LI>

From 4.0.13 on, <code>LIMIT</code> is a rows-matched restriction.  The statement
stops as soon as it has found <var>row_count</var> rows that satisfy the
<code>WHERE</code> clause, whether or not they actually were changed.

</UL>

<P>
If an <code>UPDATE</code> statement includes an <code>ORDER BY</code> clause, the rows
are updated in the order specified by the clause.
<code>ORDER BY</code> can be used from MySQL 4.0.0.

</P>
<P>
Starting with MySQL 4.0.4, you can also perform <code>UPDATE</code>
operations that cover multiple tables:

</P>

<PRE>
UPDATE items,month SET items.price=month.price
WHERE items.id=month.id;
</PRE>

<P>
The example shows an inner join using the comma operator, but
multiple-table <code>UPDATE</code> statements can use any type of
join allowed in <code>SELECT</code> statements, such as <code>LEFT JOIN</code>.

</P>
<P>
Note: You cannot use <code>ORDER BY</code> or <code>LIMIT</code> with multiple-table
<code>UPDATE</code>.

</P>
<P>
Before MySQL 4.0.18, you need the <code>UPDATE</code> privilege for all
tables used in a multiple-table <code>UPDATE</code>, even if they were not
updated.  As of MySQL 4.0.18, you need only the <code>SELECT</code> privilege for
any columns that are read but not modified.

</P>
<P>
If you use a multiple-table <code>UPDATE</code> statement involving
<code>InnoDB</code> tables for which there are foreign key constraints,
the MySQL optimizer might process tables in an order that differs from
that of their parent/child relationship. In this case, the statement will
fail and roll back. Instead, update a single table and rely on the
<code>ON UPDATE</code> capabilities that <code>InnoDB</code> provides to cause the
other tables to be modified accordingly.

</P>



<H2><A NAME="Data_Definition" HREF="manual_toc.html#Data_Definition">14.2  Data Definition Statements</A></H2>



<H3><A NAME="ALTER_DATABASE" HREF="manual_toc.html#ALTER_DATABASE">14.2.1  <code>ALTER DATABASE</code> Syntax</A></H3>

<P>
<A NAME="IDX1596"></A>
<A NAME="IDX1597"></A>
<A NAME="IDX1598"></A>

</P>

<PRE>
ALTER DATABASE <var>db_name</var>
    <var>alter_specification</var> [, <var>alter_specification</var>] ...

<var>alter_specification</var>:
    [DEFAULT] CHARACTER SET <var>charset_name</var>
  | [DEFAULT] COLLATE <var>collation_name</var>
</PRE>

<P>
<code>ALTER DATABASE</code> allows you to change the overall characteristics of a
database.  These characteristics are stored in the <tt>`db.opt'</tt> file in the
database directory.
To use <code>ALTER DATABASE</code>, you need the <code>ALTER</code> privilege on the
database.

</P>
<P>
The <code>CHARACTER SET</code> clause changes the default database character set.
The <code>COLLATE</code> clause changes the default database collation.
Character set and collation names are discussed in
section <A HREF="manual.html#Charset">11  Character Set Support</A>.

</P>
<P>
<code>ALTER DATABASE</code> was added in MySQL 4.1.1.

</P>


<H3><A NAME="ALTER_TABLE" HREF="manual_toc.html#ALTER_TABLE">14.2.2  <code>ALTER TABLE</code> Syntax</A></H3>

<P>
<A NAME="IDX1599"></A>
<A NAME="IDX1600"></A>
<A NAME="IDX1601"></A>

</P>

<PRE>
ALTER [IGNORE] TABLE <var>tbl_name</var>
    <var>alter_specification</var> [, <var>alter_specification</var>] ...

<var>alter_specification</var>:
    ADD [COLUMN] <var>column_definition</var> [FIRST | AFTER <var>col_name</var> ]
  | ADD [COLUMN] (<var>column_definition</var>,...)
  | ADD INDEX [<var>index_name</var>] [<var>index_type</var>] (<var>index_col_name</var>,...)
  | ADD [CONSTRAINT [<var>symbol</var>]]
        PRIMARY KEY [<var>index_type</var>] (<var>index_col_name</var>,...)
  | ADD [CONSTRAINT [<var>symbol</var>]]
        UNIQUE [<var>index_name</var>] [<var>index_type</var>] (<var>index_col_name</var>,...)
  | ADD [FULLTEXT|SPATIAL] [<var>index_name</var>] (<var>index_col_name</var>,...)
  | ADD [CONSTRAINT [<var>symbol</var>]]
        FOREIGN KEY [<var>index_name</var>] (<var>index_col_name</var>,...)
        [<var>reference_definition</var>]
  | ALTER [COLUMN] <var>col_name</var> {SET DEFAULT <var>literal</var> | DROP DEFAULT}
  | CHANGE [COLUMN] <var>old_col_name</var> <var>column_definition</var>
        [FIRST|AFTER <var>col_name</var>]
  | MODIFY [COLUMN] <var>column_definition</var> [FIRST | AFTER <var>col_name</var>]
  | DROP [COLUMN] <var>col_name</var>
  | DROP PRIMARY KEY
  | DROP INDEX <var>index_name</var>
  | DROP FOREIGN KEY <var>fk_symbol</var>
  | DISABLE KEYS
  | ENABLE KEYS
  | RENAME [TO] <var>new_tbl_name</var>
  | ORDER BY <var>col_name</var>
  | CONVERT TO CHARACTER SET <var>charset_name</var> [COLLATE <var>collation_name</var>]
  | [DEFAULT] CHARACTER SET <var>charset_name</var> [COLLATE <var>collation_name</var>]
  | DISCARD TABLESPACE
  | IMPORT TABLESPACE
  | <var>table_options</var>
</PRE>

<P>
<code>ALTER TABLE</code> allows you to change the structure of an existing table.
For example, you can add or delete columns, create or destroy indexes, change
the type of existing columns, or rename columns or the table itself.  You can
also change the comment for the table and type of the table.

</P>
<P>
The syntax for many of the allowable alterations is similar to clauses of the
<code>CREATE TABLE</code> statement.
See section <A HREF="manual.html#CREATE_TABLE">14.2.5  <code>CREATE TABLE</code> Syntax</A>.

</P>
<P>
If you use <code>ALTER TABLE</code> to change a column specification but
<code>DESCRIBE <var>tbl_name</var></code> indicates that your column was not changed, it is
possible that MySQL ignored your modification for one of the reasons
described in section <A HREF="manual.html#Silent_column_changes">14.2.5.1  Silent Column Specification Changes</A>.  For example, if you try to change
a <code>VARCHAR</code> column to <code>CHAR</code>, MySQL will still use
<code>VARCHAR</code> if the table contains other variable-length columns.

</P>
<P>
<code>ALTER TABLE</code> works by making a temporary copy of the original table.
The alteration is performed on the copy, then the original table is deleted
and the new one is renamed.  While <code>ALTER TABLE</code> is executing, the
original table is readable by other clients. Updates and writes to the
table are stalled until the new table is ready, then are automatically
redirected to the new table without any failed updates.

</P>
<P>
Note that if you use any other option to <code>ALTER TABLE</code> than
<code>RENAME</code>, MySQL always creates a temporary table, even if the data
wouldn't strictly need to be copied (such as when you change the name of a
column). We plan to fix this in the future, but because <code>ALTER TABLE</code>
is not a statement that is normally used frequently, this isn't high on our
TODO list.  For <code>MyISAM</code> tables, you can speed up the index re-creation
operation (which is the slowest part of the alteration process) by setting
the <code>myisam_sort_buffer_size</code> system variable to a high value.

</P>

<UL>
<LI>

To use <code>ALTER TABLE</code>, you need <code>ALTER</code>, <code>INSERT</code>,
and <code>CREATE</code> privileges for the table.

<LI>

<code>IGNORE</code> is a MySQL extension to standard SQL.
It controls how <code>ALTER TABLE</code> works if there are duplicates on
unique keys in the new table.
If <code>IGNORE</code> isn't specified, the copy is aborted and rolled back if
duplicate-key errors occur.
If <code>IGNORE</code> is specified, then for rows with duplicates on a unique
key, only the first row is used. The others are deleted.

<LI>

You can issue multiple <code>ADD</code>, <code>ALTER</code>, <code>DROP</code>, and
<code>CHANGE</code> clauses in a single <code>ALTER TABLE</code> statement. This is a
MySQL extension to standard SQL, which allows only one of each clause
per <code>ALTER TABLE</code> statement. For example, to drop multiple columns in a single statement: 


<PRE>
mysql&#62; ALTER TABLE t2 DROP COLUMN c, DROP COLUMN d;
</PRE>

<LI>

<code>CHANGE col_name</code>, <code>DROP col_name</code>, and <code>DROP
INDEX</code> are MySQL extensions to standard SQL.

<LI>

<code>MODIFY</code> is an Oracle extension to <code>ALTER TABLE</code>.

<LI>

The word <code>COLUMN</code> is purely optional and can be omitted.

<LI>

If you use <code>ALTER TABLE <var>tbl_name</var> RENAME TO <var>new_tbl_name</var></code> without any other
options, MySQL simply renames any files that correspond to the table
<var>tbl_name</var>.  There is no need to create a temporary table.
(You can also use the <code>RENAME TABLE</code> statement to rename tables.
See section <A HREF="manual.html#RENAME_TABLE">14.2.9  <code>RENAME TABLE</code> Syntax</A>.)

<LI>

<var>column_definition</var> clauses use the same syntax for <code>ADD</code> and
<code>CHANGE</code> as for <code>CREATE TABLE</code>.  Note that this syntax includes
the column name, not just the column type.
See section <A HREF="manual.html#CREATE_TABLE">14.2.5  <code>CREATE TABLE</code> Syntax</A>.

<LI>

You can rename a column using a <code>CHANGE <var>old_col_name</var> <var>column_definition</var></code>
clause.  To do so, specify the old and new column names and the type that
the column currently has.  For example, to rename an <code>INTEGER</code> column
from <code>a</code> to <code>b</code>, you can do this:


<PRE>
mysql&#62; ALTER TABLE t1 CHANGE a b INTEGER;
</PRE>

If you want to change a column's type but not the name, <code>CHANGE</code>
syntax still requires an old and new column name, even if they are the same.
For example:


<PRE>
mysql&#62; ALTER TABLE t1 CHANGE b b BIGINT NOT NULL;
</PRE>

However, as of MySQL 3.22.16a, you can also use <code>MODIFY</code>
to change a column's type without renaming it:


<PRE>
mysql&#62; ALTER TABLE t1 MODIFY b BIGINT NOT NULL;
</PRE>

<LI>

If you use <code>CHANGE</code> or <code>MODIFY</code> to shorten a column for which
an index exists on part of the column (for example, if you have an index
on the first 10 characters of a <code>VARCHAR</code> column), you cannot make
the column shorter than the number of characters that are indexed.

<LI>

When you change a column type using <code>CHANGE</code> or <code>MODIFY</code>, MySQL
tries to convert existing column values to the new type as well as possible.

<LI>

In MySQL 3.22 or later, you can use <code>FIRST</code> or
<code>AFTER <var>col_name</var></code> to add a column at a specific position
within a table row. The default is to add the column last.
From MySQL 4.0.1 on, you can also use <code>FIRST</code> and
<code>AFTER</code> in <code>CHANGE</code> or <code>MODIFY</code> operations.

<A NAME="IDX1602"></A>
<A NAME="IDX1603"></A>
<A NAME="IDX1604"></A>
<A NAME="IDX1605"></A>
<A NAME="IDX1606"></A>
<LI>

<code>ALTER COLUMN</code> specifies a new default value for a column
or removes the old default value.
If the old default is removed and the column can be <code>NULL</code>, the new
default is <code>NULL</code>. If the column cannot be <code>NULL</code>, MySQL
assigns a default value, as described in
section <A HREF="manual.html#CREATE_TABLE">14.2.5  <code>CREATE TABLE</code> Syntax</A>.

<A NAME="IDX1607"></A>
<A NAME="IDX1608"></A>
<A NAME="IDX1609"></A>
<LI>

<code>DROP INDEX</code> removes an index. This is a MySQL extension to
standard SQL. See section <A HREF="manual.html#DROP_INDEX">14.2.7  <code>DROP INDEX</code> Syntax</A>.

<LI>

If columns are dropped from a table, the columns are also removed from any
index of which they are a part.  If all columns that make up an index are
dropped, the index is dropped as well.

<LI>

If a table contains only one column, the column cannot be dropped.
If what you intend is to remove the table, use <code>DROP TABLE</code> instead.

<LI>

<A NAME="IDX1610"></A>
<A NAME="IDX1611"></A>
<A NAME="IDX1612"></A>
<code>DROP PRIMARY KEY</code> drops the primary index. (Prior to MySQL 4.1.2,
if no primary index exists, <code>DROP PRIMARY KEY</code> drops the first
<code>UNIQUE</code> index in the table.
MySQL marks the first <code>UNIQUE</code> key as the <code>PRIMARY KEY</code>
if no <code>PRIMARY KEY</code> was specified explicitly.)

<A NAME="IDX1613"></A>
<A NAME="IDX1614"></A>
If you add a <code>UNIQUE INDEX</code> or <code>PRIMARY KEY</code> to a table, it
is stored before any non-unique index so that MySQL can detect
duplicate keys as early as possible.

<A NAME="IDX1615"></A>
<LI>

<code>ORDER BY</code> allows you to create the new table with the rows in a
specific order.  Note that the table will not remain in this order after
inserts and deletes.  This option is mainly useful when you know that you
are mostly going to query the rows in a certain order; by using this option
after big changes to the table, you might be able to get higher performance.
In some cases, it might make sorting easier for MySQL if the table is in
order by the column that you want to order it by later.

<A NAME="IDX1616"></A>
<A NAME="IDX1617"></A>
<A NAME="IDX1618"></A>
<LI>

If you use <code>ALTER TABLE</code> on a <code>MyISAM</code> table, all non-unique
indexes are created in a separate batch (as for <code>REPAIR TABLE</code>).
This should make <code>ALTER TABLE</code> much faster when you have many indexes.

As of MySQL 4.0, this feature can be activated explicitly.  <code>ALTER
TABLE ... DISABLE KEYS</code> tells MySQL to stop updating non-unique indexes for a
<code>MyISAM</code> table.  <code>ALTER TABLE ... ENABLE KEYS</code> then should be used
to re-create missing indexes. MySQL does this with a special algorithm that
is much faster than inserting keys one by one, so disabling keys before
performing bulk insert operations should give a considerable speedup. Using 
<code>ALTER TABLE ... DISABLE KEYS</code> will require the <code>INDEX</code> privilege
in addition to the privileges mentioned earlier.

<LI>

<A NAME="IDX1619"></A>
<A NAME="IDX1620"></A>
The <code>FOREIGN KEY</code> and <code>REFERENCES</code> clauses are supported by the
<code>InnoDB</code> storage engine, which implements
<code>ADD [CONSTRAINT [<var>symbol</var>]] FOREIGN KEY (...) REFERENCES ... (...)</code>.
See section <A HREF="manual.html#InnoDB_foreign_key_constraints">16.7.4  <code>FOREIGN KEY</code> Constraints</A>.
For other storage engines, the clauses are parsed but ignored.
The <code>CHECK</code> clause is parsed but ignored by all storage engines.
See section <A HREF="manual.html#CREATE_TABLE">14.2.5  <code>CREATE TABLE</code> Syntax</A>.
The reason for accepting but ignoring syntax clauses is for compatibility,
to make it easier to port code from other SQL servers, and to run applications
that create tables with references.
See section <A HREF="manual.html#Differences_from_ANSI">1.8.5  MySQL Differences from Standard SQL</A>.

<LI>

<A NAME="IDX1621"></A>
<A NAME="IDX1622"></A>
<A NAME="IDX1623"></A>
Starting from MySQL 4.0.13, <code>InnoDB</code> supports the use of <code>ALTER
TABLE</code> to drop foreign keys:


<PRE>
ALTER TABLE <var>yourtablename</var> DROP FOREIGN KEY <var>fk_symbol</var>;
</PRE>

For more information, see
section <A HREF="manual.html#InnoDB_foreign_key_constraints">16.7.4  <code>FOREIGN KEY</code> Constraints</A>.

<LI>

<code>ALTER TABLE</code> ignores the <code>DATA DIRECTORY</code> and <code>INDEX
DIRECTORY</code> table options.

<LI>

<A NAME="IDX1624"></A>
From MySQL 4.1.2 on,
if you want to change all character columns (<code>CHAR</code>, <code>VARCHAR</code>,
<code>TEXT</code>) to a new character set, use a statement like this:


<PRE>
ALTER TABLE <var>tbl_name</var> CONVERT TO CHARACTER SET <var>charset_name</var>;
</PRE>

This is useful, for example, after upgrading from MySQL 4.0.x to 4.1.x.
See section <A HREF="manual.html#Charset-upgrading">11.10  Upgrading Character Sets from MySQL 4.0</A>.

<strong>Warning:</strong> The preceding operation will convert column values between
the character sets. This is <em>not</em> what you want if you have a column in
one character set (like <code>latin1</code>) but the stored values actually use
some other, incompatible character set (like <code>utf8</code>). In this case,
you have to do the following for each such column:


<PRE>
ALTER TABLE t1 CHANGE c1 c1 BLOB;
ALTER TABLE t1 CHANGE c1 c1 TEXT CHARACTER SET utf8;
</PRE>

The reason this works is that there is no conversion when you convert
to or from <code>BLOB</code> columns.

To change only the <em>default</em> character set for a table, use this
statement:


<PRE>
ALTER TABLE <var>tbl_name</var> DEFAULT CHARACTER SET <var>charset_name</var>;
</PRE>

The word <code>DEFAULT</code> is optional.
The default character set is the character set that is used if
you don't specify the character set for a new column you add to a table
(for example, with <code>ALTER TABLE ... ADD column</code>).

<strong>Warning:</strong> From MySQL 4.1.2 and up, <code>ALTER TABLE ... DEFAULT
CHARACTER SET</code> and <code>ALTER TABLE ... CHARACTER SET</code> are equivalent and
change only the default table character set. In MySQL 4.1 releases before
4.1.2, <code>ALTER TABLE ...  DEFAULT CHARACTER SET</code> changes the default
character set, but <code>ALTER TABLE ...  CHARACTER SET</code> (without
<code>DEFAULT</code>) changes the default character set <em>and also</em> converts
all columns to the new character set.

<LI>

<A NAME="IDX1625"></A>
<A NAME="IDX1626"></A>
For an <code>InnoDB</code> table that is created with its own tablespace in an
<tt>`.ibd'</tt> file, that file can be discarded and imported. To discard the
<tt>`.ibd'</tt> file, use this statement:


<PRE>
ALTER TABLE <var>tbl_name</var> DISCARD TABLESPACE;
</PRE>

This deletes the current <tt>`.ibd'</tt> file, so be sure that you have a backup
first. Attempting to access the table while the tablespace file is discarded
results in an error.

To import the backup <tt>`.ibd'</tt> file back into the table, copy it into the
database directory, then issue this statement:


<PRE>
ALTER TABLE <var>tbl_name</var> IMPORT TABLESPACE;
</PRE>

See section <A HREF="manual.html#Multiple_tablespaces">16.7.6  Using Per-Table Tablespaces</A>.

<LI>

<A NAME="IDX1627"></A>
With the <code>mysql_info()</code> C API function, you can find out how many
records were copied, and (when <code>IGNORE</code> is used) how many records were
deleted due to duplication of unique key values.
See section <A HREF="manual.html#mysql_info">21.2.3.30  <code>mysql_info()</code></A>.

</UL>

<P>
Here are some examples that show uses of <code>ALTER TABLE</code>.
Begin with a table <code>t1</code> that is created as shown here:

</P>

<PRE>
mysql&#62; CREATE TABLE t1 (a INTEGER,b CHAR(10));
</PRE>

<P>
To rename the table from <code>t1</code> to <code>t2</code>:

</P>

<PRE>
mysql&#62; ALTER TABLE t1 RENAME t2;
</PRE>

<P>
To change column <code>a</code> from <code>INTEGER</code> to <code>TINYINT NOT NULL</code>
(leaving the name the same), and to change column <code>b</code> from
<code>CHAR(10)</code> to <code>CHAR(20)</code> as well as renaming it from <code>b</code> to
<code>c</code>:

</P>

<PRE>
mysql&#62; ALTER TABLE t2 MODIFY a TINYINT NOT NULL, CHANGE b c CHAR(20);
</PRE>

<P>
To add a new <code>TIMESTAMP</code> column named <code>d</code>:

</P>

<PRE>
mysql&#62; ALTER TABLE t2 ADD d TIMESTAMP;
</PRE>

<P>
To add indexes on column <code>d</code> and on column <code>a</code>:

</P>

<PRE>
mysql&#62; ALTER TABLE t2 ADD INDEX (d), ADD INDEX (a);
</PRE>

<P>
To remove column <code>c</code>:

</P>

<PRE>
mysql&#62; ALTER TABLE t2 DROP COLUMN c;
</PRE>

<P>
To add a new <code>AUTO_INCREMENT</code> integer column named <code>c</code>:

</P>

<PRE>
mysql&#62; ALTER TABLE t2 ADD c INT UNSIGNED NOT NULL AUTO_INCREMENT,
    -&#62;     ADD PRIMARY KEY (c);
</PRE>

<P>
Note that we indexed <code>c</code> (as a <code>PRIMARY KEY</code>), because
<code>AUTO_INCREMENT</code> columns must be indexed, and also that we declare
<code>c</code> as <code>NOT NULL</code>, because primary key columns cannot be
<code>NULL</code>.

</P>
<P>
When you add an <code>AUTO_INCREMENT</code> column, column values are filled in
with sequence numbers for you automatically.  For <code>MyISAM</code> tables,
you can set the first
sequence number by executing <code>SET INSERT_ID=<var>value</var></code> before
<code>ALTER TABLE</code> or by using the <code>AUTO_INCREMENT=<var>value</var></code> table option.
See section <A HREF="manual.html#SET_OPTION">14.5.3.1  <code>SET</code> Syntax</A>.

</P>
<P>
With <code>MyISAM</code> tables, if you don't change the <code>AUTO_INCREMENT</code>
column, the sequence number will not be affected. If you drop an
<code>AUTO_INCREMENT</code> column and then add another <code>AUTO_INCREMENT</code>
column, the numbers are resequenced beginning with 1.

</P>
<P>
See section <A HREF="manual.html#ALTER_TABLE_problems">A.7.1  Problems with <code>ALTER TABLE</code></A>.

</P>



<H3><A NAME="CREATE_DATABASE" HREF="manual_toc.html#CREATE_DATABASE">14.2.3  <code>CREATE DATABASE</code> Syntax</A></H3>

<P>
<A NAME="IDX1628"></A>

</P>

<PRE>
CREATE DATABASE [IF NOT EXISTS] <var>db_name</var>
    [<var>create_specification</var> [, <var>create_specification</var>] ...]

<var>create_specification</var>:
    [DEFAULT] CHARACTER SET <var>charset_name</var>
  | [DEFAULT] COLLATE <var>collation_name</var>
</PRE>

<P>
<code>CREATE DATABASE</code> creates a database with the given name.  
To use <code>CREATE DATABASE</code>, you need the <code>CREATE</code> privilege on the
database.

</P>
<P>
Rules for
allowable database names are given in section <A HREF="manual.html#Legal_names">10.2  Database, Table, Index, Column, and Alias Names</A>.  An error occurs if
the database already exists and you didn't specify <code>IF NOT EXISTS</code>.

</P>
<P>
As of MySQL 4.1.1, <code>create_specification</code> options can be given to
specify database characteristics.  Database characteristics are stored in
the <tt>`db.opt'</tt> file in the database directory.  The <code>CHARACTER SET</code>
clause specifies the default database character set.  The <code>COLLATE</code>
clause specifies the default database collation.  Character set and
collation names are discussed in section <A HREF="manual.html#Charset">11  Character Set Support</A>.

</P>
<P>
Databases in MySQL are implemented as directories containing files
that correspond to tables in the database.  Because there are no tables in a
database when it is initially created, the <code>CREATE DATABASE</code> statement
only creates a directory under the MySQL data directory (and the <tt>`db.opt'</tt>
file, for MySQL 4.1.1 and up).

</P>
<P>
<A NAME="IDX1629"></A>
You can also use the <code>mysqladmin</code> program to create databases.
See section <A HREF="manual.html#mysqladmin">8.4  <code>mysqladmin</code>, Administering a MySQL Server</A>.

</P>



<H3><A NAME="CREATE_INDEX" HREF="manual_toc.html#CREATE_INDEX">14.2.4  <code>CREATE INDEX</code> Syntax</A></H3>

<P>
<A NAME="IDX1630"></A>

</P>
<P>
<A NAME="IDX1631"></A>
<A NAME="IDX1632"></A>
<A NAME="IDX1633"></A>

</P>

<PRE>
CREATE [UNIQUE|FULLTEXT|SPATIAL] INDEX <var>index_name</var> [<var>index_type</var>]
    ON <var>tbl_name</var> (<var>index_col_name</var>,...)

<var>index_col_name</var>:
    <var>col_name</var> [(<var>length</var>)] [ASC | DESC]
</PRE>

<P>
In MySQL 3.22 or later, <code>CREATE INDEX</code> is mapped to an
<code>ALTER TABLE</code> statement to create indexes.
See section <A HREF="manual.html#ALTER_TABLE">14.2.2  <code>ALTER TABLE</code> Syntax</A>.
The <code>CREATE INDEX</code> statement doesn't do anything prior
to MySQL 3.22.

</P>
<P>
Normally, you create all indexes on a table at the time the table itself
is created with <code>CREATE TABLE</code>.
See section <A HREF="manual.html#CREATE_TABLE">14.2.5  <code>CREATE TABLE</code> Syntax</A>.
<code>CREATE INDEX</code> allows you to add indexes to existing tables.

</P>
<P>
A column list of the form <code>(col1,col2,...)</code> creates a multiple-column
index.  Index values are formed by concatenating the values of the given
columns.

</P>
<P>
For <code>CHAR</code> and <code>VARCHAR</code> columns, indexes can be created that
use only part of a column, using <code><var>col_name</var>(<var>length</var>)</code> syntax to index
a prefix consisting of the first <var>length</var> characters of each column
value. <code>BLOB</code> and <code>TEXT</code> columns also can be indexed, but a prefix
length <em>must</em> be given.

</P>
<P>
The statement shown here creates an index using the first 10 characters
of the <code>name</code> column:

</P>

<PRE>
CREATE INDEX part_of_name ON customer (name(10));
</PRE>

<P>
Because most names usually differ in the first 10 characters, this index should
not be much slower than an index created from the entire <code>name</code> column.
Also, using partial columns for indexes can make the index file much smaller,
which could save a lot of disk space and might also speed up <code>INSERT</code>
operations!

</P>
<P>
Prefixes can be up to 255 bytes long (or 1000 bytes for <code>MyISAM</code>
and <code>InnoDB</code> tables as of MySQL 4.1.2).  Note that prefix limits
are measured in bytes, whereas the prefix length in <code>CREATE INDEX</code>
statements is interpreted as number of characters.  Take this into account
when specifying a prefix length for a column that uses a multi-byte
character set.

</P>
<P>
Note that you can add an index on a column that can have <code>NULL</code>
values only if you are using MySQL 3.23.2 or newer and are using the
<code>MyISAM</code>, <code>InnoDB</code>, or <code>BDB</code> table type.  You can only add an
index on a <code>BLOB</code> or <code>TEXT</code> column if you are using
MySQL 3.23.2 or newer and are using the <code>MyISAM</code> or <code>BDB</code>
table type, or MySQL 4.0.14 or newer and the <code>InnoDB</code> table type.

</P>
<P>
An <var>index_col_name</var> specification can end with <code>ASC</code> or <code>DESC</code>.
These keywords are allowed for future extensions for specifying ascending
or descending index value storage.  Currently they are parsed but ignored;
index values are always stored in ascending order.

</P>
<P>
For more information about how MySQL uses indexes, see
section <A HREF="manual.html#MySQL_indexes">7.4.5  How MySQL Uses Indexes</A>.

</P>
<P>
<code>FULLTEXT</code> indexes can index only <code>CHAR</code>, <code>VARCHAR</code>, and
<code>TEXT</code> columns, and only in <code>MyISAM</code> tables. <code>FULLTEXT</code> indexes
are available in MySQL 3.23.23 or later.
section <A HREF="manual.html#Fulltext_Search">13.6  Full-Text Search Functions</A>.

</P>
<P>
<code>SPATIAL</code> indexes can index only spatial columns,
and only in <code>MyISAM</code> tables. <code>SPATIAL</code> indexes
are available in MySQL 4.1 or later. Spatial column types are described in
section <A HREF="manual.html#Spatial_extensions_in_MySQL">19  Spatial Extensions in MySQL</A>.

</P>



<H3><A NAME="CREATE_TABLE" HREF="manual_toc.html#CREATE_TABLE">14.2.5  <code>CREATE TABLE</code> Syntax</A></H3>

<P>
<A NAME="IDX1634"></A>

</P>


<PRE>
CREATE [TEMPORARY] TABLE [IF NOT EXISTS] <var>tbl_name</var>
    [(<var>create_definition</var>,...)]
    [<var>table_options</var>] [<var>select_statement</var>]
</PRE>

<P>
Or:

</P>

<PRE>
CREATE [TEMPORARY] TABLE [IF NOT EXISTS] <var>tbl_name</var>
    [(] LIKE <var>old_tbl_name</var> [)];

<var>create_definition</var>:
    <var>column_definition</var>
  | [CONSTRAINT [<var>symbol</var>]] PRIMARY KEY [<var>index_type</var>] (<var>index_col_name</var>,...)
  | KEY [<var>index_name</var>] [<var>index_type</var>] (<var>index_col_name</var>,...)
  | INDEX [<var>index_name</var>] [<var>index_type</var>] (<var>index_col_name</var>,...)
  | [CONSTRAINT [<var>symbol</var>]] UNIQUE [INDEX]
        [<var>index_name</var>] [<var>index_type</var>] (<var>index_col_name</var>,...)
  | [FULLTEXT|SPATIAL] [INDEX] [<var>index_name</var>] (<var>index_col_name</var>,...)
  | [CONSTRAINT [<var>symbol</var>]] FOREIGN KEY
        [<var>index_name</var>] (<var>index_col_name</var>,...) [<var>reference_definition</var>]
  | CHECK (<var>expr</var>)

<var>column_definition</var>:
    <var>col_name</var> <var>type</var> [NOT NULL | NULL] [DEFAULT <var>default_value</var>]
        [AUTO_INCREMENT] [[PRIMARY] KEY] [COMMENT '<var>string</var>']
        [<var>reference_definition</var>]

<var>type</var>:
    TINYINT[(<var>length</var>)] [UNSIGNED] [ZEROFILL]
  | SMALLINT[(<var>length</var>)] [UNSIGNED] [ZEROFILL]
  | MEDIUMINT[(<var>length</var>)] [UNSIGNED] [ZEROFILL]
  | INT[(<var>length</var>)] [UNSIGNED] [ZEROFILL]
  | INTEGER[(<var>length</var>)] [UNSIGNED] [ZEROFILL]
  | BIGINT[(<var>length</var>)] [UNSIGNED] [ZEROFILL]
  | REAL[(<var>length</var>,<var>decimals</var>)] [UNSIGNED] [ZEROFILL]
  | DOUBLE[(<var>length</var>,<var>decimals</var>)] [UNSIGNED] [ZEROFILL]
  | FLOAT[(<var>length</var>,<var>decimals</var>)] [UNSIGNED] [ZEROFILL]
  | DECIMAL(<var>length</var>,<var>decimals</var>) [UNSIGNED] [ZEROFILL]
  | NUMERIC(<var>length</var>,<var>decimals</var>) [UNSIGNED] [ZEROFILL]
  | DATE
  | TIME
  | TIMESTAMP
  | DATETIME
  | CHAR(<var>length</var>) [BINARY | ASCII | UNICODE]
  | VARCHAR(<var>length</var>) [BINARY]
  | TINYBLOB
  | BLOB
  | MEDIUMBLOB
  | LONGBLOB
  | TINYTEXT
  | TEXT
  | MEDIUMTEXT
  | LONGTEXT
  | ENUM(<var>value1</var>,<var>value2</var>,<var>value3</var>,...)
  | SET(<var>value1</var>,<var>value2</var>,<var>value3</var>,...)
  | <var>spatial_type</var>

<var>index_col_name</var>:
    <var>col_name</var> [(<var>length</var>)] [ASC | DESC]

<var>reference_definition</var>:
    REFERENCES <var>tbl_name</var> [(<var>index_col_name</var>,...)]
               [MATCH FULL | MATCH PARTIAL]
               [ON DELETE <var>reference_option</var>]
               [ON UPDATE <var>reference_option</var>]

<var>reference_option</var>:
    RESTRICT | CASCADE | SET NULL | NO ACTION | SET DEFAULT

<var>table_options</var>: <var>table_option</var> [<var>table_option</var>] ...

<var>table_option</var>:
    {ENGINE|TYPE} = {BDB|HEAP|ISAM|InnoDB|MERGE|MRG_MYISAM|MYISAM}
  | AUTO_INCREMENT = <var>value</var>
  | AVG_ROW_LENGTH = <var>value</var>
  | CHECKSUM = {0 | 1}
  | COMMENT = '<var>string</var>'
  | MAX_ROWS = <var>value</var>
  | MIN_ROWS = <var>value</var>
  | PACK_KEYS = {0 | 1 | DEFAULT}
  | PASSWORD = '<var>string</var>'
  | DELAY_KEY_WRITE = {0 | 1}
  | ROW_FORMAT = { DEFAULT | DYNAMIC | FIXED | COMPRESSED }
  | RAID_TYPE = { 1 | STRIPED | RAID0 }
        RAID_CHUNKS = <var>value</var>
        RAID_CHUNKSIZE = <var>value</var>
  | UNION = (<var>tbl_name</var>[,<var>tbl_name</var>]...)
  | INSERT_METHOD = { NO | FIRST | LAST }
  | DATA DIRECTORY = '<var>absolute path to directory</var>'
  | INDEX DIRECTORY = '<var>absolute path to directory</var>'
  | [DEFAULT] CHARACTER SET <var>charset_name</var> [COLLATE <var>collation_name</var>]

<var>select_statement:</var>
    [IGNORE | REPLACE] [AS] SELECT ...   (<var>Some legal select statement</var>)
</PRE>

<P>
<code>CREATE TABLE</code> creates a table with the given name.
You must have the <code>CREATE</code> privilege for the table.

</P>
<P>
Rules for allowable table names are given in section <A HREF="manual.html#Legal_names">10.2  Database, Table, Index, Column, and Alias Names</A>.  
By default, the table is created in the current database.  
An error occurs if the table already exists, if there is no current database,
or if the database does not exist.

</P>
<P>
In MySQL 3.22 or later, the table name can be specified as
<var>db_name.tbl_name</var> to create the table in a specific database.
This works whether or not there is a current database.
If you use quoted identifiers, quote the database and table names
separately. For example, <code>`mydb`.`mytbl`</code> is legal, but
<code>`mydb.mytbl`</code> is not.

</P>
<P>
From MySQL 3.23 on, you can use the <code>TEMPORARY</code> keyword when
creating a table. A <code>TEMPORARY</code> table is visible only to the
current connection, and is dropped automatically when the
connection is closed.  This means that two different
connections can use the same temporary table name without conflicting
with each other or with an existing non-<code>TEMPORARY</code> table of the same
name. (The existing table is hidden until the temporary table is dropped.)
From MySQL 4.0.2 on, you must have the <code>CREATE TEMPORARY TABLES</code>
privilege to be able to create temporary tables.

</P>
<P>
In MySQL 3.23 or later, you can use the keywords
<code>IF NOT EXISTS</code> so that an error does not occur if the table already
exists.  Note that there is no verification that the existing table has a
structure identical to that indicated by the <code>CREATE TABLE</code> statement.

</P>
<P>
MySQL represents each table by an <tt>`.frm'</tt> table format
(definition) file in the database directory. The storage engine for the table
might create other files as well.
In the case of <code>MyISAM</code> tables, the storage engine creates three files
for a table named <var>tbl_name</var>:

</P>
<TABLE BORDER>
<TR><TD><strong>File</strong> </TD><TD> <strong>Purpose</strong>
</TD></TR>
<TR><TD><code><var>tbl_name</var>.frm</code> </TD><TD> Table format (definition) file
</TD></TR>
<TR><TD><code><var>tbl_name</var>.MYD</code> </TD><TD> Data file
</TD></TR>
<TR><TD><code><var>tbl_name</var>.MYI</code> </TD><TD> Index file
</TD></TR>
</TABLE>

<P>
The files created by each storage engine to represent tables are described in
section <A HREF="manual.html#Table_types">15  MySQL Storage Engines and Table Types</A>.

</P>
<P>
For general information on the properties of the various column types, see
section <A HREF="manual.html#Column_types">12  Column Types</A>.
For information about spatial column types, see
section <A HREF="manual.html#Spatial_extensions_in_MySQL">19  Spatial Extensions in MySQL</A>.

</P>

<UL>
<LI>

If neither <code>NULL</code> nor <code>NOT NULL</code> is specified, the column
is treated as though <code>NULL</code> had been specified.

<LI>

An integer column can have the additional attribute <code>AUTO_INCREMENT</code>.
When you insert a value of <code>NULL</code> (recommended) or <code>0</code> into an
indexed
<code>AUTO_INCREMENT</code> column, the column is set to the next sequence value.
Typically this is <code><var>value</var>+1</code>, where
<var>value</var> is the largest value for the column currently in the table.
<code>AUTO_INCREMENT</code> sequences begin with <code>1</code>.
See section <A HREF="manual.html#mysql_insert_id">21.2.3.32  <code>mysql_insert_id()</code></A>.

As of MySQL 4.1.1, specifying the <code>NO_AUTO_VALUE_ON_ZERO</code> flag for the
<code>--sql-mode</code> server option or the <code>sql_mode</code> system variable allows
you to store <code>0</code> in <code>AUTO_INCREMENT</code> columns as <code>0</code> without
generating a new sequence value.
See section <A HREF="manual.html#Server_options">5.2.1  <code>mysqld</code> Command-Line Options</A>.

<strong>Note</strong>: There can be only one <code>AUTO_INCREMENT</code> column per
table, it must be indexed, and it cannot have a <code>DEFAULT</code> value.
As of MySQL 3.23, an <code>AUTO_INCREMENT</code> column will work properly
only if it contains only positive values. Inserting a
negative number is regarded as inserting a very large positive number.
This is done to avoid precision problems when numbers ``wrap'' over from
positive to negative and also to ensure that you don't accidentally
get an <code>AUTO_INCREMENT</code> column that contains <code>0</code>.

For <code>MyISAM</code> and <code>BDB</code> tables, you can specify an
<code>AUTO_INCREMENT</code> secondary column in a multiple-column key.
See section <A HREF="manual.html#example-AUTO_INCREMENT">3.6.9  Using <code>AUTO_INCREMENT</code></A>.

<A NAME="IDX1635"></A>
<A NAME="IDX1636"></A>
To make MySQL compatible with some ODBC applications, you can find the
<code>AUTO_INCREMENT</code> value for the last inserted row with the following query:


<PRE>
SELECT * FROM <var>tbl_name</var> WHERE <var>auto_col</var> IS NULL
</PRE>

<LI>

As of MySQL 4.1, character column definitions can include a <code>CHARACTER
SET</code> attribute to specify the character set and, optionally, a collation
for the column. For details, see section <A HREF="manual.html#Charset">11  Character Set Support</A>.


<PRE>
CREATE TABLE t (c CHAR(20) CHARACTER SET utf8 COLLATE utf8_bin);
</PRE>

Also as of 4.1, MySQL interprets length specifications in character column
definitions in characters. (Earlier versions interpret them in bytes.)

<LI>

<code>NULL</code> values are handled differently for <code>TIMESTAMP</code> columns than
for other column types.  You cannot store a literal <code>NULL</code> in a
<code>TIMESTAMP</code> column; setting the column to <code>NULL</code> sets it to the
current date and time.  Because <code>TIMESTAMP</code> columns behave this way, the
<code>NULL</code> and <code>NOT NULL</code> attributes do not apply in the normal way and
are ignored if you specify them.

On the other hand, to make it easier for MySQL clients to use
<code>TIMESTAMP</code> columns, the server reports that such columns can be
assigned <code>NULL</code> values (which is true), even though <code>TIMESTAMP</code>
never actually will contain a <code>NULL</code> value.  You can see this when you
use <code>DESCRIBE <var>tbl_name</var></code> to get a description of your table.

Note that setting a <code>TIMESTAMP</code> column to <code>0</code> is not the same
as setting it to <code>NULL</code>, because <code>0</code> is a valid <code>TIMESTAMP</code>
value.

<LI>

<A NAME="IDX1637"></A>
With one exception,
a <code>DEFAULT</code> value must be a constant; it cannot be a function or
an expression.  This means, for example, that you cannot
set the default for a date column to be the value of a function such as
<code>NOW()</code> or <code>CURRENT_DATE</code>. The exception is that you can specify
<code>CURRENT_TIMESTAMP</code> as the default for a <code>TIMESTAMP</code> column as of
MySQL 4.1.2.
See section <A HREF="manual.html#TIMESTAMP_4.1">12.3.1.2  <code>TIMESTAMP</code> Properties as of MySQL 4.1</A>.

If no <code>DEFAULT</code> value is specified for a column, MySQL
automatically assigns one, as follows.

If the column can take <code>NULL</code> as a value, the default value is
<code>NULL</code>.

If the column is declared as <code>NOT NULL</code>, the default value depends on
the column type:


<UL>
<LI>

For numeric types other than those declared with the <code>AUTO_INCREMENT</code>
attribute, the default is <code>0</code>.  For an <code>AUTO_INCREMENT</code> column, the
default value is the next value in the sequence.

<LI>

For date and time types other than <code>TIMESTAMP</code>, the default is the
appropriate ``zero'' value for the type.  For the first <code>TIMESTAMP</code>
column in a table, the default value is the current date and time.
See section <A HREF="manual.html#Date_and_time_types">12.3  Date and Time Types</A>.

<LI>

For string types other than <code>ENUM</code>, the default value is the empty
string.  For <code>ENUM</code>, the default is the first enumeration value.
</UL>

<code>BLOB</code> and <code>TEXT</code> columns cannot be assigned a default value.

<LI>

<A NAME="IDX1638"></A>
A comment for a column can be specified with the <code>COMMENT</code> option.
The comment is displayed by the
<code>SHOW CREATE TABLE</code> and <code>SHOW FULL COLUMNS</code> statements.
This option is operational as of MySQL 4.1.
(It is allowed but ignored in earlier versions.)

<LI>

From MySQL 4.1.0 on, the attribute <code>SERIAL</code> can be used as an alias
for <code>BIGINT UNSIGNED NOT NULL AUTO_INCREMENT UNIQUE</code>. This is a
compatibility feature.

<LI>

<code>KEY</code> is normally a synonym for <code>INDEX</code>.  From MySQL 4.1, the key
attribute <code>PRIMARY KEY</code> can also be specified as just <code>KEY</code> when
given in a column definition. This was implemented for compatibility with
other database systems.

<LI>

In MySQL, a <code>UNIQUE</code> index is one in which all values in the index
must be distinct.  An error occurs if you try to add a new row with a key
that matches an existing row.  The exception to this is that if a column
in the index is allowed to contain <code>NULL</code> values, it can contain
multiple <code>NULL</code> values.  This exception does not apply to <code>BDB</code>
tables, for which indexed columns allow only a single <code>NULL</code>.

<LI>

<A NAME="IDX1639"></A>
A <code>PRIMARY KEY</code> is a unique <code>KEY</code> where all key columns must be
defined as <code>NOT NULL</code>. If they are not explicitly declared as <code>NOT
NULL</code>, MySQL will declare them so implicitly (and silently).  A table can
have only one <code>PRIMARY KEY</code>.  If you don't have a <code>PRIMARY KEY</code>
and an application asks for the <code>PRIMARY KEY</code> in your tables, MySQL
returns the first <code>UNIQUE</code> index that has no <code>NULL</code> columns as
the <code>PRIMARY KEY</code>.

<LI>

In the created table, a <code>PRIMARY KEY</code> is placed first, followed
by all <code>UNIQUE</code> indexes, and then the non-unique indexes.  This helps the
MySQL optimizer to prioritize which index to use and also more quickly
to detect duplicated <code>UNIQUE</code> keys.

<LI>

A <code>PRIMARY KEY</code> can be a multiple-column index.  However, you cannot
create a multiple-column index using the <code>PRIMARY KEY</code> key attribute in a
column specification.  Doing so will mark only that single column as primary.
You must use a separate <code>PRIMARY KEY(index_col_name, ...)</code> clause.

<LI>

If a <code>PRIMARY KEY</code> or <code>UNIQUE</code> index consists of only one column
that has an integer type, you can also refer to the column as <code>_rowid</code>
in <code>SELECT</code> statements (new in MySQL 3.23.11).

<LI>

In MySQL, the name of a <code>PRIMARY KEY</code> is <code>PRIMARY</code>.  For other
indexes, if you don't assign a name, the index is assigned the same name as
the first indexed column, with an optional suffix (<code>_2</code>, <code>_3</code>,
<code>...</code>) to make it unique.  You can see index names for a table using
<code>SHOW INDEX FROM <var>tbl_name</var></code>.
See section <A HREF="manual.html#Show_database_info">14.5.3.7  <code>SHOW DATABASES</code> Syntax</A>.

<LI>

From MySQL 4.1.0 on, some storage engines allow you to specify an index
type when creating an index.  The syntax for the <var>index_type</var>
specifier is <code>USING type_name</code>. The allowable <code>type_name</code>
values supported by different storage engines are shown in the following
table. Where multiple index types are listed, the first one is the
default when no <var>index_type</var> specifier is given.

<TABLE BORDER>
<TR><TD><strong>Storage Engine</strong> </TD><TD> <strong>Allowable Index Types</strong>
</TD></TR>
<TR><TD><code>MyISAM</code> </TD><TD> <code>BTREE</code>
</TD></TR>
<TR><TD><code>InnoDB</code> </TD><TD> <code>BTREE</code>
</TD></TR>
<TR><TD><code>MEMORY/HEAP</code> </TD><TD> <code>HASH</code>, <code>BTREE</code>
</TD></TR>
</TABLE>

Example:


<PRE>
CREATE TABLE lookup
    (id INT, INDEX USING BTREE (id))
    ENGINE = MEMORY;
</PRE>

<code>TYPE type_name</code> can be used as a synonym for <code>USING type_name</code>
to specify an index type.  However, <code>USING</code> is the preferred form.
Also, the index name name that precedes the index type in the index
specification syntax is not optional with <code>TYPE</code>. This is because,
unlike <code>USING</code>, <code>TYPE</code> is not a reserved word and thus is
interpreted as an index name.

If you specify an index type that is not legal for a storage engine,
but there is another index type available that the engine can use without
affecting query results, the engine will use the available type.

<LI>

<A NAME="IDX1640"></A>
<A NAME="IDX1641"></A>
Only the <code>MyISAM</code>, <code>InnoDB</code>, <code>BDB</code>, and (as of MySQL 4.0.2)
<code>MEMORY</code> storage engines support indexes on columns that can have
<code>NULL</code> values. In other cases, you must declare indexed columns
as <code>NOT NULL</code> or an error results.

<LI>

With <code><var>col_name</var>(<var>length</var>)</code> syntax in an index specification, you can create
an index that uses only the first <var>length</var> characters of a <code>CHAR</code>
or <code>VARCHAR</code> column. Indexing only a prefix of column values like this
can make the index file much smaller.
See section <A HREF="manual.html#Indexes">7.4.3  Column Indexes</A>.

<A NAME="IDX1642"></A>
<A NAME="IDX1643"></A>
<A NAME="IDX1644"></A>
<A NAME="IDX1645"></A>
The <code>MyISAM</code> and (as of MySQL 4.0.14) <code>InnoDB</code> storage engines also
support indexing on <code>BLOB</code> and <code>TEXT</code> columns.  When indexing
a <code>BLOB</code> or <code>TEXT</code> column, you <em>must</em> specify a prefix
length for the index. For example:


<PRE>
CREATE TABLE test (blob_col BLOB, INDEX(blob_col(10)));
</PRE>

Prefixes can be up to 255 bytes long (or 1000 bytes for <code>MyISAM</code>
and <code>InnoDB</code> tables as of MySQL 4.1.2).  Note that prefix limits
are measured in bytes, whereas the prefix length in <code>CREATE TABLE</code>
statements is interpreted as number of characters.  Take this into account
when specifying a prefix length for a column that uses a multi-byte
character set.

<LI>

An <var>index_col_name</var> specification can end with <code>ASC</code> or <code>DESC</code>.
These keywords are allowed for future extensions for specifying ascending
or descending index value storage.  Currently they are parsed but ignored;
index values are always stored in ascending order.

<LI>

When you use <code>ORDER BY</code> or <code>GROUP BY</code> with a <code>TEXT</code> or
<code>BLOB</code> column, the server sorts values using only the initial number of
bytes indicated by the <code>max_sort_length</code> system variable.
See section <A HREF="manual.html#BLOB">12.4.2  The <code>BLOB</code> and <code>TEXT</code> Types</A>.

<LI>

In MySQL 3.23.23 or later, you can create special
<code>FULLTEXT</code> indexes. They are used for full-text search. Only the
<code>MyISAM</code> table type supports <code>FULLTEXT</code> indexes. They can be created
only from <code>CHAR</code>, <code>VARCHAR</code>, and <code>TEXT</code> columns.
Indexing always happens over the entire column; partial indexing is not
supported and any prefix length is ignored if specified. See section <A HREF="manual.html#Fulltext_Search">13.6  Full-Text Search Functions</A> for details of operation.

<LI>

In MySQL 4.1 or later, you can create special <code>SPATIAL</code> indexes on
spatial column types. Spatial types are supported only for <code>MyISAM</code>
tables and indexed columns must be declared as <code>NOT NULL</code>.  See
section <A HREF="manual.html#Spatial_extensions_in_MySQL">19  Spatial Extensions in MySQL</A>.

<LI>

In MySQL 3.23.44 or later, <code>InnoDB</code> tables support checking of
foreign key constraints. See section <A HREF="manual.html#InnoDB">16  The <code>InnoDB</code> Storage Engine</A>. Note that the
<code>FOREIGN KEY</code> syntax in <code>InnoDB</code> is more restrictive than
the syntax presented for the <code>CREATE TABLE</code> statement at the beginning of
this section: The columns of the referenced
table must always be explicitly named.
<code>InnoDB</code> supports both <code>ON DELETE</code> and <code>ON UPDATE</code>
actions on foreign keys as of MySQL 3.23.50 and 4.0.8, respectively.
For the precise syntax, see
section <A HREF="manual.html#InnoDB_foreign_key_constraints">16.7.4  <code>FOREIGN KEY</code> Constraints</A>.

For other storage engines, MySQL Server parses the <code>FOREIGN KEY</code>
and <code>REFERENCES</code> syntax in <code>CREATE TABLE</code> statements,
but without further action being taken.
The <code>CHECK</code> clause is parsed but ignored by all storage engines.
 See section <A HREF="manual.html#ANSI_diff_Foreign_Keys">1.8.5.5  Foreign Keys</A>.

<LI>

For <code>MyISAM</code> and <code>ISAM</code> tables,
each <code>NULL</code> column takes one bit extra, rounded up to the nearest byte.
The maximum record length in bytes can be calculated as follows:


<PRE>
row length = 1
             + (<var>sum of column lengths</var>)
             + (<var>number of NULL columns</var> + <var>delete_flag</var> + 7)/8
             + (<var>number of variable-length columns</var>)
</PRE>

<var>delete_flag</var> is 1 for tables with static record format. Static
tables use a bit in the row record for a flag that indicates whether
the row has been deleted.  <var>delete_flag</var> is 0 for dynamic tables
because the flag is stored in the dynamic row header.

These calculations do not apply for <code>InnoDB</code> tables, for which
storage size is no different for <code>NULL</code> columns than for <code>NOT
NULL</code> columns.

</UL>

<P>
The <code>table_options</code> part of the <code>CREATE TABLE</code> syntax can be used
in MySQL 3.23 and above.

</P>
<P>
The <code>ENGINE</code> and <code>TYPE</code> options specify the storage engine for the
table.  <code>ENGINE</code> was added in MySQL 4.0.18 (for 4.0) and 4.1.2 (for 4.1).
It is the preferred option name as of those versions, and <code>TYPE</code> has
become deprecated.  <code>TYPE</code> will be supported throughout the 4.x series,
but likely will be removed in MySQL 5.1.

</P>
<P>
The <code>ENGINE</code> and <code>TYPE</code> options take the following values:

</P>
<TABLE BORDER>
<TR><TD><strong>Storage Engine</strong> </TD><TD> <strong>Description</strong>
</TD></TR>
<TR><TD><code>BDB</code> </TD><TD> Transaction-safe tables with page locking. See section <A HREF="manual.html#BDB">15.4  The <code>BDB</code> (<code>BerkeleyDB</code>) Storage Engine</A>.
</TD></TR>
<TR><TD><code>BerkeleyDB</code> </TD><TD> An alias for <code>BDB</code>.
</TD></TR>
<TR><TD><code>HEAP</code> </TD><TD> The data for this table is stored only in memory.  See section <A HREF="manual.html#HEAP">15.3  The <code>MEMORY</code> (<code>HEAP</code>) Storage Engine</A>.
</TD></TR>
<TR><TD><code>ISAM</code> </TD><TD> The original MySQL storage engine. See section <A HREF="manual.html#ISAM">15.5  The <code>ISAM</code> Storage Engine</A>.
</TD></TR>
<TR><TD><code>InnoDB</code> </TD><TD> Transaction-safe tables with row locking and foreign keys.  See section <A HREF="manual.html#InnoDB">16  The <code>InnoDB</code> Storage Engine</A>.
</TD></TR>
<TR><TD><code>MEMORY</code> </TD><TD> An alias for <code>HEAP</code>. (Actually, as of MySQL 4.1, <code>MEMORY</code> is the preferred term.)
</TD></TR>
<TR><TD><code>MERGE</code> </TD><TD> A collection of <code>MyISAM</code> tables used as one table. See section <A HREF="manual.html#MERGE">15.2  The <code>MERGE</code> Storage Engine</A>.
</TD></TR>
<TR><TD><code>MRG_MyISAM</code> </TD><TD> An alias for <code>MERGE</code>.
</TD></TR>
<TR><TD><code>MyISAM</code> </TD><TD> The binary portable storage engine that is the improved replacement for <code>ISAM</code>. See section <A HREF="manual.html#MyISAM">15.1  The <code>MyISAM</code> Storage Engine</A>.
</TD></TR>
</TABLE>

<P>
See section <A HREF="manual.html#Table_types">15  MySQL Storage Engines and Table Types</A>.

</P>
<P>
If a storage engine is specified that is not available,
MySQL uses <code>MyISAM</code> instead.
For example, if a table definition includes the <code>ENGINE=BDB</code> option but the
MySQL server does not support <code>BDB</code> tables, the table is created
as a <code>MyISAM</code> table.  This makes it possible to have a replication
setup where you have transactional tables on the master but tables created
on the slave are non-transactional (to get more speed).  In MySQL 4.1.1, a
warning occurs if the storage engine specification is not honored.

</P>
<P>
The other table options are used to optimize the behavior of the
table. In most cases, you don't have to specify any of them.
The options work for all storage engines unless otherwise indicated:

</P>
<DL COMPACT>

<DT><code>AUTO_INCREMENT</code>
<DD>
The initial <code>AUTO_INCREMENT</code> value for the table. This works for
<code>MyISAM</code> only. To set the first auto-increment value for an <code>InnoDB</code>
table, insert a dummy row with a value one less than the desired value after
creating the table, and then delete the dummy row.

<DT><code>AVG_ROW_LENGTH</code>
<DD>
An approximation of the average row length for your table. You need to
set this only for large tables with variable-size records.

When you create a <code>MyISAM</code> table, MySQL uses the product of the
<code>MAX_ROWS</code> and <code>AVG_ROW_LENGTH</code> options to decide how big the
resulting table will be.  If you don't specify either option, the maximum
size for a table will be 4GB (or 2GB if your operating system only supports
2GB tables). The reason for this is just to keep down the pointer sizes to
make the index smaller and faster if you don't really need big files.  If
you want all your tables to be able to grow above the 4GB limit and are
willing to have your smaller tables slightly slower and larger than
necessary, you may increase the default pointer size by setting the
<code>myisam_data_pointer_size</code> system variable, which was added in MySQL
4.1.2.
See section <A HREF="manual.html#Server_system_variables">5.2.3  Server System Variables</A>.

<DT><code>CHECKSUM</code>
<DD>
Set this to 1 if you want MySQL to maintain a live checksum for all rows
(that is, a checksum that MySQL updates automatically as the table changes).
This makes the table a little slower to update, but also makes it easier to
find corrupted tables.  The <code>CHECKSUM TABLE</code> statement reports the
checksum.  (<code>MyISAM</code> only.)

<DT><code>COMMENT</code>
<DD>
A comment for your table, up to 60 characters long.

<DT><code>MAX_ROWS</code>
<DD>
The maximum number of rows you plan to store in the table.

<DT><code>MIN_ROWS</code>
<DD>
The minimum number of rows you plan to store in the table.

<DT><code>PACK_KEYS</code>
<DD>
Set this option to 1 if you want to have smaller indexes.  This usually
makes updates slower and reads faster.
Setting the option to 0 disables all packing of keys. Setting it to
<code>DEFAULT</code> (MySQL 4.0) tells the storage engine to only pack long
<code>CHAR</code>/<code>VARCHAR</code> columns.
(<code>MyISAM</code> and <code>ISAM</code> only.)

If you don't use <code>PACK_KEYS</code>, the default is to only pack strings,
not numbers.  If you use <code>PACK_KEYS=1</code>, numbers will be packed as well.

When packing binary number keys, MySQL uses prefix compression:


<UL>
<LI>

Every key needs one extra byte to indicate how many bytes of the previous
key are the same for the next key.

<LI>

The pointer to the row is stored in high-byte-first order directly after
the key, to improve compression.

</UL>

This means that if you have many equal keys on two consecutive rows,
all following ``same'' keys will usually only take two bytes (including the
pointer to the row).  Compare this to the ordinary case where the following
keys will take <code>storage_size_for_key + pointer_size</code> (where the pointer
size is usually 4). Conversely,
you will get a big benefit from prefix compression only if you have many
numbers that are the same.  If all keys are totally different, you will
use one byte more per key, if the key isn't a key that can have <code>NULL</code>
values. (In this case, the packed key length will be stored in the same
byte that is used to mark if a key is <code>NULL</code>.)

<DT><code>PASSWORD</code>
<DD>
Encrypt the <tt>`.frm'</tt> file with a password.  This option doesn't do anything in the standard MySQL version.

<DT><code>DELAY_KEY_WRITE</code>
<DD>
Set this to 1 if you want to delay key updates for the table until the table
is closed. (<code>MyISAM</code> only.)

<DT><code>ROW_FORMAT</code>
<DD>
Defines how the rows should be stored. Currently this option works only with
<code>MyISAM</code> tables. The option value can <code>FIXED</code> or <code>DYNAMIC</code> for
static or variable-length row format. <code>myisampack</code> sets the type to
<code>COMPRESSED</code>.
See section <A HREF="manual.html#MyISAM_table_formats">15.1.3  <code>MyISAM</code> Table Storage Formats</A>.

<DT><code>RAID_TYPE</code>
<DD>
<A NAME="IDX1646"></A>
<A NAME="IDX1647"></A>
The <code>RAID_TYPE</code> option can help you to exceed the 2GB/4GB limit for
the <code>MyISAM</code> data file (not the index file) on operating systems that
don't support big files. This option is unnecessary and not recommended for
filesystems that support big files.

You can get more speed from the I/O bottleneck by putting <code>RAID</code>
directories on different physical disks.  For now, the only allowed
<code>RAID_TYPE</code> is <code>STRIPED</code>. <code>1</code> and <code>RAID0</code> are aliases
for <code>STRIPED</code>.

If you specify the <code>RAID_TYPE</code> option for a <code>MyISAM</code> table,
specify the <code>RAID_CHUNKS</code> and <code>RAID_CHUNKSIZE</code> options as well.
The maximum <code>RAID_CHUNKS</code> value is 255.
<code>MyISAM</code> will create <code>RAID_CHUNKS</code> subdirectories named <tt>`00'</tt>,
<tt>`01'</tt>, <tt>`02'</tt>, ... <tt>`09'</tt>, <tt>`0a'</tt>, <tt>`0b'</tt>, ...
in the database directory.  In each of these directories, <code>MyISAM</code>
will create a file <tt>`<var>tbl_name</var>.MYD'</tt>.  When writing data to the data file,
the <code>RAID</code> handler maps the first <code>RAID_CHUNKSIZE*1024</code> bytes to
the first file, the next <code>RAID_CHUNKSIZE*1024</code> bytes to the next file,
and so on.

<code>RAID_TYPE</code> works on any operating system, as long as you have built
MySQL with the <code>--with-raid</code> option to <code>configure</code>. To determine
whether a server supports <code>RAID</code> tables, use <code>SHOW VARIABLES LIKE
'have_raid'</code> to see whether the variable value is <code>YES</code>.

<DT><code>UNION</code>
<DD>
<code>UNION</code> is used when you want to use a collection of identical
tables as one. This works only with <code>MERGE</code> tables.
See section <A HREF="manual.html#MERGE">15.2  The <code>MERGE</code> Storage Engine</A>.

For the moment, you must have <code>SELECT</code>, <code>UPDATE</code>, and
<code>DELETE</code> privileges for the tables you map to a <code>MERGE</code> table.
Originally, all used tables had to be in the same database
as the <code>MERGE</code> table itself. This restriction has been lifted as of
MySQL 4.1.1.

<DT><code>INSERT_METHOD</code>
<DD>
If you want to insert data in a <code>MERGE</code> table, you have to specify with
<code>INSERT_METHOD</code> into which table the row should be inserted.
<code>INSERT_METHOD</code> is an option useful for <code>MERGE</code> tables only. 
This option was introduced in MySQL 4.0.0.
See section <A HREF="manual.html#MERGE">15.2  The <code>MERGE</code> Storage Engine</A>.

<DT><code>DATA DIRECTORY</code>
<DD>
<DT><code>INDEX DIRECTORY</code>
<DD>
By using <code>DATA DIRECTORY='<var>directory</var>'</code> or <code>INDEX
DIRECTORY='<var>directory</var>'</code> you can specify where the <code>MyISAM</code> storage engine should
put a table's data file and index file.  Note that the directory should be a full
path to the directory (not a relative path).

These options work only for <code>MyISAM</code> tables from MySQL 4.0 on, when
you are not using the <code>--skip-symbolic-links</code> option. Your operating
system must also have a working, thread-safe <code>realpath()</code> call.
See section <A HREF="manual.html#Symbolic_links_to_tables">7.6.1.2  Using Symbolic Links for Tables on Unix</A>.

</DL>

<P>
<A NAME="IDX1648"></A>
<A NAME="IDX1649"></A>

</P>
<P>
As of MySQL 3.23, you can create one table from another by adding a
<code>SELECT</code> statement at the end of the <code>CREATE TABLE</code> statement:

</P>

<PRE>
CREATE TABLE <var>new_tbl</var> SELECT * FROM <var>orig_tbl</var>;
</PRE>

<P>
MySQL will create new column for all elements
in the <code>SELECT</code>.  For example:

</P>

<PRE>
mysql&#62; CREATE TABLE test (a INT NOT NULL AUTO_INCREMENT,
    -&#62;        PRIMARY KEY (a), KEY(b))
    -&#62;        TYPE=MyISAM SELECT b,c FROM test2;
</PRE>

<P>
This creates a <code>MyISAM</code> table with three columns, <code>a</code>, <code>b</code>,
and <code>c</code>.  Notice that the columns from the <code>SELECT</code> statement
are appended to the right side of the table, not overlapped onto it.
Take the following example:

</P>

<PRE>
mysql&#62; SELECT * FROM foo;
+---+
| n |
+---+
| 1 |
+---+

mysql&#62; CREATE TABLE bar (m INT) SELECT n FROM foo;
Query OK, 1 row affected (0.02 sec)
Records: 1  Duplicates: 0  Warnings: 0

mysql&#62; SELECT * FROM bar;
+------+---+
| m    | n |
+------+---+
| NULL | 1 |
+------+---+
1 row in set (0.00 sec)
</PRE>

<P>
For each row in table <code>foo</code>, a row is inserted in <code>bar</code> with
the values from <code>foo</code> and default values for the new columns.

</P>
<P>
If any errors occur while copying the data to the table, it is
automatically dropped and not created.

</P>
<P>
<code>CREATE TABLE ... SELECT</code> will not automatically create any indexes
for you.  This is done intentionally to make the statement as flexible as
possible.  If you want to have indexes in the created table, you should
specify these before the <code>SELECT</code> statement:

</P>

<PRE>
mysql&#62; CREATE TABLE bar (UNIQUE (n)) SELECT n FROM foo;
</PRE>

<P>
Some conversion of column types might occur. For example, the
<code>AUTO_INCREMENT</code> attribute is not preserved, and <code>VARCHAR</code>
columns can become <code>CHAR</code> columns.

</P>
<P>
When creating a table with <code>CREATE ... SELECT</code>, make sure to alias any
function calls or expressions in the query. If you do not, the <code>CREATE</code>
statement might fail or result in undesirable column names.

</P>

<PRE>
CREATE TABLE artists_and_works
SELECT artist.name, COUNT(work.artist_id) AS number_of_works
FROM artist LEFT JOIN work ON artist.id = work.artist_id
GROUP BY artist.id;
</PRE>

<P>
As of MySQL 4.1, you can explicitly specify the type for a generated column:

</P>

<PRE>
CREATE TABLE foo (a TINYINT NOT NULL) SELECT b+1 AS a FROM bar;
</PRE>

<P>
In MySQL 4.1, you can also use <code>LIKE</code> to create an empty table based on the
definition of another table, including any column attributes and
indexes the original table has:

</P>

<PRE>
CREATE TABLE <var>new_tbl</var> LIKE <var>orig_tbl</var>;
</PRE>

<P>
<code>CREATE TABLE ... LIKE</code> does not copy any <code>DATA DIRECTORY</code> or
<code>INDEX DIRECTORY</code> table options that were specified for the original
table.

</P>
<P>
You can precede the <code>SELECT</code> by <code>IGNORE</code> or <code>REPLACE</code>
to indicate how to handle records that duplicate unique key values.
With <code>IGNORE</code>, new records that duplicate an existing record on a
unique key value are discarded.  With <code>REPLACE</code>, new records replace
records that have the same unique key value.  If neither <code>IGNORE</code>
nor <code>REPLACE</code> is specified, duplicate unique key values result in
an error.

</P>
<P>
To ensure that the update log/binary log can be used to re-create the
original tables, MySQL will not allow concurrent inserts during
<code>CREATE TABLE ... SELECT</code>.

</P>



<H4><A NAME="Silent_column_changes" HREF="manual_toc.html#Silent_column_changes">14.2.5.1  Silent Column Specification Changes</A></H4>

<P>
<A NAME="IDX1650"></A>

</P>
<P>
In some cases, MySQL silently changes column specifications from
those given in a <code>CREATE TABLE</code> or <code>ALTER TABLE</code> statement:

</P>

<UL>
<LI>

<code>VARCHAR</code> columns with a length less than four are changed to
<code>CHAR</code>.

<LI>

If any column in a table has a variable length, the entire row becomes
variable-length as a result.  Therefore, if a table contains any
variable-length columns (<code>VARCHAR</code>, <code>TEXT</code>, or <code>BLOB</code>),
all <code>CHAR</code> columns longer than three characters are changed to
<code>VARCHAR</code> columns.  This doesn't affect how you use the columns in
any way; in MySQL, <code>VARCHAR</code> is just a different way to
store characters.  MySQL performs this conversion because it
saves space and makes table operations faster.  See section <A HREF="manual.html#Table_types">15  MySQL Storage Engines and Table Types</A>.

<LI>

From MySQL 4.1.0 on, a <code>CHAR</code> or <code>VARCHAR</code> column with a
length specification greater than 255 is converted to the smallest <code>TEXT</code>
type that can hold values of the given length.
For example, <code>VARCHAR(500)</code> is converted to <code>TEXT</code>, and
<code>VARCHAR(200000)</code> is converted to <code>MEDIUMTEXT</code>.
This is a compatibility feature.

<LI>

<code>TIMESTAMP</code> display sizes are discarded from MySQL 4.1 on, due
to changes made to the <code>TIMESTAMP</code> column type in that version.
Before MySQL 4.1, <code>TIMESTAMP</code> display sizes must be even and in the
range from 2 to 14.  If you specify a display size of 0 or greater than
14, the size is coerced to 14.  Odd-valued sizes in the range from 1 to
13 are coerced to the next higher even number.

<LI>

You cannot store a literal <code>NULL</code> in a <code>TIMESTAMP</code> column; setting
it to <code>NULL</code> sets it to the current date and time.  Because
<code>TIMESTAMP</code> columns behave this way, the <code>NULL</code> and <code>NOT NULL</code>
attributes do not apply in the normal way and are ignored if you specify
them.  <code>DESCRIBE <var>tbl_name</var></code> always reports that a <code>TIMESTAMP</code>
column can be assigned <code>NULL</code> values.

<LI>

Columns that are part of a <code>PRIMARY KEY</code> are made <code>NOT NULL</code> even if
not declared that way.

<LI>

Starting from MySQL 3.23.51, trailing spaces are automatically deleted from
<code>ENUM</code> and <code>SET</code> member values when the table is created.

<LI>

MySQL maps certain column types used by other SQL database vendors
to MySQL types.  See section <A HREF="manual.html#Other-vendor_column_types">12.7  Using Column Types from Other Database Engines</A>.

<LI>

If you include a <code>USING</code> clause to specify an index type that is not
legal for a storage engine, but there is another index type available that
the engine can use without affecting query results, the engine will use the
available type.

</UL>

<P>
To see whether MySQL used a column type other
than the one you specified, issue a <code>DESCRIBE</code> or <code>SHOW
CREATE TABLE</code> statement after creating or altering your table.

</P>
<P>
<A NAME="IDX1651"></A>
Certain other column type changes can occur if you compress a table
using <code>myisampack</code>. See section <A HREF="manual.html#Compressed_format">15.1.3.3  Compressed Table Characteristics</A>.

</P>



<H3><A NAME="DROP_DATABASE" HREF="manual_toc.html#DROP_DATABASE">14.2.6  <code>DROP DATABASE</code> Syntax</A></H3>

<P>
<A NAME="IDX1652"></A>
<A NAME="IDX1653"></A>
<A NAME="IDX1654"></A>

</P>

<PRE>
DROP DATABASE [IF EXISTS] <var>db_name</var>
</PRE>

<P>
<code>DROP DATABASE</code> drops all tables in the database and deletes the
database.  Be <em>very</em> careful with this statement!
To use <code>DROP DATABASE</code>, you need the <code>DROP</code> privilege on the
database.

</P>
<P>
In MySQL 3.22 or later, you can use the keywords <code>IF EXISTS</code>
to prevent an error from occurring if the database doesn't exist.

</P>
<P>
If you use <code>DROP DATABASE</code> on a symbolically linked
database, both the link and the original database are deleted.

</P>
<P>
As of MySQL 4.1.2, <code>DROP DATABASE</code> returns the number of tables that
were removed.  This corresponds to the number of <tt>`.frm'</tt> files removed.

</P>
<P>
The <code>DROP DATABASE</code> statement removes from the given database directory
those files and directories that MySQL itself may create during normal
operation:

</P>

<UL>

<LI>

All files with these extensions:

<TABLE BORDER>
<TR><TD><code>.BAK</code> </TD><TD> <code>.DAT</code> </TD><TD> <code>.HSH</code> </TD><TD> <code>.ISD</code>
</TD></TR>
<TR><TD><code>.ISM</code> </TD><TD> <code>.ISM</code> </TD><TD> <code>.MRG</code> </TD><TD> <code>.MYD</code>
</TD></TR>
<TR><TD><code>.MYI</code> </TD><TD> <code>.db</code> </TD><TD> <code>.frm</code> </TD><TD>
</TD></TR>
</TABLE>

<LI>

All subdirectories with names that consist of two hex digits
<code>00</code>-<code>ff</code>. These are subdirectories used for <code>RAID</code> tables.

<LI>

The <tt>`db.opt'</tt> file, if it exists.

</UL>

<P>
If other files or directories remain in the database directory after MySQL
removes those just listed, the database directory cannot be removed. In this
case, you must remove any remaining files or directories manually and issue
the <code>DROP DATABASE</code> statement again.

</P>
<P>
<A NAME="IDX1655"></A>
You can also drop databases with <code>mysqladmin</code>.
See section <A HREF="manual.html#mysqladmin">8.4  <code>mysqladmin</code>, Administering a MySQL Server</A>.

</P>



<H3><A NAME="DROP_INDEX" HREF="manual_toc.html#DROP_INDEX">14.2.7  <code>DROP INDEX</code> Syntax</A></H3>

<P>
<A NAME="IDX1656"></A>
<A NAME="IDX1657"></A>
<A NAME="IDX1658"></A>

</P>

<PRE>
DROP INDEX <var>index_name</var> ON <var>tbl_name</var>
</PRE>

<P>
<code>DROP INDEX</code> drops the index named <var>index_name</var> from the table
<var>tbl_name</var>.  In MySQL 3.22 or later, <code>DROP INDEX</code> is mapped to an
<code>ALTER TABLE</code> statement to drop the index.  See section <A HREF="manual.html#ALTER_TABLE">14.2.2  <code>ALTER TABLE</code> Syntax</A>.  <code>DROP INDEX</code> doesn't do anything prior to MySQL
3.22.

</P>



<H3><A NAME="DROP_TABLE" HREF="manual_toc.html#DROP_TABLE">14.2.8  <code>DROP TABLE</code> Syntax</A></H3>

<P>
<A NAME="IDX1659"></A>
<A NAME="IDX1660"></A>
<A NAME="IDX1661"></A>

</P>

<PRE>
DROP [TEMPORARY] TABLE [IF EXISTS]
    <var>tbl_name</var> [, <var>tbl_name</var>] ...
    [RESTRICT | CASCADE]
</PRE>

<P>
<code>DROP TABLE</code> removes one or more tables. You must have the <code>DROP</code>
privilege for each table. All table data and the table
definition are <em>removed</em>, so <em>be careful</em> with this statement!

</P>
<P>
In MySQL 3.22 or later, you can use the keywords <code>IF EXISTS</code>
to prevent an error from occurring for tables that don't exist.  As of
MySQL 4.1, a <code>NOTE</code> is generated for each non-existent table when
using <code>IF EXISTS</code>.
See section <A HREF="manual.html#SHOW_WARNINGS">14.5.3.20  <code>SHOW WARNINGS</code> Syntax</A>.

</P>
<P>
<code>RESTRICT</code> and <code>CASCADE</code> are allowed to make porting easier.
For the moment, they do nothing.

</P>
<P>
<strong>Note</strong>: <code>DROP TABLE</code> automatically commits the current
active transaction, unless you are using MySQL 4.1 or higher and the
<code>TEMPORARY</code> keyword.

</P>
<P>
The <code>TEMPORARY</code> keyword is ignored in MySQL 4.0.  As of 4.1, it has the
following effect:

</P>

<UL>
<LI>

The statement drops only <code>TEMPORARY</code> tables.
<LI>

The statement doesn't end a running transaction.
<LI>

No access rights are checked.  (A <code>TEMPORARY</code> table is visible only
only to the client that created it, so no check is necessary.)
</UL>

<P>
Using <code>TEMPORARY</code> is a good way to ensure that you don't accidentally
drop a non-<code>TEMPORARY</code> table.

</P>



<H3><A NAME="RENAME_TABLE" HREF="manual_toc.html#RENAME_TABLE">14.2.9  <code>RENAME TABLE</code> Syntax</A></H3>

<P>
<A NAME="IDX1662"></A>

</P>

<PRE>
RENAME TABLE <var>tbl_name</var> TO <var>new_tbl_name</var>
    [, <var>tbl_name2</var> TO <var>new_tbl_name2</var>] ...
</PRE>

<P>
This statement renames one or more tables.  It was added in MySQL 3.23.23.

</P>
<P>
The rename operation is done atomically, which means that no other thread
can access any of the tables while the rename is running. For example,
if you have an existing table <code>old_table</code>, you can create another
table <code>new_table</code> that has the same structure but is empty, and then
replace the existing table with the empty one as follows:

</P>

<PRE>
CREATE TABLE <var>new_table</var> (...);
RENAME TABLE <var>old_table</var> TO <var>backup_table</var>, <var>new_table</var> TO <var>old_table</var>;
</PRE>

<P>
If the statement renames more than one table, renaming operations are done
from left to right. If you want to swap two table names, you can do so
like this (assuming that no table named <code>tmp_table</code> currently exists):

</P>

<PRE>
RENAME TABLE <var>old_table</var> TO <var>tmp_table</var>,
             <var>new_table</var> TO <var>old_table</var>,
             <var>tmp_table</var> TO <var>new_table</var>;
</PRE>

<P>
As long as two databases are on the same filesystem you can also rename
a table to move it from one database to another:

</P>

<PRE>
RENAME TABLE <var>current_db.tbl_name</var> TO <var>other_db.tbl_name;</var>
</PRE>

<P>
When you execute <code>RENAME</code>, you can't have any locked tables or
active transactions.  You must also have the <code>ALTER</code> and <code>DROP</code>
privileges on the original table, and the <code>CREATE</code> and <code>INSERT</code>
privileges on the new table.

</P>
<P>
If MySQL encounters any errors in a multiple-table rename, it
will do a reverse rename for all renamed tables to get everything back
to the original state.

</P>


<H2><A NAME="Basic_User_Commands" HREF="manual_toc.html#Basic_User_Commands">14.3  MySQL Utility Statements</A></H2>



<H3><A NAME="DESCRIBE" HREF="manual_toc.html#DESCRIBE">14.3.1  <code>DESCRIBE</code> Syntax (Get Information About Columns)</A></H3>

<P>
<A NAME="IDX1663"></A>
<A NAME="IDX1664"></A>

</P>

<PRE>
{DESCRIBE | DESC} <var>tbl_name</var> [<var>col_name</var> | <var>wild</var>]
</PRE>

<P>
<code>DESCRIBE</code> provides information about a table's columns.  It is a
shortcut for <code>SHOW COLUMNS FROM</code>.
See section <A HREF="manual.html#SHOW_COLUMNS">14.5.3.4  <code>SHOW COLUMNS</code> Syntax</A>.

</P>
<P>
<var>col_name</var> can be a column name, or a string containing the SQL
<samp>`%'</samp> and <samp>`_'</samp> wildcard characters to obtain output only for the
columns with names matching the string. There is no need to enclose the
string in quotes unless it contains spaces or other special characters.

</P>

<PRE>
mysql&#62; DESCRIBE city;
+------------+----------+------+-----+---------+----------------+
| Field      | Type     | Null | Key | Default | Extra          |
+------------+----------+------+-----+---------+----------------+
| Id         | int(11)  |      | PRI | NULL    | auto_increment |
| Name       | char(35) |      |     |         |                |
| Country    | char(3)  |      | UNI |         |                |
| District   | char(20) | YES  | MUL |         |                |
| Population | int(11)  |      |     | 0       |                |
+------------+----------+------+-----+---------+----------------+
5 rows in set (0.00 sec)
</PRE>

<P>
The <code>Null</code> column indicates whether NULL values can be stored, 
with YES displayed when NULL values are allowed. 

</P>
<P>
The <code>Key</code> column indicates whether the field is indexed. A value of <code>PRI</code>
indicates that the field is part of the table's primary key. <code>UNI</code> indicates that
the field is part of a a <code>UNIQUE</code> index. The <code>MUL</code> value 
indicates that multiple occurences of a given value allowed within the field. 

</P>
<P>
A field can be designated as <code>MUL</code> even if a <code>UNIQUE</code> index is used if 
<code>NULL</code> values are allowed, as multiple rows in a <code>UNIQUE</code> index can hold 
a <code>NULL</code> value if the column is not declared <code>NOT NULL</code>. Another cause 
for <code>MUL</code> on a <code>UNIQUE</code> index is when two columns form a composite 
<code>UNIQUE</code> index; while the combination of the columns will be unique, each 
column can still hold multiple occurences of a given value. Note that in a composite index only the leftmost field of the index will have an entry in the <code>Key</code> column.

</P>
<P>
The <code>Default</code> column indicates the default value that is assigned to the field.

</P>
<P>
The <code>Extra</code> column contains any additional information that is available about
a given field. In our example the <code>Extra</code> column indicates that our Id field
was created with the <code>AUTO_INCREMENT</code> keyword. 

</P>
<P>
If the column types are different from what you expect them to be based on a
<code>CREATE TABLE</code> statement, note that MySQL sometimes
changes column types.  See section <A HREF="manual.html#Silent_column_changes">14.2.5.1  Silent Column Specification Changes</A>.

</P>
<P>
<A NAME="IDX1665"></A>
<A NAME="IDX1666"></A>
The <code>DESCRIBE</code> statement is provided for Oracle compatibility.

</P>
<P>
The <code>SHOW CREATE TABLE</code> and <code>SHOW TABLE STATUS</code> statements also
provide information about tables.
See section <A HREF="manual.html#SHOW">14.5.3  <code>SET</code> and <code>SHOW</code> Syntax</A>.

</P>



<H3><A NAME="USE" HREF="manual_toc.html#USE">14.3.2  <code>USE</code> Syntax</A></H3>

<P>
<A NAME="IDX1667"></A>

</P>

<PRE>
USE <var>db_name</var>
</PRE>

<P>
The <code>USE <var>db_name</var></code> statement tells MySQL to use the <var>db_name</var>
database as the default (current) database for subsequent statements.
The database remains the default until the end of the session or until
another <code>USE</code> statement is issued:

</P>

<PRE>
mysql&#62; USE db1;
mysql&#62; SELECT COUNT(*) FROM mytable;   # selects from db1.mytable
mysql&#62; USE db2;
mysql&#62; SELECT COUNT(*) FROM mytable;   # selects from db2.mytable
</PRE>

<P>
Making a particular database current by means of the <code>USE</code> statement
does not preclude you from accessing tables in other databases.  The following example
accesses the <code>author</code> table from the <code>db1</code> database and the
<code>editor</code> table from the <code>db2</code> database:

</P>

<PRE>
mysql&#62; USE db1;
mysql&#62; SELECT author_name,editor_name FROM author,db2.editor
    -&#62;        WHERE author.editor_id = db2.editor.editor_id;
</PRE>

<P>
<A NAME="IDX1668"></A>
<A NAME="IDX1669"></A>
The <code>USE</code> statement is provided for Sybase compatibility.

</P>



<H2><A NAME="Transactional_Commands" HREF="manual_toc.html#Transactional_Commands">14.4  MySQL Transactional and Locking Statements</A></H2>



<H3><A NAME="COMMIT" HREF="manual_toc.html#COMMIT">14.4.1  <code>START TRANSACTION</code>, <code>COMMIT</code>, and <code>ROLLBACK</code> Syntax</A></H3>

<P>
<A NAME="IDX1670"></A>
<A NAME="IDX1671"></A>
<A NAME="IDX1672"></A>
<A NAME="IDX1673"></A>

</P>
<P>
By default, MySQL runs with autocommit mode enabled. This means that
as soon as you execute a statement that updates (modifies) a table,
MySQL stores the update on disk.

</P>
<P>
If you are using transaction-safe tables (like <code>InnoDB</code> or <code>BDB</code>),
you can disable autocommit mode with the following statement:

</P>

<PRE>
SET AUTOCOMMIT=0;
</PRE>

<P>
After disabling autocommit mode by setting the <code>AUTOCOMMIT</code> variable to
zero, you must use <code>COMMIT</code> to store your changes to disk or
<code>ROLLBACK</code> if you want to ignore the changes you have made since
the beginning of your transaction.

</P>
<P>
If you want to disable autocommit mode for a single series of
statements, you can use the <code>START TRANSACTION</code> statement:

</P>

<PRE>
START TRANSACTION;
SELECT @A:=SUM(salary) FROM table1 WHERE type=1;
UPDATE table2 SET summary=@A WHERE type=1;
COMMIT;
</PRE>

<P>
With <code>START TRANSACTION</code>, autocommit remains disabled until you end the
transaction with <code>COMMIT</code> or <code>ROLLBACK</code>. The autocommit mode then
reverts to its previous state.

</P>
<P>
<code>BEGIN</code> and <code>BEGIN WORK</code> can be used instead of <code>START
TRANSACTION</code> to initiate a transaction.  <code>START TRANSACTION</code> was
added in MySQL 4.0.11.  This is standard SQL syntax and is the recommended way
to start an ad-hoc transaction.  <code>BEGIN</code> and <code>BEGIN WORK</code> are
available from MySQL 3.23.17 and 3.23.19, respectively.

</P>
<P>
Note that if you are not using transaction-safe tables, any changes are
stored at once, regardless of the status of autocommit mode.

</P>
<P>
If you issue a <code>ROLLBACK</code> statement after updating a non-transactional
table within a transaction, an <code>ER_WARNING_NOT_COMPLETE_ROLLBACK</code>
warning occurs.  Changes to transaction-safe tables will be rolled back, but
not changes to non-transaction-safe tables.

</P>
<P>
If you are using <code>START TRANSACTION</code> or <code>SET AUTOCOMMIT=0</code>, you
should use the MySQL binary log for backups instead of the
older update log.  Transactions are stored in the binary log
in one chunk, upon <code>COMMIT</code>. Transactions that are
rolled back are not logged.
(Exception: Modifications to non-transactional tables cannot be rolled
back.  If a transaction that is rolled back includes modifications
to non-transactional tables, the entire transaction is logged with a
<code>ROLLBACK</code> statement at the end to ensure that the modifications to
those tables are replicated. This is true as of MySQL 4.0.15.)
See section <A HREF="manual.html#Binary_log">5.8.4  The Binary Log</A>.

</P>
<P>
You can change the isolation level for transactions with
<code>SET TRANSACTION ISOLATION LEVEL</code>.
See section <A HREF="manual.html#SET_TRANSACTION">14.4.6  <code>SET TRANSACTION</code> Syntax</A>.

</P>



<H3><A NAME="Cannot_roll_back" HREF="manual_toc.html#Cannot_roll_back">14.4.2  Statements That Cannot Be Rolled Back</A></H3>

<P>
Some statements cannot be rolled back.  In general, these include data
definition language (DDL) statements, such as those that create or drop
databases, or those that create, drop, or alter tables.

</P>
<P>
You should design your transactions not to include such statements.
If you issue a statement early in a transaction that cannot be rolled back,
and then another statement later fails, the full effect of the transaction
cannot be rolled back by issuing a <code>ROLLBACK</code> statement.

</P>



<H3><A NAME="Implicit_commit" HREF="manual_toc.html#Implicit_commit">14.4.3  Statements That Cause an Implicit Commit</A></H3>

<P>
The following statements implicitly end a transaction (as if you had done
a <code>COMMIT</code> before executing the statement):

</P>
<TABLE BORDER>
<TR><TD><code>ALTER TABLE</code> </TD><TD> <code>BEGIN</code> </TD><TD> <code>CREATE INDEX</code>
</TD></TR>
<TR><TD><code>DROP DATABASE</code> </TD><TD> <code>DROP INDEX</code> </TD><TD> <code>DROP TABLE</code>
</TD></TR>
<TR><TD><code>LOAD MASTER DATA</code> </TD><TD> <code>LOCK TABLES</code> </TD><TD> <code>RENAME TABLE</code>
</TD></TR>
<TR><TD><code>SET AUTOCOMMIT=1</code> </TD><TD> <code>START TRANSACTION</code> </TD><TD> <code>TRUNCATE TABLE</code>
</TD></TR>
</TABLE>

<P>
<code>UNLOCK TABLES</code> also ends a transaction if any tables currently are
locked.  Prior to MySQL 4.0.13, <code>CREATE TABLE</code> ends a transaction if
the binary update log is enabled.

</P>
<P>
Transactions cannot be nested. This is a consequence of the implicit
<code>COMMIT</code> performed for any current transaction when you issue a
<code>START TRANSACTION</code> statement or one of its synonyms.

</P>



<H3><A NAME="Savepoints" HREF="manual_toc.html#Savepoints">14.4.4  <code>SAVEPOINT</code> and <code>ROLLBACK TO SAVEPOINT</code> Syntax</A></H3>

<P>
<A NAME="IDX1674"></A>
<A NAME="IDX1675"></A>

</P>

<PRE>
SAVEPOINT identifier
ROLLBACK TO SAVEPOINT identifier
</PRE>

<P>
Starting from MySQL 4.0.14 and 4.1.1, <code>InnoDB</code> supports the SQL statements
<code>SAVEPOINT</code> and <code>ROLLBACK TO SAVEPOINT</code>.

</P>
<P>
The <code>SAVEPOINT</code> statement sets a named transaction savepoint with a name
of <code>identifier</code>.  If the current transaction already has a savepoint
with the same name, the old savepoint is deleted and a new one is set.

</P>
<P>
The <code>ROLLBACK TO SAVEPOINT</code> statement rolls back a transaction to the
named savepoint.  Modifications that the current transaction made to rows
after the savepoint was set are undone in the rollback, but <code>InnoDB</code>
does <em>not</em> release the row locks that were stored in memory after
the savepoint.  (Note that for a new inserted row, the lock information is
carried by the transaction ID stored in the row; the lock is not separately
stored in memory. In this case, the row lock is released in the undo.)
Savepoints that were set at a later time than the named savepoint are
deleted.

</P>
<P>
If the statement returns the following error, it means that
no savepoint with the specified name exists:

</P>

<PRE>
ERROR 1181: Got error 153 during ROLLBACK
</PRE>

<P>
All savepoints of the current transaction are deleted if you execute a
<code>COMMIT</code>, or a <code>ROLLBACK</code> that does not name a savepoint.

</P>



<H3><A NAME="LOCK_TABLES" HREF="manual_toc.html#LOCK_TABLES">14.4.5  <code>LOCK TABLES</code> and <code>UNLOCK TABLES</code> Syntax</A></H3>

<P>
<A NAME="IDX1676"></A>
<A NAME="IDX1677"></A>

</P>

<PRE>
LOCK TABLES
    <var>tbl_name</var> [AS <var>alias</var>] {READ [LOCAL] | [LOW_PRIORITY] WRITE}
    [, <var>tbl_name</var> [AS <var>alias</var>] {READ [LOCAL] | [LOW_PRIORITY] WRITE}] ...
UNLOCK TABLES
</PRE>

<P>
<code>LOCK TABLES</code> locks tables for the current thread.  <code>UNLOCK
TABLES</code> releases any locks held by the current thread.  All tables that
are locked by the current thread are implicitly unlocked when the
thread issues another <code>LOCK TABLES</code>, or when the connection to the
server is closed.

</P>
<P>
<strong>Note</strong>: <code>LOCK TABLES</code> is not transaction-safe and implicitly
commits any active transactions before attempting to lock the tables.

</P>
<P>
As of MySQL 4.0.2, to use <code>LOCK TABLES</code> you must have the
<code>LOCK TABLES</code> privilege and a <code>SELECT</code> privilege for the
involved tables. In MySQL 3.23, you must have <code>SELECT</code>,
<code>INSERT</code>, <code>DELETE</code>, and <code>UPDATE</code> privileges for the
tables.

</P>
<P>
The main reasons to use <code>LOCK TABLES</code> are for emulating transactions
or to get more speed when updating tables.  This is explained in more
detail later.

</P>
<P>
If a thread obtains a <code>READ</code> lock on a table, that thread (and all other
threads) can only read from the table. If a thread obtains a <code>WRITE</code>
lock on a table, only the thread holding the lock can read from
or write to the table.  Other threads are blocked.

</P>
<P>
The difference between <code>READ LOCAL</code> and <code>READ</code> is that <code>READ
LOCAL</code> allows non-conflicting <code>INSERT</code> statements (concurrent inserts)
to execute while the lock is held.  However, this can't be used if you are
going to manipulate the database files outside MySQL while you hold the
lock.

</P>
<P>
When you use <code>LOCK TABLES</code>, you must lock all tables that you are going to
use in your queries.  While the locks obtained with a <code>LOCK TABLES</code>
statement are in effect, you cannot access any tables that were not locked by
the statement.  Also, you cannot use a locked table multiple times in one query
- use aliases for that.  Note that in that case you must get a lock for each
alias separately.

</P>

<PRE>
mysql&#62; LOCK TABLE t WRITE, t AS t1 WRITE;
mysql&#62; INSERT INTO t SELECT * FROM t;
ERROR 1100: Table 't' was not locked with LOCK TABLES
mysql&#62; INSERT INTO t SELECT * FROM t AS t1;
</PRE>

<P>
If your queries refer to a table using an alias, then you must lock the
table using that same alias.  It will not work to lock the table without
specifying the alias:

</P>

<PRE>
mysql&#62; LOCK TABLE t READ;
mysql&#62; SELECT * FROM t AS myalias;
ERROR 1100: Table 'myalias' was not locked with LOCK TABLES
</PRE>

<P>
Conversely, if you lock a table using an alias, you must refer to it in
your queries using that alias:

</P>

<PRE>
mysql&#62; LOCK TABLE t AS myalias READ;
mysql&#62; SELECT * FROM t;
ERROR 1100: Table 't' was not locked with LOCK TABLES
mysql&#62; SELECT * FROM t AS myalias;
</PRE>

<P>
<code>WRITE</code> locks normally have higher priority than <code>READ</code> locks to
ensure that updates are processed as soon as possible. This means that if one
thread obtains a <code>READ</code> lock and then another thread requests a
<code>WRITE</code> lock, subsequent <code>READ</code> lock requests will wait until the
<code>WRITE</code> thread has gotten the lock and released it.  You can use
<code>LOW_PRIORITY WRITE</code> locks to allow other threads to obtain <code>READ</code>
locks while the thread is waiting for the <code>WRITE</code> lock. You should
use <code>LOW_PRIORITY WRITE</code> locks only if you are sure that there will
eventually be a time when no threads will have a <code>READ</code> lock.

</P>
<P>
<code>LOCK TABLES</code> works as follows:

</P>

<OL>
<LI>

Sort all tables to be locked in an internally defined order. From the
user standpoint, this order is undefined.
<LI>

If a table is locked with a read and a write lock, put the write lock
before the read lock.
<LI>

Lock one table at a time until the thread gets all locks.
</OL>

<P>
This policy ensures that table locking is deadlock free. There are,
however, other things you need to be aware of about this policy:

</P>
<P>
If you are using a <code>LOW_PRIORITY WRITE</code> lock for a table, it
means only that MySQL will wait for this particular lock until
there are no threads that want a <code>READ</code> lock.  When the thread has
gotten the <code>WRITE</code> lock and is waiting to get the lock for the next
table in the lock table list, all other threads will wait for the
<code>WRITE</code> lock to be released.  If this becomes a serious problem
with your application, you should consider converting some of your
tables to transaction-safe tables.

</P>
<P>
You can safely use <code>KILL</code> to terminate a thread that is waiting for a
table lock.
See section <A HREF="manual.html#KILL">14.5.4.3  <code>KILL</code> Syntax</A>.

</P>
<P>
Note that you should <em>not</em> lock any tables that you are using with
<code>INSERT DELAYED</code> because in that case the <code>INSERT</code> is done by a
separate thread.

</P>
<P>
Normally, you don't have to lock tables, because all single <code>UPDATE</code> statements
are atomic; no other thread can interfere with any other currently executing
SQL statement. There are a few cases when you would like to lock tables
anyway:

</P>

<UL>
<LI>

If you are going to run many operations on a set of <code>MyISAM</code> tables,
it's much faster to lock the tables you are going to use.  Locking
<code>MyISAM</code> tables speeds up inserting, updating, or deleting on them.
The downside is that no thread can update a <code>READ</code>-locked table
(including the one holding the lock) and no thread can access a
<code>WRITE</code>-locked table other than the one holding the lock.

The reason some <code>MyISAM</code> operations are faster under <code>LOCK TABLES</code>
is that MySQL will not flush the key cache for the locked tables until
<code>UNLOCK TABLES</code> is called. Normally, the key cache is flushed after
each SQL statement.

<LI>

If you are using a storage engine in MySQL that doesn't support
transactions, you must use <code>LOCK TABLES</code> if you want to ensure that
no other thread comes between a <code>SELECT</code> and an <code>UPDATE</code>. The
example shown here requires <code>LOCK TABLES</code> to execute safely:


<PRE>
mysql&#62; LOCK TABLES trans READ, customer WRITE;
mysql&#62; SELECT SUM(value) FROM trans WHERE customer_id=<var>some_id</var>;
mysql&#62; UPDATE customer
    -&#62;     SET total_value=<var>sum_from_previous_statement</var>
    -&#62;     WHERE customer_id=<var>some_id</var>;
mysql&#62; UNLOCK TABLES;
</PRE>

Without <code>LOCK TABLES</code>, it is possible that another thread might
insert a new row in the <code>trans</code> table between execution of the
<code>SELECT</code> and <code>UPDATE</code> statements.
</UL>

<P>
You can avoid using <code>LOCK TABLES</code> in many cases
by using relative updates (<code>UPDATE customer SET
<var>value</var>=<var>value</var>+<var>new_value</var></code>) or the <code>LAST_INSERT_ID()</code> function,
See section <A HREF="manual.html#ANSI_diff_Transactions">1.8.5.3  Transactions and Atomic Operations</A>.

</P>
<P>
You can also avoid locking tables in some cases by using the user-level
advisory lock functions <code>GET_LOCK()</code> and <code>RELEASE_LOCK()</code>.
These locks are saved in a hash table in the server and implemented with
<code>pthread_mutex_lock()</code> and <code>pthread_mutex_unlock()</code> for high speed.
See section <A HREF="manual.html#Miscellaneous_functions">13.8.4  Miscellaneous Functions</A>.

</P>
<P>
See section <A HREF="manual.html#Internal_locking">7.3.1  Locking Methods</A>, for more information on locking policy.

</P>
<P>
You can lock all tables in all databases with read locks with the <code>FLUSH
TABLES WITH READ LOCK</code> statement. See section <A HREF="manual.html#FLUSH">14.5.4.2  <code>FLUSH</code> Syntax</A>. This
is a very convenient way to get backups if you have a filesystem such as
Veritas that can take snapshots in time.

</P>
<P>
<strong>Note</strong>: If you use <code>ALTER TABLE</code> on a locked table, it may become
unlocked. See section <A HREF="manual.html#ALTER_TABLE_problems">A.7.1  Problems with <code>ALTER TABLE</code></A>.

</P>



<H3><A NAME="SET_TRANSACTION" HREF="manual_toc.html#SET_TRANSACTION">14.4.6  <code>SET TRANSACTION</code> Syntax</A></H3>

<P>
<A NAME="IDX1678"></A>
<A NAME="IDX1679"></A>

</P>

<PRE>
SET [GLOBAL | SESSION] TRANSACTION ISOLATION LEVEL
{ READ UNCOMMITTED | READ COMMITTED | REPEATABLE READ | SERIALIZABLE }
</PRE>

<P>
This statement
sets the transaction isolation level for the next transaction, globally, or
for the current session.

</P>
<P>
The default behavior of <code>SET TRANSACTION</code> is to set the isolation level
for the next (not yet
started) transaction.  If you use the <code>GLOBAL</code> keyword, the statement
sets the default transaction level globally for all new connections
created from that point on. Existing connections are unaffected.
You need the <code>SUPER</code>
privilege to do this.  Using the <code>SESSION</code> keyword sets the
default transaction level for all future transactions performed on the
current connection.

</P>
<P>
For descriptions of each <code>InnoDB</code> transaction isolation level, see
section <A HREF="manual.html#InnoDB_transaction_isolation">16.11.2  <code>InnoDB</code> and <code>TRANSACTION ISOLATION LEVEL</code></A>.
<code>InnoDB</code> supports each of these levels
from MySQL 4.0.5 on. The default level is <code>REPEATABLE READ</code>.

</P>
<P>
You can set the initial default global isolation level for <code>mysqld</code> with
the <code>--transaction-isolation</code> option.
See section <A HREF="manual.html#Server_options">5.2.1  <code>mysqld</code> Command-Line Options</A>.

</P>



<H2><A NAME="Database_Administration" HREF="manual_toc.html#Database_Administration">14.5  Database Administration Statements</A></H2>



<H3><A NAME="Account_management_SQL" HREF="manual_toc.html#Account_management_SQL">14.5.1  Account Management Statements</A></H3>



<H4><A NAME="Drop_user" HREF="manual_toc.html#Drop_user">14.5.1.1  <code>DROP USER</code> Syntax</A></H4>

<P>
<A NAME="IDX1680"></A>

</P>
<P>
<A NAME="IDX1681"></A>
<A NAME="IDX1682"></A>
<A NAME="IDX1683"></A>
<A NAME="IDX1684"></A>
<A NAME="IDX1685"></A>
<A NAME="IDX1686"></A>
<A NAME="IDX1687"></A>
<A NAME="IDX1688"></A>

</P>

<PRE>
DROP USER user
</PRE>

<P>
The <code>DROP USER</code> statement deletes a MySQL account that
doesn't have any privileges.  It serves to remove the account record from
the <code>user</code> table. The account is named using the same format as for
<code>GRANT</code> or <code>REVOKE</code>; for example, <code>'jeffrey'@'localhost'</code>.
The user and host parts of the account name correspond to the <code>User</code> and
<code>Host</code> column values of the <code>user</code> table record for the account.

</P>
<P>
To remove a MySQL user account, you should use the following procedure,
performing the steps in the order shown:

</P>

<OL>
<LI>

Use <code>SHOW GRANTS</code> to determine what privileges the account has.
See section <A HREF="manual.html#SHOW_GRANTS">14.5.3.10  <code>SHOW GRANTS</code> Syntax</A>.
<LI>

Use <code>REVOKE</code> to revoke the privileges displayed by <code>SHOW GRANTS</code>.
This removes records for the account from all the grant tables except the
<code>user</code> table, and revokes any global privileges listed in the <code>user</code>
table.
See section <A HREF="manual.html#GRANT">14.5.1.2  <code>GRANT</code> and <code>REVOKE</code> Syntax</A>.
<LI>

Delete the account by using <code>DROP USER</code> to remove the <code>user</code> table
record.
</OL>

<P>
The <code>DROP USER</code> statement was added in MySQL 4.1.1.  Before 4.1.1,
you should first revoke the account privileges as just described. Then
delete the <code>user</code> table record and flush the grant tables like this:

</P>

<PRE>
mysql&#62; DELETE FROM mysql.user
    -&#62; WHERE User='<var>user_name</var>' and Host='<var>host_name</var>';
mysql&#62; FLUSH PRIVILEGES;
</PRE>



<H4><A NAME="GRANT" HREF="manual_toc.html#GRANT">14.5.1.2  <code>GRANT</code> and <code>REVOKE</code> Syntax</A></H4>

<P>
<A NAME="IDX1689"></A>
<A NAME="IDX1690"></A>

</P>
<P>
<A NAME="IDX1691"></A>
<A NAME="IDX1692"></A>
<A NAME="IDX1693"></A>
<A NAME="IDX1694"></A>
<A NAME="IDX1695"></A>

</P>

<PRE>
GRANT <var>priv_type</var> [(<var>column_list</var>)] [, <var>priv_type</var> [(<var>column_list</var>)]] ...
    ON {<var>tbl_name</var> | * | *.* | <var>db_name</var>.*}
    TO <var>user</var> [IDENTIFIED BY [PASSWORD] '<var>password</var>']
        [, <var>user</var> [IDENTIFIED BY [PASSWORD] '<var>password</var>']] ...
    [REQUIRE
        NONE |
        [{SSL| X509}]
        [CIPHER '<var>cipher</var>' [AND]]
        [ISSUER '<var>issuer</var>' [AND]]
        [SUBJECT '<var>subject</var>']]
    [WITH [GRANT OPTION | MAX_QUERIES_PER_HOUR <var>count</var> |
                          MAX_UPDATES_PER_HOUR <var>count</var> |
                          MAX_CONNECTIONS_PER_HOUR <var>count</var>]]
</PRE>


<PRE>
REVOKE <var>priv_type</var> [(<var>column_list</var>)] [, <var>priv_type</var> [(<var>column_list</var>)]] ...
    ON {<var>tbl_name</var> | * | *.* | <var>db_name</var>.*}
    FROM <var>user</var> [, <var>user</var>] ...

REVOKE ALL PRIVILEGES, GRANT OPTION FROM <var>user</var> [, <var>user</var>] ...
</PRE>

<P>
The <code>GRANT</code> and <code>REVOKE</code> statements allow system administrators to
create MySQL user accounts and to grant rights to and revoke them from
accounts.  <code>GRANT</code> and <code>REVOKE</code> are implemented in MySQL 3.22.11
or later. For earlier MySQL versions, these statements do nothing.

</P>
<P>
MySQL account information is stored in the tables of the <code>mysql</code>
database. This database and the access control system are discussed
extensively in section <A HREF="manual.html#MySQL_Database_Administration">5  Database Administration</A>, which you should consult
for additional details.

</P>
<P>
Privileges can be granted at four levels:

</P>
<DL COMPACT>

<DT><strong>Global level</strong>
<DD>
Global privileges apply to all databases on a given server. These privileges
are stored in the <code>mysql.user</code> table.
<code>GRANT ALL ON *.*</code> and
<code>REVOKE ALL ON *.*</code> grant and revoke only global privileges.

<DT><strong>Database level</strong>
<DD>
Database privileges apply to all tables in a given database. These privileges
are stored in the <code>mysql.db</code> and <code>mysql.host</code> tables.
<code>GRANT ALL ON <var>db_name</var>.*</code> and
<code>REVOKE ALL ON <var>db_name</var>.*</code> grant and revoke only database privileges.

<DT><strong>Table level</strong>
<DD>
Table privileges apply to all columns in a given table. These privileges are
stored in the <code>mysql.tables_priv</code> table.
<code>GRANT ALL ON <var>db_name.tbl_name</var></code> and
<code>REVOKE ALL ON <var>db_name.tbl_name</var></code> grant and revoke only table privileges.

<DT><strong>Column level</strong>
<DD>
Column privileges apply to single columns in a given table. These privileges are
stored in the <code>mysql.columns_priv</code> table.
When using <code>REVOKE</code>, you must specify the same columns that were granted.
</DL>

<P>
To make it easy to revoke all privileges, MySQL 4.1.2 has added the
following syntax, which drops all database-, table-, and column-level
privileges for the named users:

</P>

<PRE>
REVOKE ALL PRIVILEGES, GRANT OPTION FROM <var>user</var> [, <var>user</var>] ...
</PRE>

<P>
Before MySQL 4.1.2, all privileges cannot be dropped at once.
Two statements are necessary:

</P>

<PRE>
REVOKE ALL PRIVILEGES ON *.* FROM <var>user</var> [, <var>user</var>] ...
REVOKE GRANT OPTION ON *.* FROM <var>user</var> [, <var>user</var>] ...
</PRE>

<P>
For the <code>GRANT</code> and <code>REVOKE</code> statements, <code>priv_type</code> can be
specified as any of the following:

</P>
<TABLE BORDER>
<TR><TD><strong>Privilege</strong> </TD><TD> <strong>Meaning</strong>
</TD></TR>
<TR><TD><code>ALL [PRIVILEGES]</code> </TD><TD> Sets all simple privileges except <code>GRANT OPTION</code>
</TD></TR>
<TR><TD><code>ALTER</code> </TD><TD> Allows use of <code>ALTER TABLE</code>
</TD></TR>
<TR><TD><code>CREATE</code> </TD><TD> Allows use of <code>CREATE TABLE</code>
</TD></TR>
<TR><TD><code>CREATE TEMPORARY TABLES</code> </TD><TD> Allows use of <code>CREATE TEMPORARY TABLE</code>
</TD></TR>
<TR><TD><code>DELETE</code> </TD><TD> Allows use of <code>DELETE</code>
</TD></TR>
<TR><TD><code>DROP</code> </TD><TD> Allows use of <code>DROP TABLE</code>
</TD></TR>
<TR><TD><code>EXECUTE</code> </TD><TD> Allows the user to run stored procedures (MySQL 5.0)
</TD></TR>
<TR><TD><code>FILE</code> </TD><TD> Allows use of <code>SELECT ... INTO OUTFILE</code> and <code>LOAD DATA INFILE</code>
</TD></TR>
<TR><TD><code>INDEX</code> </TD><TD> Allows use of <code>CREATE INDEX</code> and <code>DROP INDEX</code>
</TD></TR>
<TR><TD><code>INSERT</code> </TD><TD> Allows use of <code>INSERT</code>
</TD></TR>
<TR><TD><code>LOCK TABLES</code> </TD><TD> Allows use of <code>LOCK TABLES</code> on tables for which you have the <code>SELECT</code> privilege
</TD></TR>
<TR><TD><code>PROCESS</code> </TD><TD> Allows use of <code>SHOW FULL PROCESSLIST</code>
</TD></TR>
<TR><TD><code>REFERENCES</code> </TD><TD> Not yet implemented
</TD></TR>
<TR><TD><code>RELOAD</code> </TD><TD> Allows use of <code>FLUSH</code>
</TD></TR>
<TR><TD><code>REPLICATION CLIENT</code> </TD><TD> Allows the user to ask where the slave or master servers are
</TD></TR>
<TR><TD><code>REPLICATION SLAVE</code> </TD><TD> Needed for replication slaves (to read binary log events from the master)
</TD></TR>
<TR><TD><code>SELECT</code> </TD><TD> Allows use of <code>SELECT</code>
</TD></TR>
<TR><TD><code>SHOW DATABASES</code> </TD><TD> <code>SHOW DATABASES</code> shows all databases
</TD></TR>
<TR><TD><code>SHUTDOWN</code> </TD><TD> Allows use of <code>mysqladmin shutdown</code>
</TD></TR>
<TR><TD><code>SUPER</code> </TD><TD> Allows use of <code>CHANGE MASTER</code>, <code>KILL</code>,
<code>PURGE MASTER LOGS</code>, and <code>SET GLOBAL</code> statements, the <code>mysqladmin debug</code> command; allows you to connect (once) even if <code>max_connections</code> is reached
</TD></TR>
<TR><TD><code>UPDATE</code> </TD><TD> Allows use of <code>UPDATE</code>
</TD></TR>
<TR><TD><code>USAGE</code> </TD><TD> Synonym for ``no privileges''
</TD></TR>
<TR><TD><code>GRANT OPTION</code> </TD><TD> Allows privileges to be granted
</TD></TR>
</TABLE>

<P>
<code>USAGE</code> can be used when you want to create a user that has no privileges.

</P>
<P>
The privileges <code>CREATE TEMPORARY TABLES</code>, <code>EXECUTE</code>,
<code>LOCK TABLES</code>, <code>REPLICATION ...</code>, <code>SHOW DATABASES</code> and
<code>SUPER</code> are new for in MySQL 4.0.2.  To use these new privileges
after upgrading to 4.0.2, you must run the
<code>mysql_fix_privilege_tables</code> script.
See section <A HREF="manual.html#Upgrading-grant-tables">2.5.8  Upgrading the Grant Tables</A>.

</P>
<P>
In older MySQL versions that do not have the <code>SUPER</code> privilege, the
<code>PROCESS</code> privilege can be used instead.

</P>
<P>
You can assign global privileges by using <code>ON *.*</code> syntax or
database privileges by using <code>ON <var>db_name</var>.*</code> syntax. If you specify
<code>ON *</code> and you have a current database, the privileges will be granted in
that database.  (<strong>Warning:</strong> If you specify <code>ON *</code> and you
<em>don't</em> have a current database, the privileges granted will be global!)

</P>
<P>
The <code>EXECUTION</code>, <code>FILE</code>, <code>PROCESS</code>, <code>RELOAD</code>,
<code>REPLICATION CLIENT</code>, <code>REPLICATION SLAVE</code>, <code>SHOW DATABASES</code>,
<code>SHUTDOWN</code>, and <code>SUPER</code> privileges are administrative privileges
that can only be granted globally (using <code>ON *.*</code> syntax).

</P>
<P>
Other privileges can be granted globally or at more specific levels.

</P>
<P>
The only <code>priv_type</code> values you can specify for a table are <code>SELECT</code>,
<code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>CREATE</code>, <code>DROP</code>,
<code>GRANT OPTION</code>, <code>INDEX</code>, and <code>ALTER</code>.

</P>
<P>
The only <code>priv_type</code> values you can specify for a column (that is, when
you use a <code>column_list</code> clause) are <code>SELECT</code>, <code>INSERT</code>, and
<code>UPDATE</code>.

</P>
<P>
<code>GRANT ALL</code> assigns only the privileges that exist at the level you are
granting. For example, if you use <code>GRANT ALL ON <var>db_name</var>.*</code>, that is a
database-level statement, so none of the global-only privileges such as
<code>FILE</code> will be granted.

</P>
<P>
MySQL allows you to create database-level privileges even if the database
doesn't exist, to make it easy to prepare for database use.  However, MySQL
currently does not allow you to create table-level privileges if the table
doesn't exist.

</P>
<P>
MySQL does not automatically revoke any privileges even if you drop a table
or drop a database.

</P>
<P>
<strong>Note</strong>: the <samp>`_'</samp> and <samp>`%'</samp> wildcards are allowed when
specifying database names in <code>GRANT</code> statements that grant privileges at
the global or database levels. This means, for example, that if you
want to use a <samp>`_'</samp> character as part of a database name,
you should specify it as <samp>`\_'</samp> in the <code>GRANT</code> statement, to prevent
the user from being able to access additional databases matching the
wildcard pattern; for example, <code>GRANT ... ON `foo\_bar`.* TO ...</code>.

</P>
<P>
In order to accommodate granting rights to users from arbitrary hosts,
MySQL supports specifying the <var>user</var> value in the form
<code><var>user_name</var>@<var>host_name</var></code>.  If you want to specify a <var>user_name</var> string
containing special characters (such as <samp>`-'</samp>), or a <var>host_name</var> string
containing special characters or wildcard characters (such as <samp>`%'</samp>), you
can quote the username or hostname (for example,
<code>'test-user'@'test-hostname'</code>). Quote the username and hostname
separately.

</P>
<P>
You can specify wildcards in the hostname.  For example,
<code><var>user_name</var>@'%.loc.gov'</code> applies to <var>user_name</var> for any host in the
<code>loc.gov</code> domain, and <code><var>user_name</var>@'144.155.166.%'</code> applies to
<var>user_name</var> for any host in the <code>144.155.166</code> class C subnet.

</P>
<P>
The simple form <var>user_name</var> is a synonym for <code><var>user_name</var>@'%'</code>.

</P>
<P>
MySQL doesn't support wildcards in usernames.  Anonymous users are
defined by inserting entries with <code>User=''</code> into the
<code>mysql.user</code> table or creating a user with an empty name with the
<code>GRANT</code> statement:

</P>

<PRE>
mysql&#62; GRANT ALL ON test.* TO ''@'localhost' ...
</PRE>

<P>
When specifying quoted values, quote database, table, or column names as
identifiers, using backticks (<samp>``'</samp>).
Quote hostnames, usernames, or passwords as strings, using apostrophes
(<samp>`''</samp>).

</P>
<P>
<strong>Warning:</strong> If you allow anonymous users to connect to the MySQL
server, you should also grant privileges to all local users as
<code><var>user_name</var>@localhost</code>. Otherwise, the anonymous-user account for
the local host in the <code>mysql.user</code> table will be used when named users
try to log in to the MySQL server from the local machine!
(This anonymous-user account is created during MySQL installation.)

</P>
<P>
You can determine whether this applies to you by executing the following query:

</P>

<PRE>
mysql&#62; SELECT Host, User FROM mysql.user WHERE User='';
</PRE>

<P>
If you want to delete the local anonymous-user account to avoid the problem
just described, use these statements:

</P>

<PRE>
mysql&#62; DELETE FROM mysql.user WHERE Host='localhost' AND User='';
mysql&#62; FLUSH PRIVILEGES;
</PRE>

<P>
For the moment, <code>GRANT</code> only supports host, table, database, and
column names up to 60 characters long. A username can be up to 16
characters.

</P>
<P>
The privileges for a table or column are formed additively from the
logical OR of the privileges at each of the four privilege
levels.  For example, if the <code>mysql.user</code> table specifies that a
user has a global <code>SELECT</code> privilege, the privilege cannot be denied by an
entry at the database, table, or column level.

</P>
<P>
The privileges for a column can be calculated as follows:

</P>

<PRE>
global privileges
OR (database privileges AND host privileges)
OR table privileges
OR column privileges
</PRE>

<P>
In most cases, you grant rights to a user at only one of the privilege
levels, so life isn't normally this complicated. The details of the
privilege-checking procedure are presented in
section <A HREF="manual.html#Privilege_system">5.4  The MySQL Access Privilege System</A>.

</P>
<P>
If you grant privileges for a username/hostname combination that does not exist
in the <code>mysql.user</code> table, an entry is added and remains there until
deleted with a <code>DELETE</code> statement.  In other words, <code>GRANT</code> may
create <code>user</code> table entries, but <code>REVOKE</code> will not remove them;
you must do that explicitly using <code>DROP USER</code> or <code>DELETE</code>.

</P>
<P>
<A NAME="IDX1696"></A>
In MySQL 3.22.12 or later,
if a new user is created or if you have global grant privileges, the user's
password is set to the password specified by the <code>IDENTIFIED BY</code>
clause, if one is given.  If the user already had a password, it is replaced
by the new one.

</P>
<P>
<strong>Warning:</strong> If you create a new user but do not specify an
<code>IDENTIFIED BY</code> clause, the user has no password.  This is insecure.

</P>
<P>
Passwords can also be set with the <code>SET PASSWORD</code> statement.
See section <A HREF="manual.html#SET_PASSWORD">14.5.1.3  <code>SET PASSWORD</code> Syntax</A>.

</P>
<P>
If you don't want to send the password in clear text, you can use
the <code>PASSWORD</code> keyword followed by a scrambled password from the
<code>PASSWORD()</code> SQL function or the <code>make_scrambled_password()</code>
C API function.

</P>
<P>
If you grant privileges for a database, an entry in the <code>mysql.db</code>
table is created if needed. If all privileges for the database are
removed with <code>REVOKE</code>, this entry is deleted.

</P>
<P>
If a user has no privileges for a table, the table name is not displayed
when the user requests a list of tables (for example, with a <code>SHOW TABLES</code>
statement). If a user has no privileges for a database, the database name
is not displayed by <code>SHOW DATABASES</code> unless the user has the <code>SHOW
DATABASES</code> privilege.

</P>
<P>
The <code>WITH GRANT OPTION</code> clause gives the user the ability to give
to other users any privileges the user has at the specified privilege level.
You should be careful to whom you give the <code>GRANT OPTION</code> privilege,
because two users with different privileges may be able to join privileges!

</P>
<P>
You cannot grant another user a privilege you don't have yourself; the
<code>GRANT OPTION</code> privilege allows you to give away only those privileges
you possess.

</P>
<P>
Be aware that when you grant a user the <code>GRANT OPTION</code> privilege at a
particular privilege level, any privileges the user already possesses (or
is given in the future!) at that level are also grantable by that user.
Suppose that you grant a user the <code>INSERT</code> privilege on a database.  If
you then grant the <code>SELECT</code> privilege on the database and specify
<code>WITH GRANT OPTION</code>, the user can give away not only the <code>SELECT</code>
privilege, but also <code>INSERT</code>.  If you then grant the <code>UPDATE</code>
privilege to the user on the database, the user can give away
<code>INSERT</code>, <code>SELECT</code>, and <code>UPDATE</code>.

</P>
<P>
You should not grant <code>ALTER</code> privileges to a normal user.  If you
do that, the user can try to subvert the privilege system by renaming
tables!

</P>
<P>
The <code>MAX_QUERIES_PER_HOUR count</code>, <code>MAX_UPDATES_PER_HOUR count</code>,
and <code>MAX_CONNECTIONS_PER_HOUR count</code> options are new in MySQL 4.0.2.
They limit the number of queries, updates, and logins a user can perform
during one hour. If <code>count</code> is 0 (the default), this means there is no
limitation for that user. See section <A HREF="manual.html#User_resources">5.5.4  Limiting Account Resources</A>.  Note: To specify any of
these options for an existing user without affecting existing privileges,
use <code>GRANT USAGE ON *.* ... WITH MAX_...</code>.

</P>
<P>
<A NAME="IDX1697"></A>
<A NAME="IDX1698"></A>

</P>
<P>
MySQL can check X509 certificate attributes in addition to the usual
authentication that is based on the username and password.  To specify
SSL-related options for a MySQL account, use the <code>REQUIRE</code> clause of
the <code>GRANT</code> statement.
(For background on the use of SSL with MySQL, see section <A HREF="manual.html#Secure_connections">5.5.7  Using Secure Connections</A>.)

</P>
<P>
There are different possibilities for limiting connection types for an account:

</P>

<UL>
<LI>

If an account has no SSL or X509 requirements, unencrypted connections are
allowed if the username and password are valid. However, encrypted
connections also can be used at the client's option, if the client has the
proper certificate and key files.

<LI>

The <code>REQUIRE SSL</code> option tells the server to allow only SSL-encrypted
connections for the account. Note that this option can be omitted
if there are any access-control records that allow non-SSL connections.


<PRE>
mysql&#62; GRANT ALL PRIVILEGES ON test.* TO 'root'@'localhost'
    -&#62; IDENTIFIED BY 'goodsecret' REQUIRE SSL;
</PRE>

<LI>

<code>REQUIRE X509</code> means that the client must have a valid certificate
but that the exact certificate, issuer, and subject do not matter.
The only requirement is that it should be possible to verify its
signature with one of the CA certificates.


<PRE>
mysql&#62; GRANT ALL PRIVILEGES ON test.* TO 'root'@'localhost'
    -&#62; IDENTIFIED BY 'goodsecret' REQUIRE X509;
</PRE>

<LI>

<code>REQUIRE ISSUER 'issuer'</code> places the restriction on connection attempts
that the client must present a valid X509 certificate issued by CA
<code>'issuer'</code>.  If the client presents a certificate that is valid but has
a different issuer, the server rejects the connection.  Use of X509
certificates always implies encryption, so the <code>SSL</code> option is
unneccessary.


<PRE>
mysql&#62; GRANT ALL PRIVILEGES ON test.* TO 'root'@'localhost'
    -&#62; IDENTIFIED BY 'goodsecret'
    -&#62; REQUIRE ISSUER '/C=FI/ST=Some-State/L=Helsinki/
       O=MySQL Finland AB/CN=Tonu Samuel/Email=tonu@example.com';
</PRE>

Note that the <code>ISSUER</code> value should be entered as a single string.

<LI>

<code>REQUIRE SUBJECT 'subject'</code> places the restriction on connection
attempts that the client must present a valid X509 certificate with subject
<code>'subject'</code> in it.  If the client presents a certificate that is valid
but has a different subject, the server rejects the connection.


<PRE>
mysql&#62; GRANT ALL PRIVILEGES ON test.* TO 'root'@'localhost'
    -&#62; IDENTIFIED BY 'goodsecret'
    -&#62; REQUIRE SUBJECT '/C=EE/ST=Some-State/L=Tallinn/
       O=MySQL demo client certificate/
       CN=Tonu Samuel/Email=tonu@example.com';
</PRE>

Note that the <code>SUBJECT</code> value should be entered as a single string.

<LI>

<code>REQUIRE CIPHER 'cipher'</code> is needed to ensure that strong enough ciphers
and key lengths will be used. SSL itself can be weak if old algorithms
with short encryption keys are used. Using this option, you can ask for
some exact cipher method to allow a connection.


<PRE>
mysql&#62; GRANT ALL PRIVILEGES ON test.* TO 'root'@'localhost'
    -&#62; IDENTIFIED BY 'goodsecret'
    -&#62; REQUIRE CIPHER 'EDH-RSA-DES-CBC3-SHA';
</PRE>

</UL>

<P>
The <code>SUBJECT</code>, <code>ISSUER</code>, and <code>CIPHER</code> options can be
combined in the <code>REQUIRE</code> clause like this:

</P>

<PRE>
mysql&#62; GRANT ALL PRIVILEGES ON test.* TO 'root'@'localhost'
    -&#62; IDENTIFIED BY 'goodsecret'
    -&#62; REQUIRE SUBJECT '/C=EE/ST=Some-State/L=Tallinn/
       O=MySQL demo client certificate/
       CN=Tonu Samuel/Email=tonu@example.com'
    -&#62; AND ISSUER '/C=FI/ST=Some-State/L=Helsinki/
       O=MySQL Finland AB/CN=Tonu Samuel/Email=tonu@example.com'
    -&#62; AND CIPHER 'EDH-RSA-DES-CBC3-SHA';
</PRE>

<P>
Note that the <code>SUBJECT</code> and <code>ISSUER</code> values each should be entered
as a single string.

</P>
<P>
Starting from MySQL 4.0.4, the <code>AND</code> keyword is optional between
<code>REQUIRE</code> options.

</P>
<P>
The order of the options does not matter, but no option can be specified
twice.

</P>
<P>
When <code>mysqld</code> starts, all privileges are read into memory.
Database, table, and column privileges take effect at once, and
user-level privileges take effect the next time the user connects.
Modifications to the grant tables that you perform using <code>GRANT</code> or
<code>REVOKE</code> are noticed by the server immediately.
If you modify the grant tables manually (using <code>INSERT</code>, <code>UPDATE</code>,
and so on), you should execute a <code>FLUSH PRIVILEGES</code> statement or run
<code>mysqladmin flush-privileges</code> to tell the server to reload the grant
tables.
See section <A HREF="manual.html#Privilege_changes">5.4.7  When Privilege Changes Take Effect</A>.

</P>
<P>
Note that if you are using table or column privileges for even one user, the
server examines table and column privileges for all users and this slows
down MySQL a bit.  Similarly, if you limit the number of queries, updates,
or connections for any users, the server must monitor these values.

</P>
<P>
<A NAME="IDX1699"></A>
The biggest differences between the standard SQL and MySQL versions of
<code>GRANT</code> are:

</P>

<UL>
<LI>

In MySQL, privileges are associated with a username/hostname combination
and not with only a username.

<LI>

Standard SQL doesn't have global or database-level privileges, nor does it 
support all the privilege types that MySQL supports.

<LI>

MySQL doesn't support the standard SQL <code>TRIGGER</code> or <code>UNDER</code>
privileges.

<LI>

Standard SQL privileges are structured in a hierarchical manner. If you remove
a user, all privileges the user has been granted are revoked. In
MySQL, the granted privileges are not automatically revoked;
you must revoke them yourself.

<LI>

With standard SQL, when you drop a table, all privileges for the table are
revoked.  With standard SQL, when you revoke a privilege, all privileges
that were granted based on the privilege are also revoked. In MySQL,
privileges can be dropped only with explicit <code>REVOKE</code> statements or
by manipulating the MySQL grant tables.

<LI>

In MySQL, if you have the <code>INSERT</code> privilege on only some of the
columns in a table, you can execute <code>INSERT</code> statements on the
table; the columns for which you don't have the <code>INSERT</code> privilege
will be set to their default values. Standard SQL requires you to have the
<code>INSERT</code> privilege on all columns.

</UL>



<H4><A NAME="SET_PASSWORD" HREF="manual_toc.html#SET_PASSWORD">14.5.1.3  <code>SET PASSWORD</code> Syntax</A></H4>

<P>
<A NAME="IDX1700"></A>

</P>
<P>
<A NAME="IDX1701"></A>
<A NAME="IDX1702"></A>

</P>

<PRE>
SET PASSWORD = PASSWORD('<var>some password</var>')
SET PASSWORD FOR <var>user</var> = PASSWORD('<var>some password</var>')
</PRE>

<P>
The <code>SET PASSWORD</code> statement assigns a password to an existing
MySQL user account.

</P>
<P>
The first syntax sets the password for the current user. Any client that has
connected to the server using a non-anonymous account can change the password
for that account.

</P>

<P>
The second syntax sets the password for a specific account on the current
server host. Only clients with access to the <code>mysql</code> database can do
this.  The <var>user</var> value should be given in <code><var>user_name</var>@<var>host_name</var></code>
format, where <var>user_name</var> and <var>host_name</var> are exactly as they are
listed in the <code>User</code> and <code>Host</code> columns of the <code>mysql.user</code>
table entry.  For example, if you had an entry with <code>User</code> and
<code>Host</code> column values of <code>'bob'</code> and <code>'%.loc.gov'</code>, you would
write the statement like this:

</P>

<PRE>
mysql&#62; SET PASSWORD FOR 'bob'@'%.loc.gov' = PASSWORD('<var>newpass</var>');
</PRE>

<P>
That is equivalent to the following statements:

</P>

<PRE>
mysql&#62; UPDATE mysql.user SET Password=PASSWORD('<var>newpass</var>')
    -&#62; WHERE User='bob' AND Host='%.loc.gov';
mysql&#62; FLUSH PRIVILEGES;
</PRE>



<H3><A NAME="Table_maintenance_SQL" HREF="manual_toc.html#Table_maintenance_SQL">14.5.2  Table Maintenance Statements</A></H3>



<H4><A NAME="ANALYZE_TABLE" HREF="manual_toc.html#ANALYZE_TABLE">14.5.2.1  <code>ANALYZE TABLE</code> Syntax</A></H4>

<P>
<A NAME="IDX1703"></A>

</P>

<PRE>
ANALYZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE <var>tbl_name</var> [, <var>tbl_name</var>] ...
</PRE>

<P>
This statement analyzes and stores the key distribution for a table.
During the analysis, the table is locked with a read lock.  This works on
<code>MyISAM</code> and <code>BDB</code> tables and (as of MySQL 4.0.13) <code>InnoDB</code>
tables. For <code>MyISAM</code> tables, this
statement is equivalent to using <code>myisamchk -a</code>.

</P>
<P>
MySQL uses the stored key distribution to decide the order in which
tables should be joined when you perform a join on something other than a
constant.

</P>
<P>
The statement returns a table with the following columns:

</P>
<TABLE BORDER>
<TR><TD><strong>Column</strong> </TD><TD> <strong>Value</strong>
</TD></TR>
<TR><TD><code>Table</code> </TD><TD> The table name
</TD></TR>
<TR><TD><code>Op</code> </TD><TD> Always <code>analyze</code>
</TD></TR>
<TR><TD><code>Msg_type</code> </TD><TD> One of <code>status</code>, <code>error</code>, <code>info</code>, or <code>warning</code>
</TD></TR>
<TR><TD><code>Msg_text</code> </TD><TD> The message
</TD></TR>
</TABLE>

<P>
You can check the stored key distribution with the <code>SHOW INDEX</code> statement.
See section <A HREF="manual.html#Show_database_info">14.5.3.7  <code>SHOW DATABASES</code> Syntax</A>.

</P>
<P>
If the table hasn't changed since the last <code>ANALYZE TABLE</code> statement,
the table will not be analyzed again.

</P>
<P>
Before MySQL 4.1.1, <code>ANALYZE TABLE</code> statements are not written
to the binary log. As of MySQL 4.1.1, they are written to the binary
log unless the optional <code>NO_WRITE_TO_BINLOG</code> keyword 
(or its alias <code>LOCAL</code>) is used.

</P>



<H4><A NAME="BACKUP_TABLE" HREF="manual_toc.html#BACKUP_TABLE">14.5.2.2  <code>BACKUP TABLE</code> Syntax</A></H4>

<P>
<A NAME="IDX1704"></A>

</P>
<P>
<A NAME="IDX1705"></A>

</P>

<PRE>
BACKUP TABLE <var>tbl_name</var> [, <var>tbl_name</var>] ... TO '<var>/path/to/backup/directory</var>'
</PRE>

<P>
<strong>Note</strong>: This statement is deprecated. We are working on a better
replacement for it that will provide online backup capabilities.
In the meantime, the <code>mysqlhotcopy</code> script can be used instead.

</P>
<P>
<code>BACKUP TABLE</code> copies to the backup directory the minimum number of
table files needed to restore the table, after flushing any buffered changes
to disk. The statement works only for <code>MyISAM</code> tables.  It copies the
<tt>`.frm'</tt> definition  and <tt>`.MYD'</tt> data files. The <tt>`.MYI'</tt>
index file can be rebuilt from those two files.
The directory should be specified as a full pathname.

</P>
<P>
Before using this statement, please see section <A HREF="manual.html#Backup">5.6.1  Database Backups</A>.

</P>
<P>
During the backup, a read lock is held for each table, one at time,
as they are being backed up. If you want to back up several tables as
a snapshot (preventing any of them from being changed during the backup
operation), you must first issue a <code>LOCK TABLES</code> statement to obtain a read
lock for every table in the group.

</P>
<P>
The statement returns a table with the following columns:

</P>
<TABLE BORDER>
<TR><TD><strong>Column</strong> </TD><TD> <strong>Value</strong>
</TD></TR>
<TR><TD><code>Table</code> </TD><TD> The table name
</TD></TR>
<TR><TD><code>Op</code> </TD><TD> Always <code>backup</code>
</TD></TR>
<TR><TD><code>Msg_type</code> </TD><TD> One of <code>status</code>, <code>error</code>, <code>info</code>, or <code>warning</code>
</TD></TR>
<TR><TD><code>Msg_text</code> </TD><TD> The message
</TD></TR>
</TABLE>

<P>
<code>BACKUP TABLE</code> is available in MySQL 3.23.25 and later.

</P>



<H4><A NAME="CHECK_TABLE" HREF="manual_toc.html#CHECK_TABLE">14.5.2.3  <code>CHECK TABLE</code> Syntax</A></H4>

<P>
<A NAME="IDX1706"></A>

</P>

<PRE>
CHECK TABLE <var>tbl_name</var> [, <var>tbl_name</var>] ... [<var>option</var>] ...

<var>option</var> = {QUICK | FAST | MEDIUM | EXTENDED | CHANGED}
</PRE>

<P>
<code>CHECK TABLE</code> works only on <code>MyISAM</code> and <code>InnoDB</code> tables. On
<code>MyISAM</code> tables, This is the same thing as running <code>myisamchk
--medium-check <var>tbl_name</var></code> on the table.

</P>
<P>
If you don't specify any option, <code>MEDIUM</code> is used.

</P>
<P>
Checks the table or tables for errors. For <code>MyISAM</code> tables, the key statistics
are updated. The statement returns a table with the following columns:

</P>
<TABLE BORDER>
<TR><TD><strong>Column</strong> </TD><TD> <strong>Value</strong>
</TD></TR>
<TR><TD><code>Table</code> </TD><TD> The table name
</TD></TR>
<TR><TD><code>Op</code> </TD><TD> Always <code>check</code>
</TD></TR>
<TR><TD><code>Msg_type</code> </TD><TD> One of <code>status</code>, <code>error</code>, <code>info</code>, or <code>warning</code>
</TD></TR>
<TR><TD><code>Msg_text</code> </TD><TD> The message
</TD></TR>
</TABLE>

<P>
Note that the statement might produce many rows of information for each
checked table.  The last row will have a <code>Msg_type</code> value of
<code>status</code> and the <code>Msg_text</code> normally should be <code>OK</code>.  If you
don't get <code>OK</code>, or <code>Table is already up to date</code> you should
normally run a repair of the table. See section <A HREF="manual.html#Table_maintenance">5.6.2  Table Maintenance and Crash Recovery</A>. <code>Table is
already up to date</code> means that the storage engine for the table indicated
that there was no need to check the table.

</P>
<P>
The different check types are as follows:

</P>
<TABLE BORDER>
<TR><TD><strong>Type</strong> </TD><TD> <strong>Meaning</strong>
</TD></TR>
<TR><TD><code>QUICK</code> </TD><TD> Don't scan the rows to check for incorrect links.
</TD></TR>
<TR><TD><code>FAST</code> </TD><TD> Only check tables that haven't been closed properly.
</TD></TR>
<TR><TD><code>CHANGED</code> </TD><TD> Only check tables that have been changed since the last check or haven't been closed properly.
</TD></TR>
<TR><TD><code>MEDIUM</code> </TD><TD> Scan rows to verify that deleted links are okay. This also calculates a key checksum for the rows and verifies this with a calculated checksum for the keys.
</TD></TR>
<TR><TD><code>EXTENDED</code> </TD><TD> Do a full key lookup for all keys for each row.  This ensures that the table is 100% consistent, but will take a long time!
</TD></TR>
</TABLE>

<P>
If none of the options <code>QUICK</code>, <code>MEDIUM</code>, or <code>EXTENDED</code>
are specified, the default check type for dynamic-format <code>MyISAM</code>
tables is <code>MEDIUM</code>.  The default check type also is <code>MEDIUM</code> for
static-format <code>MyISAM</code> tables, unless <code>CHANGED</code> or <code>FAST</code>
is specified.  In that case, the default is <code>QUICK</code>. The row scan
is skipped for <code>CHANGED</code> and <code>FAST</code> because the rows are very
seldom corrupted.

</P>
<P>
You can combine check options, as in the following example, which does
a quick check on the table to see whether it was
closed properly:

</P>

<PRE>
CHECK TABLE test_table FAST QUICK;
</PRE>

<P>
<strong>Note</strong>: In some cases, <code>CHECK TABLE</code> will change the
table!  This happens if the table is marked as ``corrupted'' or ``not
closed properly'' but <code>CHECK TABLE</code> doesn't find any problems in the
table.  In this case, <code>CHECK TABLE</code> marks the table as okay.

</P>
<P>
If a table is corrupted, it's most likely that the problem is in
the indexes and not in the data part.  All of the preceding check types
check the indexes thoroughly and should thus find most errors.

</P>
<P>
If you just want to check a table that you assume is okay, you should use
no check options or the <code>QUICK</code> option. The latter should be used
when you are in a hurry and can take the very small risk that
<code>QUICK</code> doesn't find an error in the data file. (In most cases,
MySQL should find, under normal usage, any error in the data file.
If this happens, the table is marked as ``corrupted'' and cannot
be used until it's repaired.)

</P>
<P>
<code>FAST</code> and <code>CHANGED</code> are mostly intended to be used from a
script (for example, to be executed from <code>cron</code>) if you want to check your
table from time to time. In most cases, <code>FAST</code> is to be preferred
over <code>CHANGED</code>.  (The only case when it isn't preferred is when you suspect
that you have found a bug in the <code>MyISAM</code> code.)

</P>
<P>
<code>EXTENDED</code> is to be used only after you have run a normal check but
still get strange errors from a table when MySQL tries to
update a row or find a row by key. (This is very unlikely if a
normal check has succeeded!)

</P>
<P>
Some problems reported by <code>CHECK TABLE</code> can't be corrected automatically:

</P>

<UL>
<LI>

<code>Found row where the auto_increment column has the value 0</code>.

This means that you have a row in the table where the
<code>AUTO_INCREMENT</code> index column contains the value 0.
(It's possible to create a row where the <code>AUTO_INCREMENT</code> column is 0 by
explicitly setting the column to 0 with an <code>UPDATE</code> statement.)

This isn't an error in itself, but could cause trouble if you decide to
dump the table and restore it or do an <code>ALTER TABLE</code> on the
table. In this case, the <code>AUTO_INCREMENT</code> column will change value
according to the rules of <code>AUTO_INCREMENT</code> columns, which could cause
problems such as a duplicate-key error.

To get rid of the warning, just execute an <code>UPDATE</code> statement
to set the column to some other value than 0.
</UL>



<H4><A NAME="CHECKSUM_TABLE" HREF="manual_toc.html#CHECKSUM_TABLE">14.5.2.4  <code>CHECKSUM TABLE</code> Syntax</A></H4>
<P>
<A NAME="IDX1707"></A>

</P>

<PRE>
CHECKSUM TABLE <var>tbl_name</var> [, <var>tbl_name</var>] ... [ QUICK | EXTENDED ]
</PRE>

<P>
Reports a table checksum.

</P>
<P>
If <code>QUICK</code> is specified, the live table checksum is reported if it is
available, or <code>NULL</code> otherwise.  This is very fast.  A live checksum
is enabled by specifying the <code>CHECKSUM=1</code> table option, currently
supported only for <code>MyISAM</code> tables.
See section <A HREF="manual.html#CREATE_TABLE">14.2.5  <code>CREATE TABLE</code> Syntax</A>.

</P>
<P>
In <code>EXTENDED</code> mode the whole table is read row by row and the checksum
is calculated. This can be very slow for large tables.

</P>
<P>
By default, if neither <code>QUICK</code> nor <code>EXTENDED</code> is specified, MySQL
returns a live checksum if the table storage engine supports it and scans
the table otherwise.

</P>
<P>
This statement is implemented in MySQL 4.1.1.

</P>



<H4><A NAME="OPTIMIZE_TABLE" HREF="manual_toc.html#OPTIMIZE_TABLE">14.5.2.5  <code>OPTIMIZE TABLE</code> Syntax</A></H4>

<P>
<A NAME="IDX1708"></A>

</P>
<P>
<A NAME="IDX1709"></A>
<A NAME="IDX1710"></A>

</P>

<PRE>
OPTIMIZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE <var>tbl_name</var> [, <var>tbl_name</var>] ...
</PRE>

<P>
<code>OPTIMIZE TABLE</code> should be used if you have deleted a large part of a
table or if you have made many changes to a table with variable-length rows
(tables that have <code>VARCHAR</code>, <code>BLOB</code>, or <code>TEXT</code> columns).
Deleted records are maintained in a linked list and subsequent <code>INSERT</code>
operations reuse old record positions. You can use <code>OPTIMIZE TABLE</code> to
reclaim the unused space and to defragment the data file.

</P>
<P>
In most setups, you need not run <code>OPTIMIZE TABLE</code> at all.  Even
if you do a lot of updates to variable-length rows, it's not likely that
you need to do this more than once a week or month and only on certain
tables.

</P>
<P>
For the moment, <code>OPTIMIZE TABLE</code> works only on <code>MyISAM</code>,
<code>BDB</code> and <code>InnoDB</code> tables. For <code>BDB</code> tables, <code>OPTIMIZE
TABLE</code> is currently mapped to <code>ANALYZE TABLE</code>. It was also the case for
<code>InnoDB</code> tables before MySQL 4.1.3; starting from this version it is
mapped to <code>ALTER TABLE</code>.
See section <A HREF="manual.html#ANALYZE_TABLE">14.5.2.1  <code>ANALYZE TABLE</code> Syntax</A>.

</P>
<P>
You can get <code>OPTIMIZE TABLE</code> to work on other table types by starting
<code>mysqld</code> with the <code>--skip-new</code> or <code>--safe-mode</code> option;
in this case, <code>OPTIMIZE TABLE</code> is just mapped to <code>ALTER TABLE</code>.

</P>
<P>
<code>OPTIMIZE TABLE</code> works as follows:

<OL>
<LI>

If the table has deleted or split rows, repair the table.
<LI>

If the index pages are not sorted, sort them.
<LI>

If the statistics are not up to date (and the repair couldn't be done
by sorting the index), update them.
</OL>

<P>
Note that MySQL locks the table during the time <code>OPTIMIZE TABLE</code> is
running.

</P>
<P>
Before MySQL 4.1.1, <code>OPTIMIZE TABLE</code> statements are not written
to the binary log. As of MySQL 4.1.1, they are written to the binary
log unless the optional <code>NO_WRITE_TO_BINLOG</code> keyword 
(or its alias <code>LOCAL</code>) is used.

</P>



<H4><A NAME="REPAIR_TABLE" HREF="manual_toc.html#REPAIR_TABLE">14.5.2.6  <code>REPAIR TABLE</code> Syntax</A></H4>

<P>
<A NAME="IDX1711"></A>

</P>

<PRE>
REPAIR [LOCAL | NO_WRITE_TO_BINLOG] TABLE
    <var>tbl_name</var> [, <var>tbl_name</var>] ... [QUICK] [EXTENDED] [USE_FRM]
</PRE>

<P>
<code>REPAIR TABLE</code> repairs a possibly corrupted table.
By default,
it has the same effect as <code>myisamchk --recover <var>tbl_name</var></code>.
<code>REPAIR TABLE</code> works only on <code>MyISAM</code> tables.

</P>
<P>
Normally you should never have to run this statement. However, if disaster
strikes, <code>REPAIR TABLE</code> is very likely to get back all your data from
a <code>MyISAM</code> table.  If your tables become corrupted often, you should try
to find the reason for it, to eliminate the need to use <code>REPAIR TABLE</code>.
See section <A HREF="manual.html#Crashing">A.4.2  What to Do If MySQL Keeps Crashing</A>.  See section <A HREF="manual.html#MyISAM_table_problems">15.1.4  <code>MyISAM</code> Table Problems</A>.

</P>
<P>
The statement returns a table with the following columns:

</P>
<TABLE BORDER>
<TR><TD><strong>Column</strong> </TD><TD> <strong>Value</strong>
</TD></TR>
<TR><TD><code>Table</code> </TD><TD> The table name
</TD></TR>
<TR><TD><code>Op</code> </TD><TD> Always <code>repair</code>
</TD></TR>
<TR><TD><code>Msg_type</code> </TD><TD> One of <code>status</code>, <code>error</code>, <code>info</code>, or <code>warning</code>
</TD></TR>
<TR><TD><code>Msg_text</code> </TD><TD> The message
</TD></TR>
</TABLE>

<P>
The <code>REPAIR TABLE</code> statement might produce many rows of information
for each repaired table.  The last row will have a <code>Msg_type</code> value of
<code>status</code> and <code>Msg_test</code> normally should be <code>OK</code>.  If you
don't get <code>OK</code>, you should try repairing the table with <code>myisamchk
--safe-recover</code>, because <code>REPAIR TABLE</code> does not yet implement all the
options of <code>myisamchk</code>. We plan to make it more flexible in the future.

</P>
<P>
If <code>QUICK</code> is given, <code>REPAIR TABLE</code> tries to repair
only the index tree.  This type of repair is like that done by
<code>myisamchk --recover --quick</code>.

</P>
<P>
If you use <code>EXTENDED</code>, MySQL creates the index row by row instead of
creating one index at a time with sorting.  (Before MySQL 4.1, this might
be better than sorting on fixed-length keys if you have long <code>CHAR</code>
keys that compress very well.)  This type of repair is like that done by
<code>myisamchk --safe-recover</code>.

</P>
<P>
As of MySQL 4.0.2, there is a <code>USE_FRM</code> mode for <code>REPAIR TABLE</code>.
Use it if the <tt>`.MYI'</tt> index file is missing or if its header is
corrupted.  In this mode, MySQL will re-create the <tt>`.MYI'</tt> file using
information from the <tt>`.frm'</tt> file. This kind of repair cannot be done
with <code>myisamchk</code>. <strong>Note</strong>: Use this mode <strong>only</strong> if you cannot
use regular <code>REPAIR</code> modes. <tt>`.MYI'</tt> header contains important
table metadata (in particular, current <code>AUTO_INCREMENT</code> value
and <code>Delete link</code>) that will be lost in <code>REPAIR ... USE_FRM</code>.

</P>
<P>
Before MySQL 4.1.1, <code>REPAIR TABLE</code> statements are not written
to the binary log. As of MySQL 4.1.1, they are written to the binary
log unless the optional <code>NO_WRITE_TO_BINLOG</code> keyword 
(or its alias <code>LOCAL</code>) is used.

</P>
<P>
<strong>Warning:</strong> If the server dies during a <code>REPAIR TABLE</code> operation,
it's essential after restarting it that you immediately execute another
<code>REPAIR TABLE</code> statement for the table before performing any other
operations on it. (It's always good to start by making a backup.)  In the
worst case, you might have a new clean index file without information about
the data file, and then the next operation you perform could overwrite the
data file.  This is an unlikely, but possible scenario.

</P>


<H4><A NAME="RESTORE_TABLE" HREF="manual_toc.html#RESTORE_TABLE">14.5.2.7  <code>RESTORE TABLE</code> Syntax</A></H4>

<P>
<A NAME="IDX1712"></A>

</P>


<PRE>
RESTORE TABLE <var>tbl_name</var> [, <var>tbl_name</var>] ... FROM '<var>/path/to/backup/directory</var>'
</PRE>

<P>
Restores the table or tables from a backup that was made with <code>BACKUP
TABLE</code>. Existing tables will not be overwritten; if you try to restore over
an existing table, you will get an error.  Just as <code>BACKUP TABLE</code>,
<code>RESTORE TABLE</code> currently works only for <code>MyISAM</code> tables.
The directory should be specified as a full pathname.

</P>
<P>
The backup for each table consists of its <tt>`.frm'</tt> format file and
<tt>`.MYD'</tt> data file. The restore operation restores those files, then
uses them to rebuild the <tt>`.MYI'</tt> index file.  Restoring takes longer
than backing up due to the need to rebuild the indexes. The more indexes the
table has, the longer it will take.

</P>
<P>
The statement returns a table with the following columns:

</P>
<TABLE BORDER>
<TR><TD><strong>Column</strong> </TD><TD> <strong>Value</strong>
</TD></TR>
<TR><TD><code>Table</code> </TD><TD> The table name
</TD></TR>
<TR><TD><code>Op</code> </TD><TD> Always <code>restore</code>
</TD></TR>
<TR><TD><code>Msg_type</code> </TD><TD> One of <code>status</code>, <code>error</code>, <code>info</code>, or <code>warning</code>
</TD></TR>
<TR><TD><code>Msg_text</code> </TD><TD> The message
</TD></TR>
</TABLE>



<H3><A NAME="SHOW" HREF="manual_toc.html#SHOW">14.5.3  <code>SET</code> and <code>SHOW</code> Syntax</A></H3>

<P>
<A NAME="IDX1713"></A>
<A NAME="IDX1714"></A>
<A NAME="IDX1715"></A>
<A NAME="IDX1716"></A>
<A NAME="IDX1717"></A>
<A NAME="IDX1718"></A>
<A NAME="IDX1719"></A>
<A NAME="IDX1720"></A>
<A NAME="IDX1721"></A>
<A NAME="IDX1722"></A>
<A NAME="IDX1723"></A>
<A NAME="IDX1724"></A>
<A NAME="IDX1725"></A>
<A NAME="IDX1726"></A>
<A NAME="IDX1727"></A>
<A NAME="IDX1728"></A>
<A NAME="IDX1729"></A>
<A NAME="IDX1730"></A>
<A NAME="IDX1731"></A>
<A NAME="IDX1732"></A>
<A NAME="IDX1733"></A>

</P>

<P>
<code>SET</code> allows you to set variables and options.

</P>
<P>
<code>SHOW</code> has many forms that provide information about databases,
tables, columns, or status information about the server.
This section describes those following:

</P>

<PRE>
SHOW [FULL] COLUMNS FROM <var>tbl_name</var> [FROM <var>db_name</var>] [LIKE '<var>pattern</var>']
SHOW CREATE DATABASE <var>db_name</var>
SHOW CREATE TABLE <var>tbl_name</var>
SHOW DATABASES [LIKE '<var>pattern</var>']
SHOW [STORAGE] ENGINES
SHOW ERRORS [LIMIT [<var>offset</var>,] <var>row_count</var>]
SHOW GRANTS FOR <var>user</var>
SHOW INDEX FROM <var>tbl_name</var> [FROM <var>db_name</var>]
SHOW INNODB STATUS
SHOW [BDB] LOGS
SHOW PRIVILEGES
SHOW [FULL] PROCESSLIST
SHOW STATUS [LIKE '<var>pattern</var>']
SHOW TABLE STATUS [FROM <var>db_name</var>] [LIKE '<var>pattern</var>']
SHOW [OPEN] TABLES [FROM <var>db_name</var>] [LIKE '<var>pattern</var>']
SHOW [GLOBAL | SESSION] VARIABLES [LIKE '<var>pattern</var>']
SHOW WARNINGS [LIMIT [<var>offset</var>,] <var>row_count</var>]
</PRE>

<P>
If the syntax for a given <code>SHOW</code> statement includes a <code>LIKE
'<var>pattern</var>'</code> part, <code>'<var>pattern</var>'</code> is a string that can contain the SQL <samp>`%'</samp>
and <samp>`_'</samp> wildcard characters.
The pattern is useful for restricting statement output to matching values.

</P>
<P>
Note that there are other forms of these statements described elsewhere:

</P>

<UL>
<LI>

The <code>SET PASSWORD</code> statement for assigning account passwords is
described in
See section <A HREF="manual.html#SET_PASSWORD">14.5.1.3  <code>SET PASSWORD</code> Syntax</A>.

<LI>

The <code>SHOW</code> statement has forms that provide information about
replication master and slave servers:

<A NAME="IDX1734"></A>
<A NAME="IDX1735"></A>
<A NAME="IDX1736"></A>
<A NAME="IDX1737"></A>
<A NAME="IDX1738"></A>


<PRE>
SHOW BINLOG EVENTS
SHOW MASTER LOGS
SHOW MASTER STATUS
SHOW SLAVE HOSTS
SHOW SLAVE STATUS
</PRE>

These forms of <code>SHOW</code> are described in section <A HREF="manual.html#Replication_SQL">14.6  Replication Statements</A>.

</UL>



<H4><A NAME="SET_OPTION" HREF="manual_toc.html#SET_OPTION">14.5.3.1  <code>SET</code> Syntax</A></H4>

<P>
<A NAME="IDX1739"></A>
<A NAME="IDX1740"></A>

</P>


<PRE>
SET <var>variable_assignment</var> [, <var>variable_assignment</var>] ...

<var>variable_assignment</var>:
      <var>user_var_name</var> = <var>expr</var>
    | [GLOBAL | SESSION] <var>system_var_name</var> = <var>expr</var>
    | @@[global. | session.]<var>system_var_name</var> = <var>expr</var>
</PRE>

<P>
<code>SET</code> sets different types of variables that affect the operation of the
server or your client. It can be used to assign values to user variables or
system variables.

</P>
<P>
In MySQL 4.0.3, we added the <code>GLOBAL</code> and <code>SESSION</code> options
and allowed most important system variables to be changed dynamically at
runtime.
The system variables that you can set at runtime are described in
section <A HREF="manual.html#Dynamic_System_Variables">5.2.3.1  Dynamic System Variables</A>.

</P>
<P>
In older versions of MySQL, <code>SET OPTION</code> is used instead of <code>SET</code>,
but this is now deprecated; just leave out the word <code>OPTION</code>.

</P>
<P>
The following example show the different syntaxes you can use to set
variables.

</P>
<P>
A user variable is written as <code>@<var>var_name</var></code> and can be set as follows:

</P>

<PRE>
SET @<var>var_name</var> = <var>expr</var>;
</PRE>

<P>
Further information about user variables is given in section <A HREF="manual.html#Variables">10.3  User Variables</A>.

</P>
<P>
System variables can be referred to in <code>SET</code> statements as
<var>var_name</var>. The name optionally can be preceded by <code>GLOBAL</code> or
<code>@@global.</code> to indicate explicitly that the variable is a global
variable, or by <code>SESSION</code>, <code>@@session.</code>, or <code>@@</code> to
indicate that it is a session variable.  <code>LOCAL</code> and <code>@@local.</code>
are synonyms for <code>SESSION</code> and <code>@@session.</code>. If no modifier is
present, <code>SET</code> sets the session variable.

</P>
<P>
The <code>@@<var>var_name</var></code> syntax for system variables is supported to make
MySQL syntax compatible with some other database systems.

</P>
<P>
If you set several system variables in the same statement, the last used
<code>GLOBAL</code> or <code>SESSION</code> option is used for variables that have no mode
specified.

</P>

<PRE>
SET sort_buffer_size=10000;
SET @@local.sort_buffer_size=10000;
SET GLOBAL sort_buffer_size=1000000, SESSION sort_buffer_size=1000000;
SET @@sort_buffer_size=1000000;
SET @@global.sort_buffer_size=1000000, @@local.sort_buffer_size=1000000;
</PRE>

<P>
If you set a system variable using <code>SESSION</code> (the default), the value
remains in effect until the current session ends or until you set the
variable to a different value. If you set a system variable using
<code>GLOBAL</code>, which requires the <code>SUPER</code> privilege, the value is
remembered and used for new connections until the server restarts. If you
want to make a variable setting permanent, you should put it in an option
file.  See section <A HREF="manual.html#Option_files">4.3.2  Using Option Files</A>.

</P>
<P>
To prevent incorrect usage, MySQL produces an error if you use <code>SET
GLOBAL</code> with a variable that can only be used with <code>SET SESSION</code> or if
you do not specify <code>GLOBAL</code> when setting a global variable.

</P>
<P>
If you want to set a <code>SESSION</code> variable to the <code>GLOBAL</code> value or a
<code>GLOBAL</code> value to the compiled-in MySQL default value, you can set it to
<code>DEFAULT</code>. For example, the following two statements are identical in
setting the session value of <code>max_join_size</code> to the global value:

</P>

<PRE>
SET max_join_size=DEFAULT;
SET @@session.max_join_size=@@global.max_join_size;
</PRE>

<P>
You can get a list of most system variables with <code>SHOW VARIABLES</code>.
See section <A HREF="manual.html#SHOW_VARIABLES">14.5.3.19  <code>SHOW VARIABLES</code> Syntax</A>.
To get a specific variable name or list of names that match a pattern, use a
<code>LIKE</code> clause:

</P>

<PRE>
SHOW VARIABLES LIKE 'max_join_size';
SHOW GLOBAL VARIABLES LIKE 'max_join_size';
</PRE>

<P>
You can also get the value for a specific value by using the
<code>@@[global.|local.]var_name</code> syntax with <code>SELECT</code>:

</P>

<PRE>
SELECT @@max_join_size, @@global.max_join_size;
</PRE>

<P>
When you retrieve a variable with <code>SELECT @@var_name</code> (that is, you
do not specify <code>global.</code>, <code>session.</code>, or <code>local.</code>), MySQL returns
the <code>SESSION</code> value if it exists and the <code>GLOBAL</code> value otherwise.

</P>
<P>
The following list describes variables that have non-standard syntax or that are
not described in the list of system variables that is found in
section <A HREF="manual.html#Server_system_variables">5.2.3  Server System Variables</A>.
Although these variables are not displayed by <code>SHOW VARIABLES</code>, you can
obtain their values with <code>SELECT</code> (with the exception of <code>CHARACTER
SET</code> and <code>SET NAMES</code>). For example:

</P>

<PRE>
mysql&#62; SELECT @@AUTOCOMMIT;
+--------------+
| @@autocommit |
+--------------+
|            1 |
+--------------+
</PRE>

<DL COMPACT>

<DT><code>AUTOCOMMIT = {0 | 1}</code>
<DD>
Set the autocommit mode.
If set to <code>1</code>, all changes to a table take effect immediately.
If set to <code>0</code>, you have to use <code>COMMIT</code> to accept a transaction or
<code>ROLLBACK</code> to cancel it.  If you change <code>AUTOCOMMIT</code>
mode from <code>0</code> to <code>1</code>, MySQL performs an automatic <code>COMMIT</code>
of any open transaction.  Another way to begin a transaction is to use a
<code>START TRANSACTION</code> or <code>BEGIN</code> statement.
See section <A HREF="manual.html#COMMIT">14.4.1  <code>START TRANSACTION</code>, <code>COMMIT</code>, and <code>ROLLBACK</code> Syntax</A>.

<DT><code>BIG_TABLES = {0 | 1}</code>
<DD>
<A NAME="IDX1741"></A>
If set to <code>1</code>, all temporary tables are stored on disk rather than in
memory.  This is a little slower, but the error <code>The table <var>tbl_name</var> is
full</code> will not occur for <code>SELECT</code> operations that require a large
temporary table.  The default value for a new connection is
<code>0</code> (use in-memory temporary tables).  As of MySQL 4.0, you
should normally never need to set this variable, because MySQL automatically
converts in-memory tables to disk-based tables as necessary.  This variable
previously was named <code>SQL_BIG_TABLES</code>.

<DT><code>CHARACTER SET {<var>charset_name</var> | DEFAULT}</code>
<DD>
This maps all strings from and to the client with the given mapping.
Before MySQL 4.1, the only allowable value for <code>charset_name</code>
is <code>cp1251_koi8</code>, but you can add new mappings by editing the
<tt>`sql/convert.cc'</tt> file in the MySQL source distribution.  As of MySQL
4.1.1, <code>SET CHARACTER SET</code> sets three session system variables:
<code>character_set_client</code> and <code>character_set_results</code> are set to
the given character set, and <code>character_set_connection</code> to the value
of <code>character_set_database</code>.

The default mapping can be restored by using a value of <code>DEFAULT</code>.

Note that the syntax for <code>SET CHARACTER SET</code> differs
from that for setting most other options.

<DT><code>FOREIGN_KEY_CHECKS = {0 | 1}</code>
<DD>
If set to <code>1</code> (the default), foreign key constraints for <code>InnoDB</code>
tables are checked.  If set to <code>0</code>, they are ignored.  Disabling foreign
key checking can be useful for reloading <code>InnoDB</code> tables in an order
different than that required by their parent/child relationships.
This variable was added in MySQL 3.23.52.
See section <A HREF="manual.html#InnoDB_foreign_key_constraints">16.7.4  <code>FOREIGN KEY</code> Constraints</A>.

<DT><code>IDENTITY = <var>value</var></code>
<DD>
The variable is a synonym for the <code>LAST_INSERT_ID</code> variable.
It exists for compatibility with other databases.
As of MySQL 3.23.25, you can read its value with <code>SELECT @@IDENTITY</code>.
As of MySQL 4.0.3, you can also set its value with <code>SET IDENTITY</code>.

<DT><code>INSERT_ID = <var>value</var></code>
<DD>
Set the value to be used by the following <code>INSERT</code> or <code>ALTER TABLE</code>
statement when inserting an <code>AUTO_INCREMENT</code> value.  This is mainly used
with the binary log.

<DT><code>LAST_INSERT_ID = <var>value</var></code>
<DD>
Set the value to be returned from <code>LAST_INSERT_ID()</code>. This is stored in
the binary log when you use <code>LAST_INSERT_ID()</code> in a statement that updates
a table. Setting this variable does not update theh value returned by the
<code>mysql_insert_id()</code> C API function.

<DT><code>NAMES {'<var>charset_name</var>' | DEFAULT}</code>
<DD>
<code>SET NAMES</code> sets the three session system variables
<code>character_set_client</code>, <code>character_set_connection</code>, and
<code>character_set_results</code> to the given character set.

The default mapping can be restored by using a value of <code>DEFAULT</code>.

Note that the syntax for <code>SET NAMES</code> differs
from that for setting most other options.
This statement is available as of MySQL 4.1.0.

<DT><code>SQL_AUTO_IS_NULL = {0 | 1}</code>
<DD>
If set to <code>1</code> (the default), you can find the last inserted row for a table
that contains an <code>AUTO_INCREMENT</code> column by using the following construct:


<PRE>
WHERE <var>auto_increment_column</var> IS NULL
</PRE>

This behavior is used by some ODBC programs, such as Access.
<code>SQL_AUTO_IS_NULL</code> was added in MySQL 3.23.52.

<DT><code>SQL_BIG_SELECTS = {0 | 1}</code>
<DD>
If set to <code>0</code>, MySQL aborts <code>SELECT</code> statements
that probably will take a very long time (that is, statements for which
the optimizer estimates that the number of examined rows will
exceed the value of <code>max_join_size</code>).
This is useful when an inadvisable <code>WHERE</code> statement has been
issued.  The default value for a new connection is <code>1</code>, which allows
all <code>SELECT</code> statements.

If you set the <code>max_join_size</code> system variable to a value other than
<code>DEFAULT</code>, <code>SQL_BIG_SELECTS</code> will be set to <code>0</code>.

<DT><code>SQL_BUFFER_RESULT = {0 | 1}</code>
<DD>
<code>SQL_BUFFER_RESULT</code> forces results from <code>SELECT</code> statements
to be put into temporary tables. This helps MySQL free the
table locks early and can be beneficial in cases where it takes a long time to
send results to the client.
This variable was added in MySQL 3.23.13.

<DT><code>SQL_LOG_BIN = {0 | 1}</code>
<DD>
If set to <code>0</code>, no logging is done to the binary log for the client.
The client must have the <code>SUPER</code> privilege to set this option.
This variable was added in MySQL 3.23.16.

<DT><code>SQL_LOG_OFF = {0 | 1}</code>
<DD>
If set to <code>1</code>, no logging is done to the general query log for this
client.  The client must have the <code>SUPER</code> privilege to set this option.

<DT><code>SQL_LOG_UPDATE = {0 | 1}</code>
<DD>
If set to <code>0</code>, no logging is done to the update log for the client.
The client must have the <code>SUPER</code> privilege to set this option.
This variable was added in MySQL 3.22.5.
Starting from MySQL 5.0.0, it is deprecated and is mapped to
<code>SQL_LOG_BIN</code> (see section <A HREF="manual.html#News-5.0.0">C.1.3  Changes in release 5.0.0 (22 Dec 2003: Alpha)</A>).

<DT><code>SQL_QUOTE_SHOW_CREATE = {0 | 1}</code>
<DD>
If set to <code>1</code>, <code>SHOW CREATE TABLE</code> quotes table and column
names. If set to <code>0</code>, quoting is disabled.  This option is enabled
by default so that replication will work for tables with table and column
names that require quoting.
This variable was added in MySQL 3.23.26.
section <A HREF="manual.html#SHOW_CREATE_TABLE">14.5.3.6  <code>SHOW CREATE TABLE</code> Syntax</A>.

<DT><code>SQL_SAFE_UPDATES = {0 | 1}</code>
<DD>
If set to <code>1</code>, MySQL aborts <code>UPDATE</code> or <code>DELETE</code> statements
that do not use a key in the <code>WHERE</code> clause or a <code>LIMIT</code> clause.
This makes it possible to catch <code>UPDATE</code> or <code>DELETE</code> statements
where keys are not used properly and that would probably change or delete a
large number of rows.
This variable was added in MySQL 3.22.32.

<DT><code>SQL_SELECT_LIMIT = {<var>value</var> | DEFAULT}</code>
<DD>
The maximum number of records to return from <code>SELECT</code> statements.  The
default value for a new connection is ``unlimited.'' If you have changed the
limit, the default value can be restored by using a <code>SQL_SELECT_LIMIT</code>
value of <code>DEFAULT</code>.

If a <code>SELECT</code> has a <code>LIMIT</code> clause, the <code>LIMIT</code> takes
precedence over the value of <code>SQL_SELECT_LIMIT</code>.

<DT><code>SQL_WARNINGS = {0 | 1}</code>
<DD>
This variable controls whether single-row <code>INSERT</code> statements produce
an information string if warnings occur.  The default is 0.  Set the value
to 1 to produce an information string.
This variable was added in MySQL 3.22.11.

<DT><code>TIMESTAMP = {<var>timestamp_value</var> | DEFAULT}</code>
<DD>
Set the time for this client.  This is used to get the original timestamp if
you use the binary log to restore rows.  <code>timestamp_value</code> should be a
Unix epoch timestamp, not a MySQL timestamp.

<DT><code>UNIQUE_CHECKS = {0 | 1}</code>
<DD>
If set to <code>1</code> (the default), uniqueness checks for secondary indexes in
<code>InnoDB</code> tables are performed.  If set to <code>0</code>, no uniqueness
checks are done.  This variable was added in MySQL 3.23.52.
See section <A HREF="manual.html#InnoDB_foreign_key_constraints">16.7.4  <code>FOREIGN KEY</code> Constraints</A>.

</DL>



<H4><A NAME="SHOW_CHARACTER_SET" HREF="manual_toc.html#SHOW_CHARACTER_SET">14.5.3.2  <code>SHOW CHARACTER SET</code> Syntax</A></H4>

<P>
<A NAME="IDX1742"></A>

</P>

<PRE>
SHOW CHARACTER SET [LIKE '<var>pattern</var>']
</PRE>

<P>
The <code>SHOW CHARACTER SET</code> statement shows all available character sets.
It takes an optional <code>LIKE</code> clause that indicates which character set
names to match. For example:

</P>

<PRE>
mysql&#62; SHOW CHARACTER SET LIKE 'latin%';
+---------+-----------------------------+-------------------+--------+
| Charset | Description                 | Default collation | Maxlen |
+---------+-----------------------------+-------------------+--------+
| latin1  | ISO 8859-1 West European    | latin1_swedish_ci |      1 |
| latin2  | ISO 8859-2 Central European | latin2_general_ci |      1 |
| latin5  | ISO 8859-9 Turkish          | latin5_turkish_ci |      1 |
| latin7  | ISO 8859-13 Baltic          | latin7_general_ci |      1 |
+---------+-----------------------------+-------------------+--------+
</PRE>

<P>
The <code>Maxlen</code> column shows the maximum number of bytes used to
store one character.

</P>
<P>
<code>SHOW CHARACTER SET</code> is available as of MySQL 4.1.0.

</P>



<H4><A NAME="SHOW_COLLATION" HREF="manual_toc.html#SHOW_COLLATION">14.5.3.3  <code>SHOW COLLATION</code> Syntax</A></H4>

<P>
<A NAME="IDX1743"></A>

</P>

<PRE>
SHOW COLLATION [LIKE '<var>pattern</var>']
</PRE>

<P>
The output from <code>SHOW COLLATION</code> includes all available character
sets.
It takes an optional <code>LIKE</code> clause that indicates which collation
names to match. For example:

</P>

<PRE>
mysql&#62; SHOW COLLATION LIKE 'latin1%';
+-------------------+---------+----+---------+----------+---------+
| Collation         | Charset | Id | Default | Compiled | Sortlen |
+-------------------+---------+----+---------+----------+---------+
| latin1_german1_ci | latin1  |  5 |         |          |       0 |
| latin1_swedish_ci | latin1  |  8 | Yes     | Yes      |       0 |
| latin1_danish_ci  | latin1  | 15 |         |          |       0 |
| latin1_german2_ci | latin1  | 31 |         | Yes      |       2 |
| latin1_bin        | latin1  | 47 |         | Yes      |       0 |
| latin1_general_ci | latin1  | 48 |         |          |       0 |
| latin1_general_cs | latin1  | 49 |         |          |       0 |
| latin1_spanish_ci | latin1  | 94 |         |          |       0 |
+-------------------+---------+----+---------+----------+---------+
</PRE>

<P>
The <code>Default</code> column indicates whether a collation is the
default for its character set.
<code>Compiled</code> indicates whether the character set is
compiled into the server.
<code>Sortlen</code> is related to the amount of memory required to sort strings
expressed in the character set.

</P>
<P>
<code>SHOW COLLATION</code> is available as of MySQL 4.1.0.

</P>



<H4><A NAME="SHOW_COLUMNS" HREF="manual_toc.html#SHOW_COLUMNS">14.5.3.4  <code>SHOW COLUMNS</code> Syntax</A></H4>

<P>
<A NAME="IDX1744"></A>
<A NAME="IDX1745"></A>

</P>

<PRE>
SHOW [FULL] COLUMNS FROM <var>tbl_name</var> [FROM <var>db_name</var>] [LIKE '<var>pattern</var>']
</PRE>

<P>
<code>SHOW COLUMNS</code> lists the columns in a given table.  If the column types
differ from what you expect them to be based on your <code>CREATE TABLE</code>
statement, note that MySQL sometimes changes column types when you create or
alter a table.  The conditions for which this occurs are described in
section <A HREF="manual.html#Silent_column_changes">14.2.5.1  Silent Column Specification Changes</A>.

</P>
<P>
The <code>FULL</code> keyword can be used from MySQL 3.23.32 on. It causes the
output to include the privileges you have for each column.  As of MySQL 4.1,
<code>FULL</code> also causes any per-column comments to be displayed.

</P>
<P>
You can use <var>db_name.tbl_name</var> as an alternative to the <code><var>tbl_name</var>
FROM <var>db_name</var></code> syntax.  These two statements are equivalent:

</P>

<PRE>
mysql&#62; SHOW COLUMNS FROM mytable FROM mydb;
mysql&#62; SHOW COLUMNS FROM mydb.mytable;
</PRE>

<P>
<code>SHOW FIELDS</code> is a synonym for <code>SHOW COLUMNS</code>.  You can also
list a table's columns with the <code>mysqlshow <var>db_name</var> <var>tbl_name</var></code> command.

</P>
<P>
The <code>DESCRIBE</code> statement provides information similar to
<code>SHOW COLUMNS</code>.
See section <A HREF="manual.html#DESCRIBE">14.3.1  <code>DESCRIBE</code> Syntax (Get Information About Columns)</A>.

</P>



<H4><A NAME="SHOW_CREATE_DATABASE" HREF="manual_toc.html#SHOW_CREATE_DATABASE">14.5.3.5  <code>SHOW CREATE DATABASE</code> Syntax</A></H4>

<P>
<A NAME="IDX1746"></A>

</P>

<PRE>
SHOW CREATE DATABASE <var>db_name</var>
</PRE>

<P>
Shows a <code>CREATE DATABASE</code> statement that will create the given database.
It was added in MySQL 4.1.

</P>

<PRE>
mysql&#62; SHOW CREATE DATABASE test\G
*************************** 1. row ***************************
       Database: test
Create Database: CREATE DATABASE `test`
                 /*!40100 DEFAULT CHARACTER SET latin1 */
</PRE>



<H4><A NAME="SHOW_CREATE_TABLE" HREF="manual_toc.html#SHOW_CREATE_TABLE">14.5.3.6  <code>SHOW CREATE TABLE</code> Syntax</A></H4>

<P>
<A NAME="IDX1747"></A>

</P>

<PRE>
SHOW CREATE TABLE <var>tbl_name</var>
</PRE>

<P>
Shows a <code>CREATE TABLE</code> statement that will create the given table.
It was added in MySQL 3.23.20.

</P>

<PRE>
mysql&#62; SHOW CREATE TABLE t\G
*************************** 1. row ***************************
       Table: t
Create Table: CREATE TABLE t (
  id INT(11) default NULL auto_increment,
  s char(60) default NULL,
  PRIMARY KEY (id)
) TYPE=MyISAM

</PRE>

<P>
<code>SHOW CREATE TABLE</code> quotes table and column names according to
the value of the <code>SQL_QUOTE_SHOW_CREATE</code> option.
section <A HREF="manual.html#SET_OPTION">14.5.3.1  <code>SET</code> Syntax</A>.

</P>



<H4><A NAME="Show_database_info" HREF="manual_toc.html#Show_database_info">14.5.3.7  <code>SHOW DATABASES</code> Syntax</A></H4>

<P>
<A NAME="IDX1748"></A>
<A NAME="IDX1749"></A>

</P>

<PRE>
SHOW DATABASES [LIKE '<var>pattern</var>']
</PRE>

<P>
<code>SHOW DATABASES</code> lists the databases on the MySQL server host.
You can also get this list using the <code>mysqlshow</code> command.
As of MySQL 4.0.2, you will see only those databases for which you have some
kind of privilege, if you don't have the global <code>SHOW DATABASES</code>
privilege.

</P>
<P>
If the server was started with the <code>--skip-show-database</code> option, you
cannot use this statement at all unless you have the <code>SHOW DATABASES</code>
privilege.

</P>



<H4><A NAME="SHOW_ENGINES" HREF="manual_toc.html#SHOW_ENGINES">14.5.3.8  <code>SHOW ENGINES</code> Syntax</A></H4>

<P>
<A NAME="IDX1750"></A>
<A NAME="IDX1751"></A>
<A NAME="IDX1752"></A>

</P>

<PRE>
SHOW [STORAGE] ENGINES
</PRE>

<P>
<code>SHOW ENGINES</code> shows you status information about the storage engines.
This is particularly useful for checking whether a storage engine is
supported, or to see what the default engine is.
This statement is implemented in MySQL 4.1.2.
<code>SHOW TABLE TYPES</code> is a deprecated synonym.

</P>

<PRE>
mysql&#62; SHOW ENGINES\G
*************************** 1. row ***************************
 Engine: MyISAM
Support: DEFAULT
Comment: Default engine as of MySQL 3.23 with great performance
*************************** 2. row ***************************
 Engine: HEAP
Support: YES
Comment: Alias for MEMORY
*************************** 3. row ***************************
 Engine: MEMORY
Support: YES
Comment: Hash based, stored in memory, useful for temporary tables
*************************** 4. row ***************************
 Engine: MERGE
Support: YES
Comment: Collection of identical MyISAM tables
*************************** 5. row ***************************
 Engine: MRG_MYISAM
Support: YES
Comment: Alias for MERGE
*************************** 6. row ***************************
 Engine: ISAM
Support: NO
Comment: Obsolete storage engine, now replaced by MyISAM
*************************** 7. row ***************************
 Engine: MRG_ISAM
Support: NO
Comment: Obsolete storage engine, now replaced by MERGE
*************************** 8. row ***************************
 Engine: InnoDB
Support: YES
Comment: Supports transactions, row-level locking, and foreign keys
*************************** 9. row ***************************
 Engine: INNOBASE
Support: YES
Comment: Alias for INNODB
*************************** 10. row ***************************
 Engine: BDB
Support: YES
Comment: Supports transactions and page-level locking
*************************** 11. row ***************************
 Engine: BERKELEYDB
Support: YES
Comment: Alias for BDB
*************************** 12. row ***************************
 Engine: NDBCLUSTER
Support: YES
Comment: Clustered, fault-tolerant, memory-based tables
*************************** 13. row ***************************
 Engine: NDB
Support: YES
Comment: Alias for NDBCLUSTER
*************************** 14. row ***************************
 Engine: EXAMPLE
Support: YES
Comment: Example storage engine
*************************** 15. row ***************************
 Engine: ARCHIVE
Support: YES
Comment: Archive storage engine
</PRE>

<P>
A <code>Support</code> value indicates whether the particular storage engine is
supported, and which is the default engine. For example, if the server
is started with the <code>--default-table-type=InnoDB</code> option, then
the <code>Support</code> value for the <code>InnoDB</code> row will have the value
<code>DEFAULT</code>.

</P>



<H4><A NAME="SHOW_ERRORS" HREF="manual_toc.html#SHOW_ERRORS">14.5.3.9  <code>SHOW ERRORS</code> Syntax</A></H4>

<P>
<A NAME="IDX1753"></A>

</P>

<PRE>
SHOW ERRORS [LIMIT [<var>offset</var>,] <var>row_count</var>]
SHOW COUNT(*) ERRORS
</PRE>

<P>
This statement is similar to <code>SHOW WARNINGS</code>, except that instead
of displaying errors, warnings, and notes, it displays only errors.
<code>SHOW ERRORS</code> is available as of MySQL 4.1.0.

</P>
<P>
The <code>LIMIT</code> clause has the same syntax as for the <code>SELECT</code>
statement.
See section <A HREF="manual.html#SELECT">14.1.7  <code>SELECT</code> Syntax</A>.

</P>
<P>
The <code>SHOW COUNT(*) ERRORS</code> statement displays the number of errors.
You can also retrieve this number from the <code>error_count</code> variable:

</P>

<PRE>
SHOW COUNT(*) ERRORS;
SELECT @@error_count;
</PRE>

<P>
For more information, see section <A HREF="manual.html#SHOW_WARNINGS">14.5.3.20  <code>SHOW WARNINGS</code> Syntax</A>.

</P>



<H4><A NAME="SHOW_GRANTS" HREF="manual_toc.html#SHOW_GRANTS">14.5.3.10  <code>SHOW GRANTS</code> Syntax</A></H4>

<P>
<A NAME="IDX1754"></A>
<A NAME="IDX1755"></A>
<A NAME="IDX1756"></A>

</P>

<PRE>
SHOW GRANTS FOR <var>user</var>
</PRE>

<P>
This statement lists the <code>GRANT</code> statements that must be issued to
duplicate the privileges for a MySQL user account.

</P>

<PRE>
mysql&#62; SHOW GRANTS FOR 'root'@'localhost';
+---------------------------------------------------------------------+
| Grants for root@localhost                                           |
+---------------------------------------------------------------------+
| GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' WITH GRANT OPTION |
+---------------------------------------------------------------------+
</PRE>

<P>
As of MySQL 4.1.2, to list privileges for the current session, you can use
any of the following statements:

</P>

<PRE>
SHOW GRANTS;
SHOW GRANTS FOR CURRENT_USER;
SHOW GRANTS FOR CURRENT_USER();
</PRE>

<P>
Before MySQL 4.1.2,  you can find out what user the
session was authenticated as by selecting the value
of the <code>CURRENT_USER()</code> function (new in MySQL 4.0.6).
Then use that value in the <code>SHOW GRANTS</code> statement.
See section <A HREF="manual.html#Information_functions">13.8.3  Information Functions</A>.

</P>
<P>
<code>SHOW GRANTS</code> is available as of MySQL 3.23.4.

</P>



<H4><A NAME="SHOW_INDEX" HREF="manual_toc.html#SHOW_INDEX">14.5.3.11  <code>SHOW INDEX</code> Syntax</A></H4>

<P>
<A NAME="IDX1757"></A>
<A NAME="IDX1758"></A>
<A NAME="IDX1759"></A>

</P>

<PRE>
SHOW INDEX FROM <var>tbl_name</var> [FROM <var>db_name</var>]
</PRE>

<P>
<code>SHOW INDEX</code> returns table index information in a format that
resembles the <code>SQLStatistics</code> call in ODBC.

</P>
<P>
<code>SHOW INDEX</code> returns the following fields:

</P>
<DL COMPACT>

<DT><code>Table</code>
<DD>
The name of the table.

<DT><code>Non_unique</code>
<DD>
0 if the index can't contain duplicates, 1 if it can.

<DT><code>Key_name</code>
<DD>
The name of the index.

<DT><code>Seq_in_index</code>
<DD>
The column sequence number in the index, starting with 1.

<DT><code>Column_name</code>
<DD>
The column name.

<A NAME="IDX1760"></A>

<DT><code>Collation</code>
<DD>
How the column is sorted in the index. In MySQL, this can have values
<samp>`A'</samp> (Ascending) or <code>NULL</code> (Not sorted).

<A NAME="IDX1761"></A>

<DT><code>Cardinality</code>
<DD>
The number of unique values in the index.  This is updated by running
<code>ANALYZE TABLE</code> or <code>myisamchk -a</code>.  <code>Cardinality</code> is counted
based on statistics stored as integers, so it's not necessarily accurate for
small tables. The higher the cardinality, the greater the chance that MySQL
will use the index when doing joins.

<DT><code>Sub_part</code>
<DD>
The number of indexed characters if the column is only partly indexed.
<code>NULL</code> if the entire column is indexed.

<DT><code>Packed</code>
<DD>
Indicates how the key is packed.  <code>NULL</code> if it is not.

<DT><code>Null</code>
<DD>
Contains <code>YES</code> if the column may contain <code>NULL</code>, <code>''</code>
if not.

<DT><code>Index_type</code>
<DD>
The index method used (<code>BTREE</code>, <code>FULLTEXT</code>, <code>HASH</code>,
<code>RTREE</code>).

<DT><code>Comment</code>
<DD>
Various remarks.  Before MySQL 4.0.2 when the <code>Index_type</code> column was
added, <code>Comment</code> indicates whether an index is <code>FULLTEXT</code>.

</DL>

<P>
The <code>Packed</code> and <code>Comment</code> columns were added in MySQL 3.23.0.
The <code>Null</code> and <code>Index_type</code> columns were added in MySQL 4.0.2.

</P>
<P>
You can use <var>db_name.tbl_name</var> as an alternative to the <code><var>tbl_name</var>
FROM <var>db_name</var></code> syntax.  These two statements are equivalent:

</P>

<PRE>
mysql&#62; SHOW INDEX FROM mytable FROM mydb;
mysql&#62; SHOW INDEX FROM mydb.mytable;
</PRE>

<P>
<code>SHOW KEYS</code> is a synonym for <code>SHOW INDEX</code>.  You can also list
a table's indexes with the <code>mysqlshow -k <var>db_name</var> <var>tbl_name</var></code> command.

</P>



<H4><A NAME="SHOW_INNODB_STATUS" HREF="manual_toc.html#SHOW_INNODB_STATUS">14.5.3.12  <code>SHOW INNODB STATUS</code> Syntax</A></H4>


<PRE>
SHOW INNODB STATUS
</PRE>

<P>
This statement shows extensive information about the state of the
<code>InnoDB</code> storage engine.

</P>



<H4><A NAME="SHOW_LOGS" HREF="manual_toc.html#SHOW_LOGS">14.5.3.13  <code>SHOW LOGS</code> Syntax</A></H4>


<PRE>
SHOW [BDB] LOGS
</PRE>

<P>
<code>SHOW LOGS</code> displays status information about existing log files.
It was implemented in MySQL 3.23.29. Currently, it displays only information
about Berkeley DB log files, so an alias for it (available as of MySQL
4.1.1) is <code>SHOW BDB LOGS</code>.

</P>
<P>
<code>SHOW LOGS</code> returns the following fields:

</P>
<DL COMPACT>

<DT><code>File</code>
<DD>
The full path to the log file.

<DT><code>Type</code>
<DD>
The log file type (<code>BDB</code> for Berkeley DB log files).

<DT><code>Status</code>
<DD>
The status of the log file (<code>FREE</code> if the file can be removed, or
<code>IN USE</code> if the file is needed by the transaction subsystem)

</DL>



<H4><A NAME="SHOW_PRIVILEGES" HREF="manual_toc.html#SHOW_PRIVILEGES">14.5.3.14  <code>SHOW PRIVILEGES</code> Syntax</A></H4>

<P>
<A NAME="IDX1762"></A>

</P>

<PRE>
SHOW PRIVILEGES
</PRE>

<P>
<code>SHOW PRIVILEGES</code> shows the list of system privileges that the underlying 
MySQL server supports.
This statement is implemented as of MySQL 4.1.0.

</P>

<PRE>
mysql&#62; SHOW PRIVILEGES\G
*************************** 1. row ***************************
Privilege: Select
  Context: Tables
  Comment: To retrieve rows from table
*************************** 2. row ***************************
Privilege: Insert
  Context: Tables
  Comment: To insert data into tables
*************************** 3. row ***************************
Privilege: Update
  Context: Tables
  Comment: To update existing rows 
*************************** 4. row ***************************
Privilege: Delete
  Context: Tables
  Comment: To delete existing rows
*************************** 5. row ***************************
Privilege: Index
  Context: Tables
  Comment: To create or drop indexes
*************************** 6. row ***************************
Privilege: Alter
  Context: Tables
  Comment: To alter the table
*************************** 7. row ***************************
Privilege: Create
  Context: Databases,Tables,Indexes
  Comment: To create new databases and tables
*************************** 8. row ***************************
Privilege: Drop
  Context: Databases,Tables
  Comment: To drop databases and tables
*************************** 9. row ***************************
Privilege: Grant
  Context: Databases,Tables
  Comment: To give to other users those privileges you possess
*************************** 10. row ***************************
Privilege: References
  Context: Databases,Tables
  Comment: To have references on tables
*************************** 11. row ***************************
Privilege: Reload
  Context: Server Admin
  Comment: To reload or refresh tables, logs and privileges
*************************** 12. row ***************************
Privilege: Shutdown
  Context: Server Admin
  Comment: To shutdown the server
*************************** 13. row ***************************
Privilege: Process
  Context: Server Admin
  Comment: To view the plain text of currently executing queries
*************************** 14. row ***************************
Privilege: File
  Context: File access on server
  Comment: To read and write files on the server
</PRE>



<H4><A NAME="SHOW_PROCESSLIST" HREF="manual_toc.html#SHOW_PROCESSLIST">14.5.3.15  <code>SHOW PROCESSLIST</code> Syntax</A></H4>

<P>
<A NAME="IDX1763"></A>
<A NAME="IDX1764"></A>
<A NAME="IDX1765"></A>

</P>
<P>
<A NAME="IDX1766"></A>
<A NAME="IDX1767"></A>

</P>

<PRE>
SHOW [FULL] PROCESSLIST
</PRE>

<P>
<code>SHOW PROCESSLIST</code> shows you which threads are running.
You can also get this information using the <code>mysqladmin processlist</code>
statement.  If you have the <code>SUPER</code> privilege, you can see all
threads.  Otherwise, you can see only your own threads (that is, threads
associated with the MySQL account that you are using).
See section <A HREF="manual.html#KILL">14.5.4.3  <code>KILL</code> Syntax</A>.
If you don't use the <code>FULL</code> keyword, only the first 100
characters of each query are shown.

</P>
<P>
Starting from MySQL 4.0.12, the statement reports the hostname for TCP/IP
connections in <code><var>host_name</var>:<var>client_port</var></code> format to make it easier to
determine which client is doing what.

</P>
<P>
This statement is very useful if you get the "too many connections" error
message and want to find out what is going on. MySQL reserves one extra
connection to be used by accounts that have the <code>SUPER</code> privilege, to
ensure that administrators should always be able to connect and check the
system (assuming that you are not giving this privilege to all your users).

</P>
<P>
Some states commonly seen in the output from <code>SHOW PROCESSLIST</code>:

</P>
<DL COMPACT>

<DT><code>Checking table</code>
<DD>
The thread is performing (automatic) checking of the table.

<DT><code>Closing tables</code>
<DD>
Means that the thread is flushing the changed table data to disk and
closing the used tables. This should be a fast operation.  If not, then
you should verify that you don't have a full disk and that the disk is not
in very heavy use.

<DT><code>Connect Out</code>
<DD>
Slave connecting to master.

<DT><code>Copying to tmp table on disk</code>
<DD>
The temporary result set was larger than <code>tmp_table_size</code> and the
thread is now changing the temporary table from in-memory to disk-based
format to save memory.

<DT><code>Creating tmp table</code>
<DD>
The thread is creating a temporary table to hold a part of the result for
the query.

<DT><code>deleting from main table</code>
<DD>
The server is executing the first part of a multiple-table delete and
deleting only from the first table.

<DT><code>deleting from reference tables</code>
<DD>
The server is executing the second part of a multiple-table delete and deleting
the matched rows from the other tables.

<DT><code>Flushing tables</code>
<DD>
The thread is executing <code>FLUSH TABLES</code> and is waiting for all
threads to close their tables.

<DT><code>Killed</code>
<DD>
Someone has sent a kill to the thread and it should abort next time it
checks the kill flag.  The flag is checked in each major loop in MySQL,
but in some cases it might still take a short time for the thread to die.
If the thread is locked by some other thread, the kill takes effect
as soon as the other thread releases its lock.

<DT><code>Sending data</code>
<DD>
The thread is processing rows for a <code>SELECT</code> statement and
also is sending data to the client.

<DT><code>Sorting for group</code>
<DD>
The thread is doing a sort to satisfy a <code>GROUP BY</code>.

<DT><code>Sorting for order</code>
<DD>
The thread is doing a sort to satisfy a <code>ORDER BY</code>.

<DT><code>Opening tables</code>
<DD>
The thread is trying to open a table. This is should be very fast procedure,
unless something prevents opening. For example, an <code>ALTER TABLE</code> or a
<code>LOCK TABLE</code> statement can prevent opening a table until the statement
is finished.

<DT><code>Removing duplicates</code>
<DD>
The query was using <code>SELECT DISTINCT</code> in such a way that MySQL
couldn't optimize away the distinct operation at an early stage. Because of
this, MySQL requires an extra stage to remove all duplicated rows before
sending the result to the client.

<DT><code>Reopen table</code>
<DD>
The thread got a lock for the table, but noticed after getting the lock
that the underlying table structure changed. It has freed the lock,
closed the table, and is now trying to reopen it.

<DT><code>Repair by sorting</code>
<DD>
The repair code is using sorting to create indexes.

<DT><code>Repair with keycache</code>
<DD>
The repair code is using creating keys one by one through the key cache.
This is much slower than <code>Repair by sorting</code>.

<DT><code>Searching rows for update</code>
<DD>
The thread is doing a first phase to find all matching rows before
updating them.  This has to be done if the <code>UPDATE</code> is changing
the index that is used to find the involved rows.

<DT><code>Sleeping</code>
<DD>
The thread is waiting for the client to send a new statement to it.

<DT><code>System lock</code>
<DD>
The thread is waiting to get an external system lock for the
table. If you are not using multiple <code>mysqld</code> servers that are accessing
the same tables, you can disable system locks with the
<code>--skip-external-locking</code> option.

<DT><code>Upgrading lock</code>
<DD>
The <code>INSERT DELAYED</code> handler is trying to get a lock for the table
to insert rows.

<DT><code>Updating</code>
<DD>
The thread is searching for rows to update and updating them.

<DT><code>User Lock</code>
<DD>
The thread is waiting on a <code>GET_LOCK()</code>.

<DT><code>Waiting for tables</code>
<DD>
The thread got a notification that the underlying structure for a table
has changed and it needs to reopen the table to get the new structure.
However, to be able to reopen the table, it must wait until all other
threads have closed the table in question.

This notification happens if another thread has used <code>FLUSH TABLES</code>
or one of the following statements on the table in question: <code>FLUSH
TABLES <var>tbl_name</var></code>, <code>ALTER TABLE</code>, <code>RENAME TABLE</code>,
<code>REPAIR TABLE</code>, <code>ANALYZE TABLE</code>, or <code>OPTIMIZE TABLE</code>.

<DT><code>waiting for handler insert</code>
<DD>
The <code>INSERT DELAYED</code> handler has processed all pending inserts and is
waiting for new ones.

</DL>

<P>
Most states correspond to very quick operations. If a thread stays in any
of these states for many seconds, there might be a problem that
needs to be investigated.

</P>
<P>
There are some other states that are not mentioned in the preceding list,
but many of them are useful only for finding bugs in the server.

</P>



<H4><A NAME="SHOW_STATUS" HREF="manual_toc.html#SHOW_STATUS">14.5.3.16  <code>SHOW STATUS</code> Syntax</A></H4>

<P>
<A NAME="IDX1768"></A>
<A NAME="IDX1769"></A>

</P>

<PRE>
SHOW STATUS [LIKE '<var>pattern</var>']
</PRE>

<P>
<A NAME="IDX1770"></A>
<code>SHOW STATUS</code> provides server status information.  This information
also can be obtained using the <code>mysqladmin extended-status</code> command.

</P>
<P>
Partial output is shown here. The list of variables and their values may be
different for your server. The meaning of each variable is given in
See section <A HREF="manual.html#Server_status_variables">5.2.4  Server Status Variables</A>.

</P>

<PRE>
mysql&#62; SHOW STATUS;
+--------------------------+------------+
| Variable_name            | Value      |
+--------------------------+------------+
| Aborted_clients          | 0          |
| Aborted_connects         | 0          |
| Bytes_received           | 155372598  |
| Bytes_sent               | 1176560426 |
| Connections              | 30023      |
| Created_tmp_disk_tables  | 0          |
| Created_tmp_tables       | 8340       |
| Created_tmp_files        | 60         |
...
| Open_tables              | 1          |
| Open_files               | 2          |
| Open_streams             | 0          |
| Opened_tables            | 44600      |
| Questions                | 2026873    |
...
| Table_locks_immediate    | 1920382    |
| Table_locks_waited       | 0          |
| Threads_cached           | 0          |
| Threads_created          | 30022      |
| Threads_connected        | 1          |
| Threads_running          | 1          |
| Uptime                   | 80380      |
+--------------------------+------------+
</PRE>

<P>
With a <code>LIKE</code> clause, the statement displays only those variables that
match the pattern:

</P>

<PRE>
mysql&#62; SHOW STATUS LIKE 'Key%';
+--------------------+----------+
| Variable_name      | Value    |
+--------------------+----------+
| Key_blocks_used    | 14955    |
| Key_read_requests  | 96854827 |
| Key_reads          | 162040   |
| Key_write_requests | 7589728  |
| Key_writes         | 3813196  |
+--------------------+----------+
</PRE>



<H4><A NAME="SHOW_TABLE_STATUS" HREF="manual_toc.html#SHOW_TABLE_STATUS">14.5.3.17  <code>SHOW TABLE STATUS</code> Syntax</A></H4>

<P>
<A NAME="IDX1771"></A>
<A NAME="IDX1772"></A>
<A NAME="IDX1773"></A>

</P>

<PRE>
SHOW TABLE STATUS [FROM <var>db_name</var>] [LIKE '<var>pattern</var>']
</PRE>

<P>
<code>SHOW TABLE STATUS</code> (new in MySQL 3.23) works likes <code>SHOW
TABLE</code>, but provides a lot of information about each table. You can
also get this list using the <code>mysqlshow --status <var>db_name</var></code> command.

</P>
<P>
<code>SHOW TABLE STATUS</code> returns the following fields:

</P>
<DL COMPACT>

<DT><code>Name</code>
<DD>
The name of the table.

<DT><code>Engine</code>
<DD>
The storage engine for the table.
Before MySQL 4.1.2, this value is labeled as <code>Type</code>.
See section <A HREF="manual.html#Table_types">15  MySQL Storage Engines and Table Types</A>.

<DT><code>Version</code>
<DD>
The version number of the table's
<tt>`.frm'</tt> file.

<DT><code>Row_format</code>
<DD>
The row storage format (<code>Fixed</code>, <code>Dynamic</code>, or <code>Compressed</code>).

<DT><code>Rows</code>
<DD>
The number of rows.
Some storage engines, such as <code>MyISAM</code> and <code>ISAM</code>, store the exact
count.
For other storage engines, such as <code>InnoDB</code>, this value is an
approximation.

<DT><code>Avg_row_length</code>
<DD>
The average row length.

<DT><code>Data_length</code>
<DD>
The length of the data file.

<DT><code>Max_data_length</code>
<DD>
The maximum length of the data file.
For fixed-row formats, this is the maximum number of rows in the table.
For dynamic-row formats, this is the total number of data bytes that
can be stored in the table, given the data pointer size used.

<DT><code>Index_length</code>
<DD>
The length of the index file.

<DT><code>Data_free</code>
<DD>
The number of allocated but unused bytes.

<DT><code>Auto_increment</code>
<DD>
The next <code>AUTO_INCREMENT</code> value.

<DT><code>Create_time</code>
<DD>
When the table was created.

<DT><code>Update_time</code>
<DD>
When the data file was last updated.

<DT><code>Check_time</code>
<DD>
When the table was last checked.

<DT><code>Collation</code>
<DD>
The table's character set and collation. (New in 4.1.1)

<DT><code>Checksum</code>
<DD>
The live checksum value (if any). (New in 4.1.1)

<DT><code>Create_options</code>
<DD>
Extra options used with <code>CREATE TABLE</code>.

<DT><code>Comment</code>
<DD>
The comment used when creating the table (or some information why MySQL
couldn't access the table information).

</DL>

<P>
In the table comment, <code>InnoDB</code> tables will report the free space of
the tablespace to which the table belongs.  For a table located in the
shared tablespace, this is the free space of the shared tablespace. If
you are using multiple tablespaces and the table has its own tablespace,
the freespace is for just that table.

</P>
<P>
For <code>MEMORY</code> (<code>HEAP</code>) tables, the <code>Data_length</code>,
<code>Max_data_length</code>, and <code>Index_length</code> values approximate the
actual amount of allocated memory. The allocation algorithm reserves memory
in large amounts to reduce the number of allocation operations.

</P>



<H4><A NAME="SHOW_TABLES" HREF="manual_toc.html#SHOW_TABLES">14.5.3.18  <code>SHOW TABLES</code> Syntax</A></H4>

<P>
<A NAME="IDX1774"></A>
<A NAME="IDX1775"></A>

</P>

<PRE>
SHOW [OPEN] TABLES [FROM <var>db_name</var>] [LIKE '<var>pattern</var>']
</PRE>

<P>
<code>SHOW TABLES</code> lists the non-<code>TEMPORARY</code> tables in a given
database.  You can also get this list using the <code>mysqlshow <var>db_name</var></code>
command.

</P>
<P>
<strong>Note</strong>: If you have no privileges for a table, the table
will not show up in the output from <code>SHOW TABLES</code> or <code>mysqlshow
db_name</code>.

</P>

<P>
<code>SHOW OPEN TABLES</code> lists the tables that are currently open in
the table cache. See section <A HREF="manual.html#Table_cache">7.4.8  How MySQL Opens and Closes Tables</A>.  The <code>Comment</code> field in the output
tells how many times the table is <code>cached</code> and <code>in_use</code>.
<code>OPEN</code> can be used from MySQL 3.23.33 on.

</P>



<H4><A NAME="SHOW_VARIABLES" HREF="manual_toc.html#SHOW_VARIABLES">14.5.3.19  <code>SHOW VARIABLES</code> Syntax</A></H4>

<P>
<A NAME="IDX1776"></A>
<A NAME="IDX1777"></A>
<A NAME="IDX1778"></A>
<A NAME="IDX1779"></A>

</P>

<PRE>
SHOW [GLOBAL | SESSION] VARIABLES [LIKE '<var>pattern</var>']
</PRE>

<P>
<A NAME="IDX1780"></A>
<code>SHOW VARIABLES</code> shows the values of some MySQL system variables.  This
information also can be obtained using the <code>mysqladmin variables</code>
command.

</P>
<P>
The <code>GLOBAL</code> and <code>SESSION</code> options are new in MySQL 4.0.3.
With <code>GLOBAL</code>, you will get the values that will be used for new
connections to MySQL. With <code>SESSION</code>, you will get the values that
are in effect for the current connection. If you use neither option, the
default <code>SESSION</code>. <code>LOCAL</code> is a synonym for <code>SESSION</code>.

</P>
<P>
If the default values are unsuitable, you can set most of these variables
using command-line options when <code>mysqld</code> starts or at runtime with
the <code>SET</code> statement.
See section <A HREF="manual.html#Server_options">5.2.1  <code>mysqld</code> Command-Line Options</A> and section <A HREF="manual.html#SET_OPTION">14.5.3.1  <code>SET</code> Syntax</A>.

</P>
<P>
Partial output is shown here. The list of variables and their values may be
different for your server. The meaning of each variable is given in
See section <A HREF="manual.html#Server_system_variables">5.2.3  Server System Variables</A>.
Information about tuning them is provided in section <A HREF="manual.html#Server_parameters">7.5.2  Tuning Server Parameters</A>.

</P>

<PRE>
mysql&#62; SHOW VARIABLES;
+---------------------------------+------------------------------+
| Variable_name                   | Value                        |
+---------------------------------+------------------------------|
| back_log                        | 50                           |
| basedir                         | /usr/local/mysql             |
| bdb_cache_size                  | 8388572                      |
| bdb_log_buffer_size             | 32768                        |
| bdb_home                        | /usr/local/mysql             |
...
| max_connections                 | 100                          |
| max_connect_errors              | 10                           |
| max_delayed_threads             | 20                           |
| max_error_count                 | 64                           |
| max_heap_table_size             | 16777216                     |
| max_join_size                   | 4294967295                   |
| max_relay_log_size              | 0                            |
| max_sort_length                 | 1024                         |
...
| timezone                        | EEST                         |
| tmp_table_size                  | 33554432                     |
| tmpdir                          | /tmp/:/mnt/hd2/tmp/          |
| version                         | 4.0.4-beta                   |
| wait_timeout                    | 28800                        |
+---------------------------------+------------------------------+
</PRE>

<P>
With a <code>LIKE</code> clause, the statement displays only those variables that
match the pattern:

</P>

<PRE>
mysql&#62; SHOW VARIABLES LIKE 'have%';
+--------------------+----------+
| Variable_name      | Value    |
+--------------------+----------+
| have_bdb           | YES      |
| have_innodb        | YES      |
| have_isam          | YES      |
| have_raid          | NO       |
| have_symlink       | DISABLED |
| have_openssl       | YES      |
| have_query_cache   | YES      |
+--------------------+----------+
</PRE>



<H4><A NAME="SHOW_WARNINGS" HREF="manual_toc.html#SHOW_WARNINGS">14.5.3.20  <code>SHOW WARNINGS</code> Syntax</A></H4>

<P>
<A NAME="IDX1781"></A>

</P>

<PRE>
SHOW WARNINGS [LIMIT [<var>offset</var>,] <var>row_count</var>]
SHOW COUNT(*) WARNINGS
</PRE>

<P>
<code>SHOW WARNINGS</code> shows the error, warning, and note messages that
resulted from the last statement that generated messages, or nothing if the
last statement that used a table generated no messages.
This statement is implemented as of MySQL 4.1.0.
A related statement, <code>SHOW ERRORS</code>, shows only the errors.
See section <A HREF="manual.html#SHOW_ERRORS">14.5.3.9  <code>SHOW ERRORS</code> Syntax</A>.

</P>
<P>
The list of messages is reset for each new statement that uses a table.

</P>
<P>
The <code>SHOW COUNT(*) WARNINGS</code> statement displays the total number of
errors, warnings, and notes. You can also retrieve this number from the
<code>warning_count</code> variable:

</P>

<PRE>
SHOW COUNT(*) WARNINGS;
SELECT @@warning_count;
</PRE>

<P>
The value of <code>warning_count</code> might be greater than the number of
messages displayed by <code>SHOW WARNINGS</code> if the <code>max_error_count</code>
system variable is set low enough that not all messages are stored. An
example shown later in this section demonstrates how this can happen.

</P>
<P>
The <code>LIMIT</code> clause has the same syntax as for the <code>SELECT</code>
statement.
See section <A HREF="manual.html#SELECT">14.1.7  <code>SELECT</code> Syntax</A>.

</P>
<P>
The MySQL server sends back the total number of errors, warnings, and
notes resulting from the last statement.
If you are using the C API, this value can be obtained by calling
<code>mysql_warning_count()</code>.
See section <A HREF="manual.html#mysql_warning_count">21.2.3.58  <code>mysql_warning_count()</code></A>.

</P>
<P>
Note that the framework for warnings was added in MySQL 4.1.0, at which
point many statements did not generate warnings.  In 4.1.1, the situation is
much improved, with warnings generated for statements such as <code>LOAD
DATA INFILE</code> and DML statements such as <code>INSERT</code>, <code>UPDATE</code>,
<code>CREATE TABLE</code>, and <code>ALTER TABLE</code>.

</P>
<P>
The following <code>DROP TABLE</code> statement results in a note:

</P>

<PRE>
mysql&#62; DROP TABLE IF EXISTS no_such_table;
mysql&#62; SHOW WARNINGS;
+-------+------+-------------------------------+
| Level | Code | Message                       |
+-------+------+-------------------------------+
| Note  | 1051 | Unknown table 'no_such_table' |
+-------+------+-------------------------------+
</PRE>

<P>
Here is a simple example that shows a syntax warning for <code>CREATE TABLE</code>
and conversion warnings for <code>INSERT</code>:

</P>

<PRE>
mysql&#62; CREATE TABLE t1 (a TINYINT NOT NULL, b CHAR(4)) TYPE=MyISAM;
Query OK, 0 rows affected, 1 warning (0.00 sec)
mysql&#62; SHOW WARNINGS\G
*************************** 1. row ***************************
  Level: Warning
   Code: 1287
Message: 'TYPE=storage_engine' is deprecated, use
         'ENGINE=storage_engine' instead
1 row in set (0.00 sec)

mysql&#62; INSERT INTO t1 VALUES(10,'mysql'),(NULL,'test'),
    -&#62; (300,'open source');
Query OK, 3 rows affected, 4 warnings (0.01 sec)
Records: 3  Duplicates: 0  Warnings: 4

mysql&#62; SHOW WARNINGS\G
*************************** 1. row ***************************
  Level: Warning
   Code: 1265
Message: Data truncated for column 'b' at row 1
*************************** 2. row ***************************
  Level: Warning
   Code: 1263
Message: Data truncated, NULL supplied to NOT NULL column 'a' at row 2
*************************** 3. row ***************************
  Level: Warning
   Code: 1264
Message: Data truncated, out of range for column 'a' at row 3
*************************** 4. row ***************************
  Level: Warning
   Code: 1265
Message: Data truncated for column 'b' at row 3
4 rows in set (0.00 sec)
</PRE>

<P>
The maximum number of error, warning, and note messages to store is controlled
by the <code>max_error_count</code> system variable.  By default, its value is 64.
To change the number of messages you want stored, change the value of
<code>max_error_count</code>.
In the following example, the <code>ALTER TABLE</code> statement produces three
warning messages, but only one is stored because <code>max_error_count</code>
has been set to <code>1</code>:

</P>

<PRE>
mysql&#62; SHOW VARIABLES LIKE 'max_error_count';
+-----------------+-------+
| Variable_name   | Value |
+-----------------+-------+
| max_error_count | 64    |
+-----------------+-------+
1 row in set (0.00 sec)

mysql&#62; SET max_error_count=1;
Query OK, 0 rows affected (0.00 sec)

mysql&#62; ALTER TABLE t1 MODIFY b CHAR;
Query OK, 3 rows affected, 3 warnings (0.00 sec)
Records: 3  Duplicates: 0  Warnings: 3

mysql&#62; SELECT @@warning_count;
+-----------------+
| @@warning_count |
+-----------------+
|               3 |
+-----------------+
1 row in set (0.01 sec)

mysql&#62; SHOW WARNINGS;
+---------+------+----------------------------------------+
| Level   | Code | Message                                |
+---------+------+----------------------------------------+
| Warning | 1263 | Data truncated for column 'b' at row 1 |
+---------+------+----------------------------------------+
1 row in set (0.00 sec)
</PRE>

<P>
To disable warnings, set <code>max_error_count</code> to <code>0</code>. In this case,
<code>warning_count</code> still indicates how many warnings have occurred, but
none of the messages are stored.

</P>



<H3><A NAME="Other_administrative_SQL" HREF="manual_toc.html#Other_administrative_SQL">14.5.4  Other Administrative Statements</A></H3>



<H4><A NAME="CACHE_INDEX" HREF="manual_toc.html#CACHE_INDEX">14.5.4.1  <code>CACHE INDEX</code> Syntax</A></H4>

<P>
<A NAME="IDX1782"></A>

</P>
<P>
<A NAME="IDX1783"></A>
<A NAME="IDX1784"></A>

</P>

<PRE>
CACHE INDEX
  <var>tbl_index_list</var> [, <var>tbl_index_list</var>] ...
  IN <var>key_cache_name</var>

<var>tbl_index_list</var>:
  <var>tbl_name</var> [[INDEX|KEY] (<var>index_name</var>[, <var>index_name</var>] ...)]
</PRE>

<P>
The <code>CACHE INDEX</code> statement assigns table indexes to a specific key
cache. It is used only for <code>MyISAM</code> tables.

</P>
<P>
The following statement assigns indexes from the tables <code>t1</code>,
<code>t2</code>, and <code>t3</code> to the key cache named <code>hot_cache</code>:

</P>

<PRE>
mysql&#62; CACHE INDEX t1, t2, t3 IN hot_cache;
+---------+--------------------+----------+----------+
| Table   | Op                 | Msg_type | Msg_text |
+---------+--------------------+----------+----------+
| test.t1 | assign_to_keycache | status   | OK       |
| test.t2 | assign_to_keycache | status   | OK       |
| test.t3 | assign_to_keycache | status   | OK       |
+---------+--------------------+----------+----------+
</PRE>

<P>
The syntax of <code>CACHE INDEX</code> allows you to specify that only particular
indexes from a table should be assigned to the cache.  However, the current
implementation assigns all the table's indexes to the cache, so there is no
reason to specify anything other than the table name.

</P>
<P>
The key cache referred to in a <code>CACHE INDEX</code> statement can be created
by setting its size with a parameter setting statement or in the server
parameter settings. For example:

</P>

<PRE>
mysql&#62; SET GLOBAL keycache1.key_buffer_size=128*1024;
</PRE>

<P>
Key cache parameters can be accessed as members of a structured system
variable.
See section <A HREF="manual.html#Structured_System_Variables">10.4.1  Structured System Variables</A>.

</P>
<P>
A key cache must exist before you can assign indexes to it:

</P>

<PRE>
mysql&#62; CACHE INDEX t1 in non_existent_cache;
ERROR 1283 (HY000): Unknown key cache 'non_existent_cache'
</PRE>

<P>
By default, table indexes are assigned to the main (default) key cache
created at the server startup. When a key cache is destroyed, all
indexes assigned to it become assigned to the default key cache again.

</P>
<P>
Index assignment affects the server globally: If one client
assigns an index to a given cache, this cache is used for all queries
involving the index, no matter what client issues the queries.

</P>
<P>
<code>CACHE INDEX</code> was added in MySQL 4.1.1.

</P>



<H4><A NAME="FLUSH" HREF="manual_toc.html#FLUSH">14.5.4.2  <code>FLUSH</code> Syntax</A></H4>

<P>
<A NAME="IDX1785"></A>

</P>
<P>
<A NAME="IDX1786"></A>
<A NAME="IDX1787"></A>
<A NAME="IDX1788"></A>

</P>

<PRE>
FLUSH [LOCAL | NO_WRITE_TO_BINLOG] <var>flush_option</var> [, <var>flush_option</var>] ...
</PRE>

<P>
You should use the <code>FLUSH</code> statement if you want to clear some of the
internal caches MySQL uses.  To execute <code>FLUSH</code>, you must have
the <code>RELOAD</code> privilege.

</P>
<P>
<var>flush_option</var> can be any of the following:

</P>
<DL COMPACT>

<DT><code>HOSTS</code>
<DD>
Empties the host cache tables.  You should flush the
host tables if some of your hosts change IP number or if you get the
error message <code>Host ... is blocked</code>.  When more than
<code>max_connect_errors</code> errors occur successively for a given host while
connecting to the MySQL server, MySQL assumes that
something is wrong and blocks the host from further connection requests.
Flushing the host tables allows the host to attempt to connect
again. See section <A HREF="manual.html#Blocked_host">A.2.5  <code>Host '<var>host_name</code>' is blocked</var></A>. You can start <code>mysqld</code> with
<code>--max_connect_errors=999999999</code> to avoid this error message.

<DT><code>DES_KEY_FILE</code>
<DD>
Reloads the DES keys from the file that was
specified with the <code>--des-key-file</code> option at server startup time.

<DT><code>LOGS</code>
<DD>
Closes and reopens all log files.
If you have specified an update log file or a binary log file without
an extension, the extension number of the log file will be incremented
by one relative to the previous file. If you have used an extension in
the file name, MySQL will close and reopen the update log or binary log file.
See section <A HREF="manual.html#Update_log">5.8.3  The Update Log</A>. On Unix, this is the same thing as sending a <code>SIGHUP</code>
signal to the <code>mysqld</code> server.

<DT><code>PRIVILEGES</code>
<DD>
Reloads the privileges from the grant tables in
the <code>mysql</code> database.

<DT><code>QUERY CACHE</code>
<DD>
Defragment the query cache to better utilize its
memory.  This statement does not remove any queries from the cache, unlike
<code>RESET QUERY CACHE</code>.

<DT><code>STATUS</code>
<DD>
Resets most status variables to zero. This is something you should use only when debugging a query. See section <A HREF="manual.html#Bug_reports">1.7.1.3  How to Report Bugs or Problems</A>.

<DT><code>{TABLE | TABLES} [<var>tbl_name</var> [, <var>tbl_name</var>] ...]</code>
<DD>
When no tables are named, closes all open tables and forces all tables in use to be closed. This also flushes the query cache.  With one or more table names, flushes only the given tables.
<code>FLUSH TABLES</code> also removes all query results from the query cache, like
the <code>RESET QUERY CACHE</code> statement.

<DT><code>TABLES WITH READ LOCK</code>
<DD>
Closes all open tables and locks all
tables for all databases with a read lock until you execute <code>UNLOCK
TABLES</code>. This is very convenient way to get backups if you have a filesystem
such as Veritas that can take snapshots in time.

<DT><code>USER_RESOURCES</code>
<DD>
Resets all user resources to zero. This
enables clients that have reached their hourly connection, query, or update
limits to resume activity.
See section <A HREF="manual.html#GRANT">14.5.1.2  <code>GRANT</code> and <code>REVOKE</code> Syntax</A>.

</DL>

<P>
Before MySQL 4.1.1, <code>FLUSH</code> statements are not written to the binary
log. As of MySQL 4.1.1, they are written to the binary log unless the
optional <code>NO_WRITE_TO_BINLOG</code> keyword (or its alias <code>LOCAL</code>) is
used.  Exceptions are that <code>FLUSH LOGS</code>, <code>FLUSH MASTER</code>,
<code>FLUSH SLAVE</code>, and <code>FLUSH TABLES WITH READ LOCK</code> are not logged in
any case because they would cause problems if replicated to a slave.

</P>
<P>
You can also access some of these statements with the <code>mysqladmin</code>
utility, using the <code>flush-hosts</code>, <code>flush-logs</code>, <code>flush-privileges</code>,
<code>flush-status</code>, or <code>flush-tables</code> commands.

</P>
<P>
Take also a look at the <code>RESET</code> statement used with replication.
See section <A HREF="manual.html#RESET">14.5.4.5  <code>RESET</code> Syntax</A>.

</P>



<H4><A NAME="KILL" HREF="manual_toc.html#KILL">14.5.4.3  <code>KILL</code> Syntax</A></H4>

<P>
<A NAME="IDX1789"></A>

</P>
<P>
<A NAME="IDX1790"></A>

</P>

<PRE>
KILL [CONNECTION | QUERY] <var>thread_id</var>
</PRE>

<P>
Each connection to <code>mysqld</code> runs in a separate thread.  You can see
which threads are running with the <code>SHOW PROCESSLIST</code> statement and kill
a thread with the <code>KILL thread_id</code> statement.

</P>
<P>
As of MySQL 5.0.0, <code>KILL</code> allows the optional <code>CONNECTION</code> or
<code>QUERY</code> modifiers:

</P>

<UL>

<LI>

<code>KILL CONNECTION</code> is the same as <code>KILL</code> with no modifier:
It terminates the connection associated with the given <var>thread_id</var>.

<LI>

<code>KILL QUERY</code> terminates the statement that the connection currently
is executing, but leaves the connection intact.

</UL>

<P>
If you have the <code>PROCESS</code> privilege, you can see all threads.
If you have the <code>SUPER</code> privilege, you can kill all threads and
statements.  Otherwise, you can see and kill only your own threads and
statements.

</P>
<P>
You can also use the <code>mysqladmin processlist</code> and <code>mysqladmin kill</code>
commands to examine and kill threads.

</P>
<P>
<strong>Note</strong>: You currently cannot use <code>KILL</code> with the Embedded MySQL
Server library, because the embedded server merely runs inside the threads
of the host application, it does not create connection threads of its own.

</P>
<P>
When you do a <code>KILL</code>, a thread-specific kill flag is set for
the thread.
In most cases, it might take some time for the thread to die, because the kill
flag is checked only at specific intervals:

</P>

<UL>
<LI>

In <code>SELECT</code>, <code>ORDER BY</code> and <code>GROUP BY</code> loops, the flag is
checked after reading a block of rows. If the kill flag is set, the
statement is aborted.
<LI>

During <code>ALTER TABLE</code>, the kill flag is checked before each block of
rows are read from the original table. If the kill flag was set, the statement
is aborted and the temporary table is deleted.
<LI>

During <code>UPDATE</code> or <code>DELETE</code>, the kill flag
is checked after each block read and after each updated or deleted
row. If the kill flag is set, the statement is aborted.  Note that if you
are not using transactions, the changes will not be rolled back!
<LI>

<code>GET_LOCK()</code> will abort and return <code>NULL</code>.
<LI>

An <code>INSERT DELAYED</code> thread will quickly flush all rows it has in
memory and terminate.
<LI>

If the thread is in the table lock handler (state: <code>Locked</code>),
the table lock will be quickly aborted.
<LI>

If the thread is waiting for free disk space in a write call, the
write is aborted with a "disk full" error message.
</UL>



<H4><A NAME="LOAD_INDEX" HREF="manual_toc.html#LOAD_INDEX">14.5.4.4  <code>LOAD INDEX INTO CACHE</code> Syntax</A></H4>


<PRE>
LOAD INDEX INTO CACHE
  <var>tbl_index_list</var> [, <var>tbl_index_list</var>] ...

<var>tbl_index_list</var>:
  <var>tbl_name</var>
    [[INDEX|KEY] (<var>index_name</var>[, <var>index_name</var>] ...)]
    [IGNORE LEAVES]
</PRE>

<P>
The <code>LOAD INDEX INTO CACHE</code> statement preloads a table index into the
key cache to which it has been assigned by an explicit <code>CACHE INDEX</code>
statement, or into the default key cache otherwise.  <code>LOAD INDEX INTO
CACHE</code> is used only for <code>MyISAM</code> tables.

</P>
<P>
The <code>IGNORE LEAVES</code> modifier causes only blocks for the non-leaf
nodes of the index to be preloaded.

</P>
<P>
The following statement preloads nodes (index blocks) of indexes of the
tables <code>t1</code> and <code>t2</code>:

</P>

<PRE>
mysql&#62; LOAD INDEX INTO CACHE t1, t2 IGNORE LEAVES;
+---------+--------------+----------+----------+
| Table   | Op           | Msg_type | Msg_text |
+---------+--------------+----------+----------+
| test.t1 | preload_keys | status   | OK       |
| test.t2 | preload_keys | status   | OK       |
+---------+--------------+----------+----------+
</PRE>

<P>
This statement preloads all index blocks from <code>t1</code>. It preloads only
blocks for the non-leaf nodes from <code>t2</code>.

</P>
<P>
The syntax of <code>LOAD INDEX INTO CACHE</code> allows you to specify that only
particular indexes from a table should be preloaded.  However, the current
implementation preloads all the table's indexes into the cache, so there is
no reason to specify anything other than the table name.

</P>
<P>
<code>LOAD INDEX INTO CACHE</code> was added in MySQL 4.1.1.

</P>



<H4><A NAME="RESET" HREF="manual_toc.html#RESET">14.5.4.5  <code>RESET</code> Syntax</A></H4>


<PRE>
RESET <var>reset_option</var> [, <var>reset_option</var>] ...
</PRE>

<P>
The <code>RESET</code> statement is used to clear the state of various server
operations. It also acts as a stronger
version of the <code>FLUSH</code> statement.  See section <A HREF="manual.html#FLUSH">14.5.4.2  <code>FLUSH</code> Syntax</A>.

</P>
<P>
To execute <code>RESET</code>, you must have the <code>RELOAD</code> privilege.

</P>
<P>
<var>reset_option</var> can be any of the following:

</P>
<DL COMPACT>

<DT><code>MASTER</code>
<DD>
Deletes all binary logs listed in the index file, resets the binary log
index file to be empty, and creates a new binary log file. Previously named
<code>FLUSH MASTER</code>.
See section <A HREF="manual.html#Replication_Master_SQL">14.6.1  SQL Statements for Controlling Master Servers</A>.

<DT><code>QUERY CACHE</code>
<DD>
Removes all query results from the query cache.

<DT><code>SLAVE</code>
<DD>
Makes the slave forget its replication position in the master
binary logs.  Previously named <code>FLUSH SLAVE</code>.
See section <A HREF="manual.html#Replication_Slave_SQL">14.6.2  SQL Statements for Controlling Slave Servers</A>.

</DL>



<H2><A NAME="Replication_SQL" HREF="manual_toc.html#Replication_SQL">14.6  Replication Statements</A></H2>

<P>
This section describes replication-related SQL statements.
One group of statements is used for controlling master servers.
The other is used for controlling slave servers.

</P>



<H3><A NAME="Replication_Master_SQL" HREF="manual_toc.html#Replication_Master_SQL">14.6.1  SQL Statements for Controlling Master Servers</A></H3>

<P>
<A NAME="IDX1791"></A>
<A NAME="IDX1792"></A>
<A NAME="IDX1793"></A>

</P>
<P>
Replication can be controlled through the SQL interface. This section
discusses statements for managing master replication servers.
section <A HREF="manual.html#Replication_Slave_SQL">14.6.2  SQL Statements for Controlling Slave Servers</A> discusses statements for managing slave servers.

</P>



<H4><A NAME="PURGE_MASTER_LOGS" HREF="manual_toc.html#PURGE_MASTER_LOGS">14.6.1.1  <code>PURGE MASTER LOGS</code> Syntax</A></H4>

<P>
<A NAME="IDX1794"></A>

</P>

<PRE>
PURGE {MASTER | BINARY} LOGS TO '<var>log_name</var>'
PURGE {MASTER | BINARY} LOGS BEFORE '<var>date</var>'
</PRE>

<P>
Deletes all the binary logs listed in the log
index that are strictly prior to the specified log or date.
The logs also are removed from the list recorded in the log index file,
so that the given log becomes the first. 

</P>
<P>
Example:

</P>

<PRE>
PURGE MASTER LOGS TO 'mysql-bin.010';
PURGE MASTER LOGS BEFORE '2003-04-02 22:46:26';
</PRE>

<P>
The <code>BEFORE</code> variant is available as of MySQL 4.1. Its date argument
can be in <code>'YYYY-MM-DD hh:mm:ss'</code> format.
<code>MASTER</code> and <code>BINARY</code> are synonyms, but <code>BINARY</code> can be used
only as of MySQL 4.1.1.

</P>
<P>
If you have an active slave that currently is reading one of the logs you
are trying to delete, this statement does nothing and fails with an error.
However, if a slave is dormant and you happen to purge one of
the logs it wants to read, the slave will be unable to replicate once it
comes up.  The statement is safe to run while slaves are replicating. You
do not need to stop them.

</P>
<P>
To purge logs, follow this procedure:

</P>

<OL>
<LI>

On each slave server, use <code>SHOW SLAVE STATUS</code> to check which log it is
reading.
<LI>

Obtain a listing of the logs on the master server with <code>SHOW MASTER LOGS</code>.
<LI>

Determine the earliest log among all the slaves. This is the target log.
If all the slaves are up to date, this will be the last log on the list.
<LI>

Make a backup of all the logs you are about to delete.  (The step is optional,
but a good idea.)
<LI>

Purge all logs up to but not including the target log.
</OL>



<H4><A NAME="RESET_MASTER" HREF="manual_toc.html#RESET_MASTER">14.6.1.2  <code>RESET MASTER</code> Syntax</A></H4>

<P>
<A NAME="IDX1795"></A>

</P>

<PRE>
RESET MASTER
</PRE>

<P>
Deletes all binary logs listed in the index file,
resets the binary log index file to be empty, and creates a new binary log
file.

</P>
<P>
This statement was named <code>FLUSH MASTER</code> before MySQL 3.23.26.

</P>



<H4><A NAME="SET_SQL_LOG_BIN" HREF="manual_toc.html#SET_SQL_LOG_BIN">14.6.1.3  <code>SET SQL_LOG_BIN</code> Syntax</A></H4>

<P>
<A NAME="IDX1796"></A>

</P>

<PRE>
SET SQL_LOG_BIN = {0|1}
</PRE>

<P>
Disables or enables binary logging for the current connection 
(<code>SQL_LOG_BIN</code> is a session variable)
if the client connects using an account that has the <code>SUPER</code> privilege.
The statement is refused with an error if the client does not have that
privilege. (Before MySQL 4.1.2, the statement was simply ignored in that case.)

</P>



<H4><A NAME="SHOW_BINLOG_EVENTS" HREF="manual_toc.html#SHOW_BINLOG_EVENTS">14.6.1.4  <code>SHOW BINLOG EVENTS</code> Syntax</A></H4>

<P>
<A NAME="IDX1797"></A>

</P>

<PRE>
SHOW BINLOG EVENTS
   [IN '<var>log_name</var>'] [FROM <var>pos</var>] [LIMIT [<var>offset</var>,] <var>row_count</var>]
</PRE>

<P>
Shows the events in the binary log. 
If you do not specify <code>'log_name'</code>, the first binary log will be displayed.

</P>
<P>
The <code>LIMIT</code> clause has the same syntax as for the <code>SELECT</code>
statement.
See section <A HREF="manual.html#SELECT">14.1.7  <code>SELECT</code> Syntax</A>.

</P>
<P>
This statement is available as of MySQL 4.0.

</P>



<H4><A NAME="SHOW_MASTER_LOGS" HREF="manual_toc.html#SHOW_MASTER_LOGS">14.6.1.5  <code>SHOW MASTER LOGS</code> Syntax</A></H4>

<P>
<A NAME="IDX1798"></A>

</P>

<PRE>
SHOW MASTER LOGS
</PRE>

<P>
Lists the binary log files on the master. This statement is used as part of
the procedure described in section <A HREF="manual.html#PURGE_MASTER_LOGS">14.6.1.1  <code>PURGE MASTER LOGS</code> Syntax</A> for determining which logs
can be purged.

</P>



<H4><A NAME="SHOW_MASTER_STATUS" HREF="manual_toc.html#SHOW_MASTER_STATUS">14.6.1.6  <code>SHOW MASTER STATUS</code> Syntax</A></H4>

<P>
<A NAME="IDX1799"></A>

</P>

<PRE>
SHOW MASTER STATUS
</PRE>

<P>
Provides status information on the binary log files of the master.

</P>



<H4><A NAME="SHOW_SLAVE_HOSTS" HREF="manual_toc.html#SHOW_SLAVE_HOSTS">14.6.1.7  <code>SHOW SLAVE HOSTS</code> Syntax</A></H4>

<P>
<A NAME="IDX1800"></A>

</P>

<PRE>
SHOW SLAVE HOSTS
</PRE>

<P>
Displays a list of slaves currently registered with the master. 
Any slave not started with the <code>--report-host=slave_name</code> 
option will not be visible in that list.

</P>



<H3><A NAME="Replication_Slave_SQL" HREF="manual_toc.html#Replication_Slave_SQL">14.6.2  SQL Statements for Controlling Slave Servers</A></H3>

<P>
<A NAME="IDX1801"></A>
<A NAME="IDX1802"></A>
<A NAME="IDX1803"></A>

</P>
<P>
Replication can be controlled through the SQL interface. This section
discusses statements for managing slave replication servers.
section <A HREF="manual.html#Replication_Master_SQL">14.6.1  SQL Statements for Controlling Master Servers</A> discusses statements for managing master servers.

</P>



<H4><A NAME="CHANGE_MASTER_TO" HREF="manual_toc.html#CHANGE_MASTER_TO">14.6.2.1  <code>CHANGE MASTER TO</code> Syntax</A></H4>

<P>
<A NAME="IDX1804"></A>

</P>


<PRE>
CHANGE MASTER TO master_def [, master_def] ...

master_def:
      MASTER_HOST = '<var>host_name</var>'
    | MASTER_USER = '<var>user_name</var>'
    | MASTER_PASSWORD = '<var>password</var>'
    | MASTER_PORT = <var>port_num</var>
    | MASTER_CONNECT_RETRY = <var>count</var>
    | MASTER_LOG_FILE = '<var>master_log_name</var>'
    | MASTER_LOG_POS = <var>master_log_pos</var>
    | RELAY_LOG_FILE = '<var>relay_log_name</var>'
    | RELAY_LOG_POS = <var>relay_log_pos</var>
    | MASTER_SSL = {0|1}
    | MASTER_SSL_CA = '<var>ca_file_name</var>'
    | MASTER_SSL_CAPATH = '<var>ca_directory_name</var>'
    | MASTER_SSL_CERT = '<var>cert_file_name</var>'
    | MASTER_SSL_KEY = '<var>key_file_name</var>'
    | MASTER_SSL_CIPHER = '<var>cipher_list</var>'
</PRE>

<P>
Changes the parameters that the slave server uses for connecting to and
communicating with the master server.

</P>
<P>
<code>MASTER_USER</code>, <code>MASTER_PASSWORD</code>, <code>MASTER_SSL</code>,
<code>MASTER_SSL_CA</code>, <code>MASTER_SSL_CAPATH</code>, <code>MASTER_SSL_CERT</code>,
<code>MASTER_SSL_KEY</code>, and <code>MASTER_SSL_CIPHER</code> provide information for
the slave about how to connect to its master.

</P>
<P>
The relay log options (<code>RELAY_LOG_FILE</code> and <code>RELAY_LOG_POS</code>) are
available beginning with MySQL 4.0.

</P>
<P>
The SSL options
(<code>MASTER_SSL</code>,
<code>MASTER_SSL_CA</code>,
<code>MASTER_SSL_CAPATH</code>,
<code>MASTER_SSL_CERT</code>,
<code>MASTER_SSL_KEY</code>,
and
<code>MASTER_SSL_CIPHER</code>)
are available beginning with MySQL 4.1.1.
You can change these options even on slaves that are compiled without SSL
support. They are saved to the <tt>`master.info'</tt> file, but is ignored
until you use a server that has SSL support enabled.

</P>
<P>
If you don't specify a given parameter, it keeps its old
value, except as indicated in the following discussion. For example, if the password to connect to your MySQL master has
changed, you just need to issue these statements
to tell the slave about the new password:

</P>

<PRE>
mysql&#62; STOP SLAVE; -- if replication was running
mysql&#62; CHANGE MASTER TO MASTER_PASSWORD='new3cret';
mysql&#62; START SLAVE; -- if you want to restart replication
</PRE>

<P>
There is no need to specify the parameters that do
not change (host, port, user, and so forth).

</P>
<P>
<code>MASTER_HOST</code> and <code>MASTER_PORT</code> are the hostname (or IP address) of
the master host and its TCP/IP port. Note that if <code>MASTER_HOST</code> is
equal to <code>localhost</code>, then, like in other parts of MySQL, the port
may be ignored (if Unix socket files can be used, for example).

</P>
<P>
If you specify <code>MASTER_HOST</code> or <code>MASTER_PORT</code>,
the slave assumes that the master server is different than
before (even if you specify a host or port value that is
the same as the current value.) In this case, the old values for the master
binary log name and position are considered no longer applicable, so if you
do not specify <code>MASTER_LOG_FILE</code> and <code>MASTER_LOG_POS</code> in the
statement, <code>MASTER_LOG_FILE=''</code> and <code>MASTER_LOG_POS=4</code> are
silently appended to it. 

</P>
<P>
<code>MASTER_LOG_FILE</code> and <code>MASTER_LOG_POS</code> are the coordinates
at which the slave I/O thread should begin reading from the master the
next time the thread starts.
If you specify either of them, you can't specify <code>RELAY_LOG_FILE</code> or
<code>RELAY_LOG_POS</code>.
If neither of <code>MASTER_LOG_FILE</code> or <code>MASTER_LOG_POS</code> are
specified, the slave uses the last coordinates of the <em>slave SQL thread</em>
before <code>CHANGE MASTER</code> was issued. This ensures that
replication has no discontinuity, even if the slave SQL thread was late
compared to the slave I/O thread, when you just want to change, say, the
password to use. This safe behavior was introduced starting from MySQL
4.0.17 and 4.1.1. (Before these versions, the coordinates used were 
the last coordinates of the slave I/O thread before <code>CHANGE MASTER</code>
was issued. This caused the SQL thread to possibly lose some events
from the master, thus breaking replication.)

</P>
<P>
<code>CHANGE MASTER</code> <em>deletes all relay log files</em> and starts
a new one, unless you specify <code>RELAY_LOG_FILE</code> or
<code>RELAY_LOG_POS</code>. In that case, relay logs are kept;
as of MySQL 4.1.1 the <code>relay_log_purge</code> global variable
is set silently to 0.

</P>
<P>
<code>CHANGE MASTER TO</code> updates the contents of the <tt>`master.info'</tt> and
<tt>`relay-log.info'</tt> files.

</P>
<P>
<code>CHANGE MASTER</code> is useful for setting up a slave when you have
the snapshot of the master and have recorded the log and the offset
corresponding to it.  After loading the snapshot into the slave, you
can run <code>CHANGE MASTER TO MASTER_LOG_FILE='<var>log_name_on_master</var>',
MASTER_LOG_POS=<var>log_offset_on_master</var></code> on the slave.

</P>
<P>
Examples:

</P>

<PRE>
mysql&#62; CHANGE MASTER TO
    -&#62;     MASTER_HOST='master2.mycompany.com',
    -&#62;     MASTER_USER='replication',
    -&#62;     MASTER_PASSWORD='bigs3cret',
    -&#62;     MASTER_PORT=3306,
    -&#62;     MASTER_LOG_FILE='master2-bin.001',
    -&#62;     MASTER_LOG_POS=4,
    -&#62;     MASTER_CONNECT_RETRY=10;

mysql&#62; CHANGE MASTER TO
    -&#62;     RELAY_LOG_FILE='slave-relay-bin.006',
    -&#62;     RELAY_LOG_POS=4025;
</PRE>

<P>
The first example changes the master and master's binary log
coordinates. This is used when you want to set up the slave to replicate
the master.

</P>
<P>
The second example shows an operation that is less frequently used. It
is done when the slave has relay logs that you want it to execute again
for some reason.  To do this, the master need not be reachable. You just
have to use <code>CHANGE MASTER TO</code> and start the SQL thread (<code>START
SLAVE SQL_THREAD</code>).

</P>
<P>
You can even use the second operation in a non-replication setup with a
standalone, non-slave server, to recover after a crash.  Suppose that your
server has crashed and you have restored a backup.  You want to replay
the server's own binary logs (not relay logs, but regular binary logs),
supposedly named <tt>`myhost-bin.*'</tt>. First, make a backup copy of these
binary logs in some safe place, in case you don't exactly follow the
procedure below and accidentally have the server purge the binary logs.
If using MySQL 4.1.1 or newer, use <code>SET GLOBAL relay_log_purge=0</code> for
additional safety.  Then start the server without the <code>--log-bin</code>
option. Before MySQL 4.0.19, start it with a new (different from before) server
id; in newer versions there is no need, just use the
<code>--replicate-same-server-id</code> option. Start it with
<code>--relay-log=myhost-bin</code> (to make the server believe that these
regular binary logs are relay logs) and with <code>--skip-slave-start</code>. After
the server starts, issue these statements:

</P>

<PRE>
mysql&#62; CHANGE MASTER TO
    -&#62;     RELAY_LOG_FILE='myhost-bin.153',
    -&#62;     RELAY_LOG_POS=410,
    -&#62;     MASTER_HOST='some_dummy_string';
mysql&#62; START SLAVE SQL_THREAD;
</PRE>

<P>
The server will read and execute its own binary logs, thus achieving
crash recovery.  Once the recovery is finished, run <code>STOP SLAVE</code>,
shut down the server, delete <tt>`master.info'</tt> and <tt>`relay-log.info'</tt>,
and restart the server with its original options.

</P>
<P>
For the moment, specifying <code>MASTER_HOST</code> (even with a dummy value) is
required to make the server think it is a slave. In the future, we plan to add
options to get rid of these small constraints.

</P>



<H4><A NAME="LOAD_DATA_FROM_MASTER" HREF="manual_toc.html#LOAD_DATA_FROM_MASTER">14.6.2.2  <code>LOAD DATA FROM MASTER</code> Syntax</A></H4>

<P>
<A NAME="IDX1805"></A>

</P>

<PRE>
LOAD DATA FROM MASTER
</PRE>

<P>
Takes a snapshot of the master and copies it to the slave.  It updates the
values of <code>MASTER_LOG_FILE</code> and <code>MASTER_LOG_POS</code> so that the slave
will start replicating from the correct position. Any table and database
exclusion rules specified with the <code>--replicate-*-do-*</code> and
<code>--replicate-*-ignore-*</code> options are honored.
<code>--replicate-rewrite-db</code> is <em>not</em> taken into account (because one user
could, with this option, set up a non-unique mapping such as
<code>--replicate-rewrite-db=db1-&#62;db3</code> and
<code>--replicate-rewrite-db=db2-&#62;db3</code>, which would confuse the slave when
it loads the master's tables).

</P>
<P>
Use of this statement is subject to the following conditions:

</P>

<UL>

<LI>

It works only with <code>MyISAM</code> tables.

<LI>

It acquires a global read lock on the master while taking the snapshot,
which prevents updates on the master during the load operation.

</UL>

<P>
In the future, it is planned to make this statement work with
<code>InnoDB</code> tables and to remove the need for a global read lock by using
non-blocking online backup.

</P>
<P>
If you are loading big tables, you might have to increase the values
of <code>net_read_timeout</code> and <code>net_write_timeout</code>
on both your master and slave servers.
See section <A HREF="manual.html#Server_system_variables">5.2.3  Server System Variables</A>.

</P>
<P>
Note that <code>LOAD DATA FROM MASTER</code> does <em>not</em> copy any
tables from the <code>mysql</code> database.  This makes it easy to have
different users and privileges on the master and the slave.

</P>
<P>
The <code>LOAD DATA FROM MASTER</code> statement
requires the replication account that is used to connect to the master
to have the <code>RELOAD</code> and <code>SUPER</code> privileges on the master and the
<code>SELECT</code> privilege for all master tables you want to load. All
master tables for which the user does not have the <code>SELECT</code> privilege are
ignored by <code>LOAD DATA FROM MASTER</code>. This is because the
master will hide them from the user: <code>LOAD DATA FROM MASTER</code> calls
<code>SHOW DATABASES</code> to know the master databases to load, but
<code>SHOW DATABASES</code> returns only databases for which the user has
some privilege.
See section <A HREF="manual.html#Show_database_info">14.5.3.7  <code>SHOW DATABASES</code> Syntax</A>.
On the slave's side, the user that issues <code>LOAD DATA FROM MASTER</code> should
have grants to drop and create the databases and tables that are copied.

</P>



<H4><A NAME="LOAD_TABLE_FROM_MASTER" HREF="manual_toc.html#LOAD_TABLE_FROM_MASTER">14.6.2.3  <code>LOAD TABLE <var>tbl_name</var> FROM MASTER</code> Syntax</A></H4>

<P>
<A NAME="IDX1806"></A>

</P>

<PRE>
LOAD TABLE <var>tbl_name</var> FROM MASTER
</PRE>

<P>
Transfers a copy of the table from master to the slave. This statement is
implemented mainly for debugging of <code>LOAD DATA FROM MASTER</code>.
It requires that the account used for connecting to the master server has the
<code>RELOAD</code> and <code>SUPER</code> privileges on the master and the
<code>SELECT</code> privilege on the master table to load.
On the slave side, the user that issues <code>LOAD TABLE FROM MASTER</code> should
have privileges to drop and create the table.

</P>
<P>
The conditions for <code>LOAD DATA FROM MASTER</code> apply here, too. For
example, <code>LOAD TABLE FROM MASTER</code> works only for <code>MyISAM</code> tables.
The timeout notes for <code>LOAD DATA FROM MASTER</code> apply as well.

</P>



<H4><A NAME="MASTER_POS_WAIT" HREF="manual_toc.html#MASTER_POS_WAIT">14.6.2.4  <code>MASTER_POS_WAIT()</code> Syntax</A></H4>

<P>
<A NAME="IDX1807"></A>

</P>

<PRE>
SELECT MASTER_POS_WAIT('<var>master_log_file</var>', <var>master_log_pos</var>)
</PRE>

<P>
This is a function, not a statement. It is used to ensure that the slave
has read and executed events up to a given position in the master's binary log.
See section <A HREF="manual.html#Miscellaneous_functions">13.8.4  Miscellaneous Functions</A> for a full description.

</P>



<H4><A NAME="RESET_SLAVE" HREF="manual_toc.html#RESET_SLAVE">14.6.2.5  <code>RESET SLAVE</code> Syntax</A></H4>

<P>
<A NAME="IDX1808"></A>

</P>

<PRE>
RESET SLAVE
</PRE>

<P>
Makes the slave forget its replication position in the master's binary logs.
This statement is meant to be used for a clean start: It deletes the
<tt>`master.info'</tt> and <tt>`relay-log.info'</tt> files, all the relay logs,
and starts a new relay log.

</P>
<P>
<strong>Note</strong>: All relay logs are deleted, even if they have not been
totally executed by the slave SQL thread.  (This is a condition likely to
exist on a replication slave if you have issued a <code>STOP SLAVE</code>
statement or if the slave is highly loaded.)

</P>
<P>
Connection information stored in the <tt>`master.info'</tt> file is immediately
reset using any values specified in the corresponding startup options.
This information includes values such as master host, master port, master
user, and master password.  If the slave SQL thread was in the middle of
replicating temporary tables when it was stopped, and <code>RESET SLAVE</code>
is issued, these replicated temporary tables are deleted on the slave.

</P>
<P>
This statement was named <code>FLUSH SLAVE</code> before MySQL 3.23.26.

</P>



<H4><A NAME="SET_GLOBAL_SQL_SLAVE_SKIP_COUNTER" HREF="manual_toc.html#SET_GLOBAL_SQL_SLAVE_SKIP_COUNTER">14.6.2.6  <code>SET GLOBAL SQL_SLAVE_SKIP_COUNTER</code> Syntax</A></H4>

<P>
<A NAME="IDX1809"></A>

</P>

<PRE>
SET GLOBAL SQL_SLAVE_SKIP_COUNTER = <var>n</var>
</PRE>

<P>
Skip the next <var>n</var> events from the master. This is
useful for recovering from replication stops caused by a statement.

</P>
<P>
This statement is valid only when the slave thread is not running.
Otherwise, it produces an error.

</P>
<P>
Before MySQL 4.0, omit the <code>GLOBAL</code> keyword from the statement.

</P>



<H4><A NAME="SHOW_SLAVE_STATUS" HREF="manual_toc.html#SHOW_SLAVE_STATUS">14.6.2.7  <code>SHOW SLAVE STATUS</code> Syntax</A></H4>

<P>
<A NAME="IDX1810"></A>

</P>

<PRE>
SHOW SLAVE STATUS
</PRE>

<P>
Provides status information on
essential parameters of the slave threads. If you issue this statement using
the
<code>mysql</code> client, you can use a <code>\G</code> statement terminator rather than
semicolon to get a more readable vertical layout:

</P>

<PRE>
mysql&#62; SHOW SLAVE STATUS\G
*************************** 1. row ***************************
       Slave_IO_State: Waiting for master to send event
          Master_Host: localhost
          Master_User: root
          Master_Port: 3306
        Connect_Retry: 3
      Master_Log_File: gbichot-bin.005
  Read_Master_Log_Pos: 79
       Relay_Log_File: gbichot-relay-bin.005
        Relay_Log_Pos: 548
Relay_Master_Log_File: gbichot-bin.005
     Slave_IO_Running: Yes
    Slave_SQL_Running: Yes
      Replicate_Do_DB:
  Replicate_Ignore_DB:
           Last_Errno: 0
           Last_Error:
         Skip_Counter: 0
  Exec_Master_Log_Pos: 79
      Relay_Log_Space: 552
      Until_Condition: None
       Until_Log_File:
        Until_Log_Pos: 0
   Master_SSL_Allowed: No
   Master_SSL_CA_File:
   Master_SSL_CA_Path:
      Master_SSL_Cert:
    Master_SSL_Cipher:
       Master_SSL_Key:
Seconds_Behind_Master: 8
</PRE>

<P>
Depending on your version of MySQL, you may not see all the fields just
shown. In particular, several fields are present only as of MySQL 4.1.1.

</P>
<P>
<code>SHOW SLAVE STATUS</code> returns the following fields:

</P>
<DL COMPACT>

<DT><code>Slave_IO_State</code>
<DD>
A copy of the <code>State</code> field of
the output of <code>SHOW PROCESSLIST</code> for the slave I/O thread. This
tells you if the thread is trying to connect to the master, waiting
for events from the master, reconnecting to the master, and so on. Possible
states are listed in section <A HREF="manual.html#Replication_Implementation_Details">6.3  Replication Implementation Details</A>. Looking at
this field is necessary because, for example, the thread can be running
but unsuccessfully trying to connect to the master; only this field
will make you aware of the connection problem.
The state of the SQL thread is not copied because it is simpler.
If it is running, there is no
problem; if it is not, you will find the error in the
<code>Last_Error</code> field (described below). 

This field is present beginning with MySQL 4.1.1.

<DT><code>Master_Host</code>
<DD>
The current master host.

<DT><code>Master_User</code>
<DD>
The current user used to connect to the master.

<DT><code>Master_Port</code>
<DD>
The current master port.

<DT><code>Connect_Retry</code>
<DD>
The current value of the <code>--master-connect-retry</code> option.

<DT><code>Master_Log_File</code>
<DD>
The name of the master binary log file from which the I/O thread is
currently reading.

<DT><code>Read_Master_Log_Pos</code>
<DD>
The position up to which the I/O thread has read in the current master binary log.

<DT><code>Relay_Log_File</code>
<DD>
The name of the relay log file from which the SQL thread is currently
reading and executing.

<DT><code>Relay_Log_Pos</code>
<DD>
The position up to which the SQL thread has read and executed in the current relay log.

<DT><code>Relay_Master_Log_File</code>
<DD>
The name of the master binary log file that contains the
last event executed by the SQL thread.

<DT><code>Slave_IO_Running</code>
<DD>
Whether or not the I/O thread is started.

<DT><code>Slave_SQL_Running</code>
<DD>
Whether or not the SQL thread is started.

<DT><code>Replicate_Do_DB, Replicate_Ignore_DB</code>
<DD>
The lists of databases that were specified with the
<code>--replicate-do-db</code> and <code>--replicate-ignore-db</code> options, if any.

These fields are present beginning with MySQL 4.1.1.

<DT><code>Replicate_Do_Table, Replicate_Ignore_Table, Replicate_Wild_Do_Table, Replicate_Wild_Ignore_Table</code>
<DD>
The lists of tables that were specified with the
<code>--replicate-do-table</code>,
<code>--replicate-ignore-table</code>,
<code>--replicate-wild-do-table</code>,
and
<code>--replicate-wild-ignore_table</code>
options, if any.

These fields are present beginning with MySQL 4.1.1.

<DT><code>Last_Errno, Last_Error</code>
<DD>
The error number and error message returned by the most recently executed query.
An error number of 0 and message of the empty string mean ``no error.''
If the <code>Last_Error</code> value is not empty, it will also appear as a
message in the slave's error log.

For example:


<PRE>
Last_Errno: 1051
Last_Error: error 'Unknown table 'z'' on query 'drop table z'
</PRE>

The message indicates that
the table <code>z</code> existed on the master and was dropped there, but it
did not exist on the slave, so <code>DROP TABLE</code> failed on the slave.
(This might occur, for example, if you forget to copy the table to the
slave when setting up replication.)

<DT><code>Skip_Counter</code>
<DD>
The last used value for <code>SQL_SLAVE_SKIP_COUNTER</code>.

<DT><code>Exec_Master_Log_Pos</code>
<DD>
The position of the last event executed by the SQL thread
from the master's binary log (<code>Relay_Master_Log_File</code>).
(<code>Relay_Master_Log_File</code>, <code>Exec_Master_Log_Pos</code>) in the
master's binary log corresponds to
(<code>Relay_Log_File</code>, <code>Relay_Log_Pos</code>)
in the relay log.

<DT><code>Relay_Log_Space</code>
<DD>
The total combined size of all existing relay logs.

<DT><code>Until_Condition, Until_Log_File, Until_Log_Pos</code>
<DD>
The values specified in the <code>UNTIL</code> clause of the <code>START SLAVE</code>
statement.

<code>Until_Condition</code> has these values:


<UL>
<LI>

<code>None</code> if no <code>UNTIL</code> clause was specified
<LI>

<code>Master</code> if the slave is reading until a given position in the master's
binary logs
<LI>

<code>Relay</code> if the slave is reading until a given position in its relay logs
</UL>

<code>Until_Log_File</code> and <code>Until_Log_Pos</code> indicate the log filename and
position values that define the point at which the SQL thread will stop
executing.

These fields are present beginning with MySQL 4.1.1.

<DT><code>Master_SSL_Allowed, Master_SSL_CA_File, Master_SSL_CA_Path, Master_SSL_Cert, Master_SSL_Cipher, Master_SSL_Key</code>
<DD>
These fields show the
the SSL parameters used by the slave to connect to the master, if any.

<code>Master_SSL_Allowed</code> has these values:


<UL>
<LI>

<code>Yes</code> if an SSL connection to the master is allowed
<LI>

<code>No</code> if an SSL connection to the master is not allowed
<LI>

<code>Ignored</code> if an SSL connection is allowed but the slave server does not
have SSL support enabled
</UL>

The values of the other SSL-related fields correspond to the values of the
<code>--master-ca</code>,
<code>--master-capath</code>,
<code>--master-cert</code>,
<code>--master-cipher</code>,
and
<code>--master-key</code>
options.

These fields are present beginning with MySQL 4.1.1.

<DT><code>Seconds_Behind_Master</code>
<DD>
The number of seconds that have elapsed since the timestamp of the last
master's event executed by the slave SQL thread. This will be <code>NULL</code>
when no event has been executed yet, or after <code>CHANGE MASTER</code> and
<code>RESET SLAVE</code>. This field can be used to know how ``late'' your slave
is. It will work even though your master and slave don't have identical
clocks.

This field is present beginning with MySQL 4.1.1.

</DL>



<H4><A NAME="START_SLAVE" HREF="manual_toc.html#START_SLAVE">14.6.2.8  <code>START SLAVE</code> Syntax</A></H4>

<P>
<A NAME="IDX1811"></A>

</P>

<PRE>
START SLAVE [<var>thread_type</var> [, <var>thread_type</var>] ... ]
START SLAVE [SQL_THREAD] UNTIL
    MASTER_LOG_FILE = '<var>log_name</var>', MASTER_LOG_POS = <var>log_pos</var>
START SLAVE [SQL_THREAD] UNTIL
    RELAY_LOG_FILE = '<var>log_name</var>', RELAY_LOG_POS = <var>log_pos</var>

thread_type: IO_THREAD | SQL_THREAD
</PRE>

<P>
<code>START SLAVE</code> with no options starts both of the slave threads.
The I/O thread reads queries from the master server and stores them in the
relay log.  The SQL thread reads the relay log and executes the
queries.
<code>START SLAVE</code> requires the <code>SUPER</code> privilege.

</P>
<P>
If <code>START SLAVE</code> succeeds in starting the slave threads, it
returns without any error. However, even in that case, it might be that the slave
threads start and then later stop (for example, because they don't manage to
connect to the master or read its binary logs, or some other
problem). <code>START SLAVE</code> will not warn you about this. You must
check your slave's error log for error messages generated by
the slave threads, or check that they are running fine with <code>SHOW
SLAVE STATUS</code>.

</P>

<P>
As of MySQL 4.0.2, you can add <code>IO_THREAD</code> and <code>SQL_THREAD</code>
options to the statement to name which of the threads to start.

</P>
<P>
As of MySQL 4.1.1, an <code>UNTIL</code> clause may be added to specify that
the slave should start and run until the SQL thread reaches a given point in
the master binary logs or in the slave relay logs. When the SQL thread reaches
that point, it stops.  If the <code>SQL_THREAD</code> option is specified in the
statement, it starts only the SQL thread.  Otherwise, it starts both slave
threads.  If the SQL thread is already running, the <code>UNTIL</code> clause is
ignored and a warning is issued.

</P>
<P>
With an <code>UNTIL</code> clause, you must specify both a log filename and
position. Do not mix master and relay log options.

</P>
<P>
Any <code>UNTIL</code> condition is reset by a subsequent <code>STOP SLAVE</code>
statement, a <code>START SLAVE</code> statement that includes no <code>UNTIL</code>
clause, or a server restart.

</P>
<P>
The <code>UNTIL</code> clause can be useful for debugging replication, or to
cause replication to proceed until just before the point where you want
to avoid having the slave replicate a statement. For example, if an unwise
<code>DROP TABLE</code> statement was executed on the master, you can use
<code>UNTIL</code> to tell the slave to execute up to that point but no farther.
To find what the event is, use <code>mysqlbinlog</code> with the master logs or
slave relay logs, or by using a <code>SHOW BINLOG EVENTS</code> statement.

</P>
<P>
If you are using <code>UNTIL</code> to have the slave process replicated queries in
sections, it is recommended that you start the slave with the
<code>--skip-slave-start</code> option to prevent the SQL thread from running
when the slave server starts.  It is probably best to use this option in an
option file rather than on the command line, so that an unexpected server
restart does not cause it to be forgotten.

</P>
<P>
The <code>SHOW SLAVE STATUS</code> statement includes output fields that display
the current values of the <code>UNTIL</code> condition.

</P>
<P>
This statement is called <code>SLAVE START</code> before MySQL 4.0.5.
For the moment, <code>SLAVE START</code> is still accepted for backward
compatibility, but is deprecated.

</P>



<H4><A NAME="STOP_SLAVE" HREF="manual_toc.html#STOP_SLAVE">14.6.2.9  <code>STOP SLAVE</code> Syntax</A></H4>

<P>
<A NAME="IDX1812"></A>

</P>

<PRE>
STOP SLAVE [<var>thread_type</var> [, <var>thread_type</var>] ... ]

thread_type: IO_THREAD | SQL_THREAD
</PRE>

<P>
Stops the slave threads.
<code>STOP SLAVE</code> requires the <code>SUPER</code> privilege.

</P>
<P>
Like <code>START SLAVE</code>, as of MySQL 4.0.2, this statement
may be used with the <code>IO_THREAD</code> and <code>SQL_THREAD</code> options to name
the thread or threads to stop.

</P>

<P>
This statement is called <code>SLAVE STOP</code> before MySQL 4.0.5.
For the moment, <code>SLAVE STOP</code> is still accepted for backward
compatibility, but is deprecated.

</P>


 </BODY>
 </HTML>
